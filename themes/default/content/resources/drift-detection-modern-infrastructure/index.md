---
preview_image:
hero:
  image: /icons/containers.svg
  title: "Drift Detection  | Modern Infrastructure"
title: "Drift Detection  | Modern Infrastructure"
meta_desc: |
    The drift detection stack is a piece of infrastructure that repeatedly runs refreshes on your infrastructure via the Pulumi Deployments API to dete...
url_slug: drift-detection-modern-infrastructure
featured: false
pre_recorded: true
pulumi_tv: false
unlisted: false
gated: false
type: webinars
external: false
no_getting_started: true
block_external_search_index: false
main:
  title: "Drift Detection  | Modern Infrastructure"
  description: |
    The drift detection stack is a piece of infrastructure that repeatedly runs refreshes on your infrastructure via the Pulumi Deployments API to detect when your desired infrastructure state has diverged from the reality in production.  Drift detection can alert you to situations where someone has made manual edits to infra via the AWS console without syncing up those changes in the Pulumi program.  The example code is available at https://github.com/pulumi/deploy-demos/tree/main/pulumi-programs/drift-detection  
  sortable_date: 2023-03-29T13:00:00Z
  youtube_url: https://www.youtube.com/embed/-K90I1F6tfs
transcript: |
    Welcome to another episode of Modern Infrastructure Wednesday. My name is Aaron Cow. This is part three of the series on Pulumi deployments. In this episode, I'm gonna show you how to build a drift detection application that repeatedly runs refreshes on infrastructure you want to monitor for drift via the Pulumi deployment. API. Now drift is what happens when the live production infrastructure you have has diverged from the desired state defined in code drift detection is useful because it can alert you to situations where someone has made manual edits to your infrastructure via the A BS console. Uh without committing those changes to the code in the Pulumi program. We're using the drift detection example from the Pulumi deploy demos repo. So we're going to deploy two stacks here for this demo. The first stack is the stack that will be monitored. And the second stack is the drift detection app. The drift detector stack will call refresh against the monitor stack on a Cron job. If the refresh turns up a deviation from desired state, an alert will be written to the logs of the drift detector stack. Let's get started. We're gonna first deploy the stack that will be monitored for drift. Uh So let's, yeah, go in there. Ok. So let's do a pull me new. Um And we'll just do something really simple. Um The Aws Python uh template call that minimal Python plumbing program and to use those two. Ok. We can run a pluming up, let that run real quick. Ok. That's done running. This is a very simple, um, piece of infrastructure. It's just a stack that has a S3 bucket, but we're going to be monitoring this for drift. Next, we're gonna deploy the drift detector. Um I am pulling it from the examples and the deploy demos um re um it's actually rather simple. Um It is just provisioning a Lambda that uh calls, it's been kicked off on a and what it's doing is it has a pulling the axis token. Um So it has access to um make changes on stacks. Uh So what it's doing is the stack that it's monitoring, it is calling refresh against it. Um And then checking for whether there's deviations against the desired state and then writing to logs. So we will deploy this. So I cloned it over here in this repot. So um first let's do OK, then we'll do this initialized stack, great. Then we'll set some configurations, then do that. And now what we're gonna do is um we're gonna pass it a, a configuration where we're essentially pointing it to the stack that we created earlier. Um, that way it knows to read it um, and perform the refresh on it. Ok. With that, we will do it Pulumi up and we'll let that run real quick. Ok. That's done. So now we're just gonna follow the logs to see what has drifted. Ok. So the, the lambda, uh that's part of the drift detector is running. So what it does is um, it reads in from the configurations which stacks that needs the monitor. So here we inputted uh demo drift monitors stack dev. Uh So what it's doing is um it is just calling uh refresh on that stack to see if there's any changes. Now, what we're gonna do is we are going to create a drift manually here. Uh So uh we previously launched this stack, uh drift monitor stack, it's that S3 bucket. So, um so here we'll see that we hit activity. Um The drift detector is calling deployments and uh running refresh. Uh But so far all the uh no drift has been detected because nothing's been touched. But if we go to resources, we'll here, see that there is a S3 bucket. So let's open it up into a to BS console and we are going to delete this bucket. So. Mhm OK. It's successfully deleted the bucket. So the next time that there is a refresh run, um we should be able to detect uh that there's a drift against the stack. So let us wait for that. I think the Cron's running every minute. So um it might take a little bit. All right, there we go. Um It, the logs show that it found one stack that did not pass the drift uh check. Um So um it works there. We have it a drift detector that automatically detects infrastructure stack deviations. This video is based on code in our deploy demos, github repo. The link is below. This concludes the series on Pulumi deployments. Polay deployments is our deployments as a service technology where Pulumi fully manages the execution of infrastructure as code programs for you. Over the course of this series, y'all saw that you can build very useful applications against the deployments. API We hope this series can give you some inspiration to use deployments for sophisticated infrastructure provisioning and management workflows. If you enjoyed this video, don't forget to hit like and subscribe. That is it for today's modern infrastructure Wednesday? See you all next time.

---
