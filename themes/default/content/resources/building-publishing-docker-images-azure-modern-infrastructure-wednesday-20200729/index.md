---
preview_image:
hero:
  image: /icons/containers.svg
  title: "Building and Publishing Docker Images to Azure | Modern Infrastructure Wednesday 2020-07-29"
title: "Building and Publishing Docker Images to Azure | Modern..."
meta_desc: |
    In today's episode, we build and publish a Docker image to Azure Container Registry (ACR). In just a few lines of code, we're able to build an imag...
url_slug: building-publishing-docker-images-azure-modern-infrastructure-wednesday-20200729
featured: false
pre_recorded: true
pulumi_tv: false
unlisted: false
gated: false
type: webinars
external: false
no_getting_started: true
block_external_search_index: false
main:
  title: "Building and Publishing Docker Images to Azure | Modern Infrastructure Wednesday 2020-07-29"
  description: |
    In today's episode, we build and publish a Docker image to Azure Container Registry (ACR). In just a few lines of code, we're able to build an image and push it to Azure. Code for this episode available here:  https://github.com/pulumi/pulumitv/tree/master/modern-infrastructure-wednesday/2020-07-29  Today's example is in Python, but Pulumi makes it easy to stand up infrastructure in your favorite languages including TypeScript, JavaScript, C#, and Go - saving time over legacy tools like CloudFormation and Hashicorp Terraform.  https://www.pulumi.com/docs/get-started/?utm_campaign=PulumiTV&utm_source=youtube.com&utm_medium=video
  sortable_date: 2020-07-29T04:16:58Z
  youtube_url: https://www.youtube.com/embed/7J97mfUq5W8
transcript: |
    Hello and welcome to another episode of Modern Infrastructure Wednesday. I'm your host, Lee Zen. Today we'll be covering building and publishing Docker images to Azure where uh the very common workflow we're gonna have to publish container images to uh repository. And so let's talk about this. Let's in this episode, we're going to create a container registry so we can have repositories for images, gonna build the image and we're gonna push that to AC R so fairly simple but very powerful. So uh here I have a, you know, if you were to run Pulumi New uh Azure Python, this is more or less the kind of project you would get. Uh I've done a couple changes. I've added a Docker as a requirement here and then created a my app with a simple Docker file. Obviously, you would have an actual application in here that represents uh your, your particular uh container image. So we're going to uh go ahead and create the registry first uh as I talked about in the uh intro. So we're gonna use the container service and uh let's create the registry so we can call it a registry and give it some options here, uh admin enabled. Yes, we want that. Uh And then we also want the SKU to be uh basic and it'll uh belong to our resource group up here. I should probably be, uh I don't do Python that often, but let's be Python and consistent and then uh resource group name and that's going to be the uh resource group uh name. All right. So that's that. And actually if we just run, pull me up right now, that will give us the registry. And of course, in addition to the registry, uh we want to uh create an image and publish it to that registry. So let's, yes. So how do we do this? We can do this. Uh And we need, now we need the doctor package. And so um here, uh we're going to use uh the Louis Docker image, call this uh my app and uh we'll give it an image name and this will be based on the registry. So we have registry and we're going to apply this uh output since we don't know what it is yet. Uh And uh it's going to be the server name slash, you know, our uh repository name. And then we give it a tag, uh it's called V one. And then uh in addition to that, we have to give it a build obviously. And this will be, there are a couple ways to do this. You can give it a context or file the context in this particular case is just a as, as the doc say here, path to a directory. Um And so this is that directory I talked about earlier. Uh So context is uh my app. And then finally, we want to push this to the registry. Uh We can also say skip, push. Uh So we don't push it but uh let's, let's give it the industry. So how do we do that? Um uh Let's call this R for now. And uh we want to give it an image. You can see this takes a um the uh this takes an image registry. So let's let's create one of those. And how do we do that? Well, we can uh do this. Uh And this takes a server, user name and password. But where do those come from? Well, they come from the uh registry object up here. Uh You should typically be able to pass these in but uh working on a small bug in the package right now where it's not accepting the outputs currently. So we're going to kind of do it for it. Uh So we'll do uh plume output all. And what output dot all basically says is, hey, wait for all of these things to be ready. Uh And then use them uh asynchronously. So we're going to wait for uh the registry. Uh uh Here in this case, we need the um uh log in server, the uh user uh admin, user name and the uh admin password. And we're going to then uh apply that uh two to create this. So we're going to give it a lambda and this will be those uh three arguments in this order. OK? Clean this up a little bit. So it's more readable. All right. And now this is an output of, of this, which creates this. And so this, this registry will now be able to be fed into this image creation. So let's run this and we can actually go ahead and take a look at our stack. You see, I had the Docs open earlier to make sure I knew like what all these things were like that. There's this admin user name and password kind of how we wanted all that to work. Um See how this works. OK? Creates updating. OK? Great. Uh Let's go back to here if you look at the resources, uh we had this registry resource. So let's take a look at that. I see still running. And so if we come to this, um we can take a look at the repositories here. So nothing yet. So I think it's still still building on a machine and maybe even still pushing. Let's give it a couple seconds here. But you can see this, this is the registry that we created from the earlier step when we ran uh Pulumi up just with the registry on its own. And then now we've updated the program to add this image. And again, we're uh building the image uh with this Docker build uh directive here. And then um we're giving it the image name again, we're using it, apply. So again, applies when we, you know, asynchronously want to do something because you know, at the time of of uh program execution, uh this may not be known. And so we have a callback effectively that lets us uh provide this name when this is ready to be used. And Pulumi takes care of all the dependency tracking to make sure that this only executes after this is known. Uh And then the same thing here, we're using output dot all to uh make sure we have all these before we use this call back to create this image. So OK, so it looks like it's, it's done, it's created. And if I go back to here and I refresh, we have the repository my app as we talked about right here. Uh If we go into this, it has the tag that I just created and this is the image uh that I just pushed uh just now. So yeah, super simple in really just a few lines of code, uh we can create a Docker image, push it into a registry. We created uh all using Pulumi. Hopefully you learned a lot today. Thanks for watching. Please make sure you like the video and also subscribe to Pulumi TV, for weekly updates with modern infrastructure as code. Thanks very much.

---
