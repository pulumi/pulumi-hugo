---
preview_image:
hero:
  image: /icons/containers.svg
  title: "Policy as Code with CrossGuard | Modern Infrastructure Wednesday"
title: "Policy as Code with CrossGuard | Modern Infrastructure..."
meta_desc: |
    In this episode, David shows you two examples to get you started with Pulumi CrossGuard:
url_slug: policy-as-code-crossguard-modern-infrastructure-wednesday
featured: false
pre_recorded: true
pulumi_tv: false
unlisted: false
gated: false
type: webinars
external: false
no_getting_started: true
block_external_search_index: false
main:
  title: "Policy as Code with CrossGuard | Modern Infrastructure Wednesday"
  description: |
    In this episode, David shows you two examples to get you started with Pulumi CrossGuard:  - Blocking public ACL's on AWS S3 buckets - Blocking Public LoadBalancer services on Kubernetes  The links to the data breaches mentioned during the introduction are:  - SEGA Europe Thoroughly Scrutinizes its Cloud Security https://vpnoverview.com/news/sega-europe-security-report/  - Report: Audio Tech Giant Exposed Thousands of Customers' Data https://www.vpnmentor.com/blog/report-sennheiser-leak/  - Report: Ghana Government Agency Exposes 100,000s of Citizens in Massive Data Breach https://www.vpnmentor.com/blog/report-ghana-nss-leak/
  sortable_date: 2022-01-26T22:06:27Z
  youtube_url: https://www.youtube.com/embed/j-QpdQH3EZ8
transcript: |
    Hello and welcome to Modern Infrastructure Wednesdays at Pulumi TV. I'm your host David Flanagan though you may know me from across the internet as rock code today. We're taking a look at cross guard policy as code for preliminary programs. What is is good policies could provide the ability for organizations to put guard rails in place to enforce compliance with the resources created by their political programs. Why do we need it? Well, Pulumi is an enabler giving developers the framework to provision their own applications or even platforms using languages and tool chains that they already know allows them to be more autonomous and increase their velocity. When shipping could. This is fantastic for developers but much like a kid cycling downhill for the very first time flying over the handle bars can almost be inevitable. And we want to stop that. We want developers to maintain their velocity but provide a safety harness that stops them from doing something that could have a negative effect on other teams or even the organization need a more concrete example. Sure thing just three weeks ago at the end of 2021 Sega shared their story, they had a cloud security audit that discovered they were storing steam keys, api tokens and even Aws credentials were available to the public. Also in 2021 we've seen Sennheiser leak over 28,000 private customer records. A COVID-19 testing firm lead over 50,000 private customer records. And the authorities in Ghana are investigating a breach that may have exposed the personal information of hundreds of thousands of citizens of the West African country. What do all of these cases have in common? They were all the cause of mess configuration of S3 buckets. The source lengths are in the description. So go and check them out using policy as code. We can assure that these types of mis configurations do not happen again. Let's take a look. So let's start by creating a small P program to create an Amazon web services SD bucket. First, we'll create a directory instead of this directory. We will run Pulumi. We're going to say that we want an aws program and we're gonna pick typescript. Perfect. Then we're going to go back up a directory and we're gonna create one more this time S3 bucket policy. Instead of our S3 bucket policy, we're going to run Pulumi policy new from here. I can say AWS. And this time I'll choose Python from here, I can run the lime preview, enter my stack password and polymer will tell me that it wants to create 1 S3 bucket. So if I run this again, adding policy pack and then point it to the directory with our policy. Cross guard is going to validate that no violations of our policy happen inside of our preliminary program. And in fact, if I run this right now, we'll see that this works successfully. So let's modify our preliminary program to violate the policy if we open vs code with both projects. So we'll start by taking a look at the policy that was created by Pulumi Paul senior. We open the main dot pi file. We'll see that we have a function. This function is called S3, no public read validator. So you can probably guess what it does. It is going to ensure that any time a developer within our team or organization creates an se bucket that it can't be publicly available. It does this by filtering down the type of resource that is being created. So here we are checking for a bucket. We're ensuring that AC L is inside of the properties past this resource. And if so we wanna make sure that it is never public rate or public rate rate as somebody creates an S3 bucket resource with an AC L of either of these public values, we are going to report a violation and we will get enough information that we can see this when we run the plume up on our program. So let's modify or three could to violate the policy. We can add AC L public root. And now if we run our policy pack again, we get the editor, we are not allowed to get a preview or run, pull me up because we have a mandatory enforcement of an S3. No public read of a nice message telling us where we went wrong, but policies aren't just for S3. So let's do one more example. Now I'm going to create two more directories, Kubernetes service and Kubernetes service policy. Instead of the Cotti Service, we're going to create a new program. We're going to do Cabernet's go and then in Cober service policy, we'll do plume policy. Yeah. This time I can select Cotis in javascript. Perfect. Let open us and be as good and take a look. We have a javascript policy for cotis. This policy pack has mandatory enforcement level where it's going to validate resources of tape service as this service has a spec type of load balancer. It is going to report a violation saying that we are not allowed to make services, but then our Cober Netti cluster public and we open our TTI program, we will stay this program go creates a new deployment and currently does not violate our policy. If we run into Cobern service and run Pulumi preview dash dash policy pack, posting it to our policy document, we should see but there are no violations. Perfect. So let's make a change to our project. We've decided that we now want to expose our deployment on our cluster. So let's violate our policy. We've created a new service which is equal to core V one dot new service. We can pass that in our context, a name for our service which we call and we want to pass in a V one service from here. We add the spec which is going to be a KV one service but arcs and instead of here it's got a tape and we will set this to Pulumi string full bouncer. I'm not going to use the service. Well, let's just make that an underscore and now when we come back to our terminal and run our preliminary preview of plan, our policy pack, we should see the violation reported. Perfect. So that's Trust card and Polis policy as code. Hopefully, based on what I've shown you today, you see how easy it is to get started. It doesn't matter which language you use for your policy or your political programs, you can get up and running very quickly. Take the default policies, add on your own and secure your infrastructure. Have a great day.

---
