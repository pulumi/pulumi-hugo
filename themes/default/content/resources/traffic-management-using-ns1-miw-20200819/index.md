---
preview_image:
hero:
  image: /icons/containers.svg
  title: "Traffic Management using NS1 | MIW 2020-08-19"
title: "Traffic Management using NS1 | MIW 2020-08-19"
meta_desc: |
    In today's episode, we use NS1 to setup traffic management and route traffic
url_slug: traffic-management-using-ns1-miw-20200819
featured: false
pre_recorded: true
pulumi_tv: false
unlisted: false
gated: false
type: webinars
external: false
no_getting_started: true
block_external_search_index: false
main:
  title: "Traffic Management using NS1 | MIW 2020-08-19"
  description: |
    In today's episode, we use NS1 to setup traffic management and route traffic based on the geographic region of the end user. In just a few minutes and a couple lines of code, we're able to send users to different endpoints based on their geographic location.  Code for this episode available here:  https://github.com/pulumi/pulumitv/tree/master/modern-infrastructure-wednesday/2020-08-19  Today's example is in TypeScript, but Pulumi makes it easy to stand up infrastructure in your favorite languages including JavaScript, Python, C#, and Go - saving time over legacy tools like CloudFormation and Hashicorp Terraform.  https://www.pulumi.com/docs/get-started/?utm_campaign=PulumiTV&utm_source=youtube.com&utm_medium=video
  sortable_date: 2020-08-19T07:18:57Z
  youtube_url: https://www.youtube.com/embed/yY1NboXEuds
transcript: |
    Hello and welcome to another episode of Modern Infrastructure Wednesday. I'm your host, Lee Zen. Today we're going to be covering traffic management with NS one. What is traffic management? Traffic management is the concept of using DNS to uh have your clients and, and, and users go to certain end points based on various criteria and rules. Uh In NS one, we're gonna be creating some DNS zones and records. We're gonna be setting up filter chains and answer groups. And then we're going to in today's example, route traffic based on geographic regions, folder chains are NS one's construct for deciding how to uh provide a set of answers. They are uh filters as the name implies. Uh a way to use metadata about the records uh and the users uh and other conditions to filter the right answers back. And uh you can use answer groups to group sets of answers together. Uh filter chains are super powerful. You can, you can filter a whole set of information ranging from, you know, application health uh to, you know, latency to to geographic region today. Like I mentioned, we're gonna go through a simple example before I get show showing that example. Please make sure you subscribe to Pulumi TV. Uh hit that like button below. Uh We love to hear your feedback. Please leave some comments in the video after you've watched it. Uh And yeah, let's get started. So, uh I have this uh empty Pluming program. I've already imported the NS one provider or really uh added it to my package JSON uh and uh installed using an N PM. Um So now we can uh import the provider and we're gonna start by creating a zone. Uh And this will be what Scott pulling me TV. And uh it takes a zone parameter. Uh We'll give it this name. All right. Uh And then we're gonna create a record so we can actually do DNS and the record takes a domain and in our case, it's going to be a person called demo. Takes a take, it's an A record, it takes a zone. Uh This is just the previous zone. Um And it also takes obviously answers uh since we should re return something, um we can just give it uh an answer here and that's it. Uh And then we're gonna export the name servers uh from the zone. So we can actually uh do some inspection of this at the end. So let's run plu me up. So you can see it's gonna create the zone in the record and we're all done and we can query the name servers directly to find out uh if everything is working so we can dig at the name server. So this is using authoritative Venus for skipping uh our recursive resolver and asking in one directly. Uh what is the, you know, uh value for demo dot dot TV? And you can see it's 1234, which is what we expect so great success there. Now, let's do the second part of what we talked about, which is adding the filter chains and uh answer groups. So let's start with the filter chains. Um And so we can add some filters. Uh And uh let's talk about the first filter we want to add um has to have a name for the filter and the type of the filter. Uh Let's refer to the NS one documentation and you can see uh we want to use this GEO target regional filter and uh it takes some config but we don't need any. Uh And then uh we'll add another filter. Uh And that one is to um uh take the first uh group. This is select first. And here I actually wanna select first region uh region actually. In this case, is not referred to the geographic region, but in this terminology refers to uh the group, the answer group actually. And you'll see, you'll see that you'll see why in a second um we're gonna create some regions and here you can see this is what I'm talking about. A region is actually an answer group uh in the NS one U I. But uh for legacy reasons, it's called uh regions from uh uh from an perspective. So we're gonna create those regions. Um Regions have a name. Uh In our example, today, we're gonna be splitting our traffic between the west coast of the United States and the east coast. So we'll call this uh west. This name has no meaning. Uh It's a name we want to call the, the group. Um uh And so I'm just calling a West side. I know what it represents and I'm gonna give it some. Uh And so uh you do the same thing uh with East and these uh groups can actually have some metadata attached to them. And so we're gonna attach the metadata and these are key value pairs. Um in our case, you know, we want to use GEO region. I just cut this whole board. And so what this basically is saying is that um records that belong to the West group should be tagged with the, you know, have the metadata that, that they are part of the West GE us, West GEO region. And same thing with the records that belong to the East group. So how do we make these records belong to groups? Uh These answers belong to groups or other, we can actually add them to the answer group. Um And so we can uh give it a region um and oops believe this actually takes um this just takes a string. Uh So the region this belongs to is West. Uh You can actually also add metadata directly to each answer. So you could also imagine tagging this with a GEO region or various other uh things that the filter chain can use. Uh But in our case, we're not gonna do that because uh we already have the metadata just from the group itself. Um So let's create a few more answers here to make this interesting. Um So we'll create a couple West dancers and then we'll create a couple East dancers and uh there. So now let's run Pulumi up. So we have a couple of records that belong to the West group, a couple of records that belong. Oops, that's a mistake. Let's not run there. Let's run that again. Uh We have a couple of records that belong to the West group, a couple of records that belong to the East group. And then we've also said that any records uh any, any answers, rather not records, any answers that are part of the West group uh are tagged with this us West GEO region and same thing with uh East correspondingly. And then when someone Rees for our records or for our answers, they should get back answers that are the closest GEO target region. And then we should select the first region. So if we run that query again, uh we should expect to get back just the West answer since I'm based in Seattle. And that's what happens. We get back just the answers for the West. Uh We can also test to see that this works uh for the East by providing a subnet. Uh So the way that this works is basically saying um this is giving it the E DNS option client subnet, which is basically telling uh the authoritative name server that uh you know, the client that is querying uh is actually coming from this IP range. This happens to be in US East one for Aws. And if we do that, you can see we get back the dancers. So exactly it works exactly as we expect. Um And yeah, that's really what I wanted to go through today just showing kind of, you know, how easy it is to get going with NS one and how easy it is to set up uh filter chains and really just a few lines of code uh in plume. And then obviously, you can totally imagine, you know, adding more complexity if you need uh to uh route appropriately. And you know, the routing doesn't just have to be based on static information like we have here uh where the information is provided statically but can also be provided based on real time information such as, as I mentioned earlier, you know, integrating the health of your end points. You can imagine, you know, for each of these answers, we can also add a meta here where uh you know, we have metadata about um the health of that application uh as as as through an integration. And there's actually a uh if we go back to the documentation, um there's uh ways to do that via uh monitoring and, and other data sources. Um And then, so then we can use that information uh to then uh route appropriately based on the health and various other factors uh of the end points. So I hope you enjoyed today's episode. Uh like I mentioned at the beginning, uh please make sure you uh subscribe to Pulumi TV. So you can get updates on all our episodes and we'll see you next week on Modern Infrastructure Wednesday. Thanks very much.
---
