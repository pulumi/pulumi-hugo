---
preview_image:
hero:
  image: /icons/containers.svg
  title: "Pulumivision - Pulumi and Docker - Besties Forever!"
title: "Pulumivision - Pulumi and Docker - Besties Forever!"
meta_desc: |
    Matty is joined by Peter McKee (Docker) to dig into some fun ways to use Pulumi and Docker together!
url_slug: pulumivision-pulumi-docker-besties-forever
featured: false
pre_recorded: true
pulumi_tv: false
unlisted: false
gated: false
type: webinars
external: false
no_getting_started: true
block_external_search_index: false
main:
  title: "Pulumivision - Pulumi and Docker - Besties Forever!"
  description: |
    Matty is joined by Peter McKee (Docker) to dig into some fun ways to use Pulumi and Docker together!
  sortable_date: 2022-01-07T09:06:25Z
  youtube_url: https://www.youtube.com/embed/ja5tV7IUQnU
transcript: |
    Time for Pulumi Vision with Docker. But before we get into the Docker stuff, uh if you're watching this on the replay, because that's the only way you're hearing me right now because none of you have tuned in yet. Uh I'm joined by Peter from Docker. So Peter, welcome to Pulumi Vision. Yeah. Thanks for having me. Um We were just having a little bit of like streamer slash demo person. Uh kind of kind of, oh, we got a couple of joints and, and, and where we're about to go is they're saying, you know, like you have a totally different set up for your, your ID and your coding environment when you're working than when you're streaming. And it would be nice and there might be a way to do this to sort of because I know you can, you know, like load different settings for VS code, you know, sort of like to have like an overlay to say like when I launch in streamer mode, but I also want my window position different and Yeah. Yeah. Yeah, like a whole um I don't know, maybe it's something we should write like a script. I have you ever done any like Mac scripting, scripting, apple, script, apple script? Yeah, I it's been a long time since I've written Apple back in the day. But there's a few things I wanna do but you can't because they aren't exposed. So here's the thing I really want to automate is zoom because I wanna be able to. And the one thing that you cannot do any kind of automation with, with Zoom is the audio input and output. You can script the video source. But because again, when I'm just on a video call, I'm using my speakers and my webcam mic, it's fine. But if we're doing this, I've got my headphone, I've got this and it's two clicks in Zoom and there's no, they don't expose it through Apple script or anything. Huh? Yeah, we need to, we need to start a streaming company. Sorry, sorry. We stream stream you whoever you are, whoever it is. Sorry. We, we gonna go start our new thing. Yeah, because it's, and, and maybe, I don't know, maybe this leads into like why you build custom software, right? It's like off the shelf software is fantastic, but especially as an engineer and we always go to like, oh I wanna build it myself. I gotta build it. But I don't know man, having your own system custom, you know, to where Yeah. If you're developing on a laptop, you, you click a couple buttons and everything. Windows are all set up, you like, like you like it at the coffee shop and you come home, hit the other button and it spreads it out across, right? Sets up your whole environment. Yeah, everything up. Let me see how this, that, hey, that worked the way that I expected it to. OK. Cool. Like I learned a new thing in uh in res stream. Um how to, how to highlight a, a comment. So cool. All right. So yeah, uh what we thought we would do is uh we're gonna let Peter Drive and we're gonna just uh go through Peter's got some sample apps. We're gonna plu them and in our interests of always doing different programming languages on Pulumi vision. We're not doing go, we're not doing Python. We're not even doing typescript or C# but we're doing javascript today because Peter hates typescript. Thank God. All right. All right. Before I get the hate, you know, I always say this too. I, I always say this and I don't get much hate, right? Um Because I'll start off and say, hey, type script. If it's your jam, go for it. My, my contention or, or, you know, discussion I love to have with people is I usually come into, oh, we're gonna go to, we're gonna switch the typescript. We have a huge application already, either micro service or monolith, right? And what we, we need typescript, we gotta do it. We have 100,000 lines of code, we're gonna rewrite it. It's like, no, don't, don't. What happens. I've seen it too many times is you get a bunch of Java javascript inside of dot TS files and you're using any everywhere, right? And it just, it, it trying to convert a large code base to another programming language is, in my opinion, is just a rough idea. But, you know, you're starting to scratch and your whole team is used to C# or Java, right? A typed language. Yeah. Go with typescript 100% right? Uh You get that question. Do you, do you see this all the time, man? I see it online, right? Like um you know, I want to start a project. What language should I use? Right? Like, well, it really depends on your team. Yeah. What do you know what, what are you comfortable with? Right. Like, yeah, II, I feel like I feel like when you get to the point, you will know, like if you don't know why you should use a particular programming language, then you don't need a particular programming language. Like there's scenarios where you're like, I know that I need to write this and trusts because of this really specific reason or whatever or something like that, right? You know, but if you don't know that, then it's fine, you know what? Write that shit in VB dot net. It's fine, you know, we're allowed to swear. I, I don't, I don't know, no one's told me yet, but this is my, this stream is under my OK. R so it's my rule, I guess. Maybe. Ok. Well, well, this is OK, this is the thing like the way that we always said it, it's like PG 13. So in PG 13 and a PG 13, you know, you get one F bomb but you better make it count. So we'll hold off on that one. But yeah, we'll keep this one. Visions, visions of Bruce Willis and uh die hard. Yeah. The one, the one F word, right. That's the best example of using it. Well, though, you know, he made it count. He made it count. Um Was the other the other day I watched on Netflix, The Red Notice. So it's the news with Ryan Reynolds and the Rock and uh it's, it's, it's worth watching if you, uh, don't have to pay money for it. But I was gonna say I just lost all respect for you. The rock and who? No, I'm just kidding. Ryan Reynolds. I like Ryan Reynolds. I watched, it was a fun popcorn movie. But yeah, but they have their one at the end and I'm like, yep, there it was. So, yeah, and S bombs as Paris said, you know, was uh those are, those are, those are special. So, all right. So Peter, tell me first before we kind of go in. So you got yourself some sample apps like that. Do really important work. Um What are these sample apps gonna do? Yeah, they're boring as heck. But um uh yeah, so I just have a sample app. So I created a while ago. Um I got tired of writing um sample code and boilerplate code. So I have this little tool called Ronan. Um And uh yeah, so I built this out and it basically sets up an a back end api where it'll uh accept Jason, you know, crud functions on a certain end point and then a U I that talks to that. And um so there's no data validation or anything like that. So if you send, you know, you can send whatever you want it goes into. Uh Right now I think I have it in memory but I, I could connect the Mango uh database to it. So it's seamless. But um yeah, it's, I use it a lot to do po CS type of things. But um yeah, very simple rack Js front end uh No Js back end with Ron and I use Express Js under the hood. Um This is a very thin layer on top of uh Express Js. But yeah, nothing too exciting. I mean, uh you know, it's not gonna make Docker Pulumi a million dollars, but it, well, maybe on the demo, it will maybe, I don't know, let's see what we can do. Um So we're gonna, so, yeah, so basically it's a multi container situation. We're looking at and I figured what we'd do is we'd write a little Pulumi program that will, you know, do it all just in local Docker for right now. And you could always push these images somewhere else. Maybe we'll play with that. Maybe we won't. Um It's gonna be fun for me because I haven't written any Pulumi and Pure javascript. So we're just gonna see how this goes and it, you know, so get your popcorn ready. Um We could try typescript. You. No, no, no, no, no, that's no, no, no, no, no, that's what I'm saying. Yeah. Yeah. I, I know how to do it in time. So we'll just see you, you know, you, you know, this is, this is fine. This is all, you know, this is how you know that this is not like slick prepared content. Trust me. If you're looking for slick prepared content, look somewhere else. All right. So I'm taking a look. OK. Oh, go to Google. No, sorry. OK, sorry. I just put, OK. So this is your um, your app or what are we at here? Yeah, so I got, so I got my app. Well, let me show, let me um I have it running, let me, let me run it, get it running. Um Let's see, doctor. Uh how do I do this? There it is, let's do do or remove these are fun. It is a little shortcut for everybody. If you just want to blow away all your images, right? Whether it's running stopped or not, do a arm I dash F and then just grab all the images. Dash Q does quiet and we only give you the container ID and A will give you all of them. So, uh I do this very frequently when I'm just blowing everything around who's logged in as the Pulumi who's logged in as a Pulumi TV account is what I want to know right now. So I just, they just said hi dad. Clearly it's a coworker of mine. So Pulumi TV, out yourself. Who is that? Uh because it ain't me, I don't think. All right. So cool. All right. All right. And I, and I'm just here in the root. I have um I have a Docker Capo style I have one with for local and then, but I'm just gonna run the, the uh do Capo dot Emo uh compose and I'm just gonna do an up, I'm gonna give a dash dash build. So it builds all my images, which I probably didn't need to build. I think I have local anyways, but if it takes too long, we'll kill it. But if the internet's works plays now, of course, Matt, sorry, I was, I keep calling you Matt. Matt. We know you know who you're talking about. Yeah. Well, I have a Matt. I have a close friend, Matt. So, yeah. Um Yeah, if, if this thing you know, of course this is gonna die, right. Like I just had it running like, 10 minutes before the, the, uh, live stream. Right. So, why should it work now? So, why should it work? Exactly. Oh, come on. See, I think I have all my image is already built. No. What about you? Oh, there it is. That was weird. 00, I didn't, yeah. Annoying to me. I term doesn't, you know, it, doesn't, it, the worst thing, I guess there's work. This goes back to the other thing we need to fix. Although, you know, if you were cool you wouldn't be using, I term you'd be using Warp. So that's like the hot new terminal, which I started using about three hours ago. Yeah, I was, it Warp that I tried. That's the one that's written in Rust. It's got, I, I could see it being interesting. I'm gonna have to try to make myself use it for a little while. Is it, is it the one that's like super plug with, with javascript and configurations? No. Is that, that's, that's, uh, uh stardust or Star Rocket or Star Line or? This is how I'm trying to see if I think my colleague, Laura is the one who's being Pulumi TV right now because I'm talking crap about whatever that terminal is. Um, no warp is like in rust and it's like, it's interesting how things break up. So, maybe, maybe like when we run out of time later in the stream, I'll, I'll show you what Warp looks like because it's interesting but it has to like it, it definitely um makes HTP calls back out to like look stuff up and things and that makes some people nervous to have your terminal just doing random shit. But I'm like your terminals already probably doing random shit and you don't know it. So OK. OK. So what do I OK. So I just did a compose up um build the images. I need to be build them but and, and there we go. So I'm firing it up. This is a little test app and you could put in uh then to be here. So we get no results. Let's create a new record. Let's just test this. This is a, this is a glorious U I I designed it myself. If anybody is wondering, it's beautiful. You should put web designer on your linkedin. Thank you. 1212. I should put my, I should have put my real phone number in there but not say anything. See if anybody, if anybody OK. What did I do? Submit? Go? Oh Yeah, yeah, yeah. Oh You know what I added this uh where did you go? I added this new fancy um you know, screen. Oh Come on, don't worry, Matt, I get it there. Iii I have absolute faith in him. Something I think this shortcut got taken over by my my window. Manager. Just stop whatever the command. Yeah. Yeah. To open the, um, yeah, the console and, uh, yeah, at least that's what I'm thinking. It just anyway, it's, it's not working. Ok. 200. We going to the right places. Yeah. Ok. That's right. We don't have any new, so let's create a new one. Did I not say that? Oh, there we go. There's the air. Why, why don't you like, why are you trying to go through? Oh, what did I do see that? I broke it. It's cool. Good. Well, we'll fix it live on, on the stream. That's how people know again that this is not. So, what did they do? Highly polished? Yeah. It's sort of like when you see the actors break and then you're like, that's how, you know, it's live, you know, it's like Carol Burnett, right? So that's what's going on here. Oh, there we go. It's coming back. Why are you giving me a 404? Oh, come on. All right. So, what the way this works is it? I'm listening on 80 80. Yeah. There we go. Ok. And then if you go to service, if I could type and then people, ok, it should be fine. I don't know why my friend ends a little hokey. Hm. Oh, maybe because, uh, the spelling doesn't matter. Ok. One more time. Oh, come on. Where are you going? Do we want to fix this or do we wanna, uh, it doesn't matter we can build. Let me see if I can fix it two seconds. Ok, cool. Um, ok. So, and this might be interesting for some folks. So the U I think is having a problem. So you can see right here, I'm calling local host services food people. But when I did it up here or it should just be, people don't know why food is being added because they're probably hard coded in the app somewhere. Huh I don't know why the extra food is getting on there. That is the time. Let's go search here. Yes, thank you. There we go. Get away, go away. That's fine. OK. Stop with cash, cash, cash, cash. Yeah, that's the problem with React U I, right? Like since it's not rendered on the server. So when you run in a container, you have to add like react environment variables at build time because it gets compiled into your javascript probably the same. But like with node, you can switch the environment variables on the server on, you know, as it's running and you start a container. But yeah, react, it gets well not and it's not just react. It's any any any um you know static website, you know, VJS blah, blah, blah, whatever um it uses it is in uh services. Come on can say there it is. So it uses this process. Environment React underscore and what react does it looks for all of these guys and then creates variables in your code that look like environment variables. Anyway. So that's what was happening. You have to add it in at build time. I have a build arg. So uh hopefully that worked. OK? Cool. All right. I'm gonna go fast. I'm gonna go fast. OK? Cool. No, that's fine. I was a very Yeah. Hey, come on, there we go. Let's put it in the database. Hey, look at that. OK. There we go. OK? Cool. OK. So let's go back and take a quick look at at how this is puts it back in your, if we look back at your Docker compose because we're gonna sort of fundamentally what we're doing here is sort of taking in some ways your, your Docker compose and, and everything and, and turning that into Pulumi. Um So you've got a couple uh you really only have OK? So you have one Docker file, that's your app and then all the others are coming from other are coming from public from like the from Docker hub basically, right? These are Mango, you got the Mango image, you've got the et cetera, et cetera. Yeah, I have um Yeah, so two services. These are my, you know, these are two images of them. Yeah. And then, and then the back. Yeah, the Mango um database. Yes. And this, this is gonna pull for hub. Um if you don't have the build context in here and tell it or dash build right then it will go and try and look at hub first. Of course, this will die because I don't have a name space and there's no official image called API. Uh Same for here. Yeah. And uh OK, because the context, the context is telling you that that's fine. We'll, we'll, which again the same thing, we'll pass the context to you. You have, you have an API directory and A U I director. Ok, cool. So what I'm thinking we're gonna do and there might be a more elegant way to, to kind of get to this because we want to create a new Pulumi program. And one of the things you can do is you can have a Pulumi program that just sort of stands alone and its entry point is the root of its directory. Um But you could also maybe you want to store your automation next to it. So you might create like an infra folder or something like that. That being said, what I think we're gonna do and this is gonna sound like kind of a little bit of a backwards way. But we also only want to bring over the stuff that we need from your application. Like we don't need your Docker composed. We don't need all that stuff. So we will copy your API and your, your U I directories over to our new program and we'll build from there and there's, you know, again, more elegant ways we could do this whole damn thing, but that'll get us to, to sort of an end state. So, uh that said, let's go ahead and we're gonna create a new project uh for Pulumi. So wherever you want to do this, I wouldn't do it inside entity. Yeah, exactly. Um So, uh and the project is named after the directory. So you could, you know, MK um we can call it, yeah, if you want to call it entity manager Infra or, you know, Maddie is handsome, you know, whatever. That's. Yeah. In OK. Don't judge, don't judge, you know, the hardest part of this is uh is that people are watching you type. Yep. Yes. Exactly. Yep. OK. Just so you don't lose your. OK? So, and then CD into that directory. OK? Uh Yep. Cool. Now we're gonna create a new. So just you're gonna do Pulumi new. Don't, don't hit yet and you're just gonna say javascript, OK. Now you'll see in your type ahead, you know, your cancel because Peter has done this before. It was, you could have done AWS dash javascript, which is a different scaffolding. We're gonna say we basically want the simple scaffolding of a javascript Pulumi program. So go ahead and fire that off and hopefully you've already, yeah, you already. OK? It's gonna, you could pretty much accept most of these defaults, I think. Yep. That's cool. And so it's gonna go ahead and install basically the basic dependencies that we need for Pulumi. So, uh if you want to take a look and see if you want to correct that thing. Open back in. Yeah, in code, we'll do a little quick exploration of um what it made for us there. So this is our entry point is this uh Pulumi is the index dot Js. Not, not terribly interesting. Uh But you'll see if you look at the package dot json. That's sort of what it did, right? It, it was like, OK, I, I got the, uh you know, Pulumi dependency installed and the Pulumi dot Yaml is the configuration of our overall project, not this particular stack. And it's just gonna tell us right now, what's its name? It's wrote, run, run time is, is, is, is javascript is no, no typescript nonsense here. Um And so now if we want to go ahead and this is, this is where we can add a um if we wanted to say that we wanted our, we don't want our Pulumi program to be at the root because that's actually maybe where our code is and stuff like that. So if you go ahead and create a directory called Infra inside of that, right? And uh you, and it's spelled MK, OK? Um Now go back into your Pulumi, don't, don't, don't, we're not gonna go to go back into VS code. We're gonna move some stuff around and rename some things. So go ahead and this is where we're gonna see if I do this right. Um, your, um, you can go ahead and move your, um, index dot Js. This is, this is where we're gonna see if I get this right. Move all those files except for the Pulumi, all the Pulumi stuff it made except the Pulumi dot Yam. We move them into your Infra folder. Even, uh, no modules, everything. Uh Yeah, that actually, that, that'll, that'll, that'll work. Uh And, and probably even the get ignore because the get ignore is gonna, we're gonna see how badly I screwed this up. Take a look at the G ignore. I just wanna see what get ignore. We it's make sure. Oh, it'll still ignore no modules. Perfect. Now go into your Pulumi dot Yaml and we're gonna add a property. Oh, the is so the only things that the route are the Infra folder and Kalume dot em. All right. Ok, perfect. Now add a property under description called Maine uh right here right there. Yep, colon space and then do Infra forward slash. So that's gonna tell Pulumi um where your entry point is for the program, right? So I go ahead and save that. Yeah. Make sure you're OK. Let me save all these guys. Oh, yeah. The files. They're an easy way to do this. Oh, why did it, why did it make you, why did it open them all when you don't? No, that's weird. Ok. Uh sure, save it. Yeah. Why, what did I do here? And why did it open all it? And why is it wanted to modify them? What did I do? Oh, maybe because of, well, ok, one of the things that will help us. Yeah. Well, go back and, ok, so do this real quick. We're gonna, before we do anything, we're gonna see if I did this. Right? Ok. Run a do Pulumi up in your, in your, in your um, in your terminal. Uh do at the, at the root of that. Just type in Pulumi space up. We're gonna run our existing Pulumi program which is not gonna do anything except it's gonna create the stack and then, but this is how we're gonna make sure that it thinks it could do everything it's supposed to do. Oh I think II I took out all those uh the node modules, I think. Oh OK. So you need to do uh N PM install which you, I think you're gonna need to do inside the Infra folder. Yeah, you're in. Yeah. Am I in the right place? Oh, so it does let us. OK. Interesting. Oh no, that's perfect. That's perfect. No, you, you're right. You, you did it right. Yeah. Don't uh you don't need to. That's, that, that everything worked the way I expect. Say no OK. Cool. OK. Good enough. All right. So now let's go ahead and maybe start working on our Pulumi code. The other thing though that you're gonna need to do is we need the Docker, um, provider. So, right. We've, and you're gonna do that just with a good old N PM install or it says N PM is what we're using. Right. So there's do N PM install and just, it's at Pulumi slash docker, uh, forward slash Docker. Yep. And that should just add the Docker provider, uh, that, and then it's gonna take it a second. Cool. So now if you were to go back and take a look at your package dot Json, we should see it has Docker in there, but if we go into our index dot Js, um, all we've done there is that we haven't, we aren't using it yet though, right? But it's gonna enable us to do that. So, um, so just like you've created that constant for Pulumi, um, go ahead and create one for Docker. It's gonna look the same, right? And that's gonna let us refer to, you know, darker as we need to. Um, and then are there. So if we think back to the couple of things we need to do, um, maybe we can sort of build this slowly, right? Um Maybe the first thing that we wanna do, uh, go ahead. Ok. And you know what, go ahead and grab that A P the, your two code directories, your API and your U uh and your U I directory and copy them over into here but not in the infra folder. They should be at the, at the root cause they're Yep. So let's uh let's go. Let's copy dash R, oops, dash R. It's up. Uh We need to go again and then entity. Yep. All right. Let's do API and we'll do API all right to move a folder. What's that? Uh It's too late. We'll see. OK. Let's just make it, let's just make it sure. My my Yeah, there we go. Ok, cool. OK. To do a folder, right? It, I always forget if you need to name it at the end. If you could just like do instead of doing the U I here, if you can just do that or you have to do if you do the Yeah, that it would dump all the files there. And so come on Macbook pro. So I'm gonna ask you a couple while you're thinking about this a couple of questions. So uh presumably you need a Docker network, right? Like your docker files created some kind of a network for your things. So we'll, we'll do that. Um I want you to think as well. Are there any any like kind of uh port variables that we're passing around or something? Sometimes we might want to set those as variables instead of hard coding them, but we'll do this one thing at a time. OK. So theoretically uh oh you did something wrong there? Am what's in the Infra? Folder. Yeah. Ok. Yeah, you need to move them up. Uh That would be MV. You need to do dot slash API I think. Yeah, there you go. Uh No, you could just do this in vs code if you just want to drag and drop it and be done with it. It's ok. I, no, no, no, no, no, no, no. Go back to your, go back to Yeah. Where are you at? What, what are you doing? OK. Wait, no, you're still in your entity manager. Where's your OK. Yeah. Expand out the Infra folder there and then just grab those and just drag them like all the way down. It'll bring them if you drag it down below Pulumi dot Yamma, it'll move them up to the level you want. Yep. Just like that. Yep. And then do the same thing with, with U I. OK. OK. All right. Let's go back into our fold. OK? Everybody happy. Yeah. Thank you. That was, that was just, let's do it the easy way. It's OK. All right, cool. All right. Let's create a doer network. OK. So um just give me a second. So you're gonna um hang on. OK. So you might say uh so you're go first, we're gonna want to create, so like you're gonna create a new, so you might do um you're gonna create a variable called uh network. My, my camera decided to stop working on me. Totally fine. Um What did you want to do so, so say like, uh let's network. Now, your type of head should help you out here as we go. That network equal. Yeah, that's right. Well, now it won't because that's a variable name equal. Uh, and it's gonna be a new and it's a, uh, just based in Docker and now you should be getting, uh, there you go. And it's a Docker dot Network, that upper case network. So you can, you can, you got your type ahead. Oop and then go ahead and then, yep, in and then, uh, we're gonna call it, you know, it's the name of its resource. First thing is its name within Pulumi. Um, so that's just a string, just call it network and then after that, uh, end quote, do a comma. Yep. And then do a, an opening curly and then hit, enter just to get on the next line. And then now we're gonna say name colon and it's, and then, uh, in quotes, name it services maybe or whatever you want to call this network, whatever you would call it in your case. Let's do, do the data network. Sure. And then, you know, put, give yourself a little comma after that, that guy and then, uh, semi after the, um, the bottom. So what we did? No, no, no, no, no. Uh, you don't need, you don't need that colon there. You get rid of that. Ok. So all we did there is we created a new network object, right? It's called network. And the parameter is is data network, right? OK. So it's gonna let us refer now uh to this, this network uh later if we need to. So the next thing we could do, if we sort of think about it, we might want to get the images of the other like the mango like and you're kind of doing this in the order, you might be reasoning about them. So um maybe the, the mango image might be the next thing we do. So go ahead and do you know, let and call it like mango image, you know. Uh And this is gonna be uh it's gonna look very similar. It's a new Docker dot Remote image. OK? And then following a similar format call it, you know Mango image because this is, this is how it's referenced within Pulumi. Then if you go into the curly, it'll give us our parames. So its name is gonna be again, you know, the, the, the identifier with the tag. Um So if you're doing mango late again, I don't know what your uh it's in your Docker compose in the other one, right? Yeah. Oh There you go. Yeah. So uh we'll do 428 and you can um you probably want to add another parameter which is keep locally and you could set that to true. Um Which oh if you, if you went to that it was gonna tell you what that did, but you might be able to tell people what that does because it's, but if you start typing it right, it's uh basically, if you do a Pulumi destroy, you might not want to keep it locally. So when we do a Pulumi destroy, if you don't say keep locally, it'll actually delete the local copy of the image. I got you. OK. Um But you, you know, generally speaking, you probably keep it around, why not? Right? You know, just cheap. Um OK. So, and then we might want to create that container for the for mango. So now go ahead and let container, we'll call it a mango container because we're gonna have multiple, you know. Yep. And then this is gonna be a new, I bet you can guess from type ahead container. Uh-huh and then give it the name, same thing Mango container and now go ahead and set image and in this particular case, you're gonna say, so you have the image and you'll do mango you. No, no, don't put it in the string because see we're using a programming language here. So now you can refer back to that Mango image and then do dot latest, you know, it's of the of that, you know, um go ahead comma and then we're gonna set the ports, right? So uh what is it not like about latest? And I don't know, it might actually probably are OK. With just mango image, I don't think you actually have to set the parameter. Um OK. We'll find out. Now, go ahead and, and say, you know, do the ports and then this is gonna be uh in a way to do your, your square, you know. So remember there's gonna be those but you're um uh yeah, and then uh go ahead and hit just to keep things clear, hit, enter here. Uh But you can't really, yeah, because you need to put them uh because it, it's pat. Oh This is, that was red, I'm sorry. Mango does it don't take uh how do they refer to as internal and external? Right? So you'll set, so if you go into curly braces now just do a curly and then space and you can say internal colon and then that port and then do a comet external and then the port, right? So what you can do? Um Yeah. Yeah. And then, oh I just, oh because you didn't, you don't have OK. And I think that works. Yeah, it shouldn't, it should be a number, not a string. So that's fine. Put a comma um And then are you doing anything? Are you aliasing this anywhere? Uh Yeah. Uh You know, so, so when you're un composed, it'll set up the network between the, these two services. And if you can reference one network, you have multiple networks. I do but we, we can use one. OK? We'll just do but you still want an alias for this container. Yeah, because I, I can I refer to it as DB. OK. Perfect. OK. Good. Cool, cool, cool. That's just another parameter. So go now after that do a comma and then do networks advanced is this uh which you should get the type ahead for? Yep. OK. And then it's gonna be the same thing where you're gonna go in your square and then uh go ahead and hit a curly and then do name colon network dot name comma aliases colon and then um in, in a square. Put your um oh I'm sorry. No, no, no, no. Give, get rid of. Yeah. And just do aliases, do do the square and then put the string in there that you want do square. Uh Yeah, but you just around that with square braces because it could be an array, right? Or it could be a a and after that put a comma comma after that last square dude. And you're good. OK. That gets us our mango container and our mango image. So um which lets us refer to that. So let's go ahead and create like, did you have any, what else came from uh remote images? Anything else? Uh OK. Cool. So we're ready to build one of yours now? Cool. OK. So go ahead and do you know let uh which one would you do first API or, or uh U I see the API because the U I depend on. Yeah, perfect. Then exactly. So say, you know, let um API image and it's gonna look very similar right to what we did. So you're gonna say equals new Docker dot image this time. OK. And you can call it same thing. Its name will be API image inside there and then comma open curly's and now would you build colon? No, no, no. Yeah. OK. Sorry Yours. Yeah. Uh And then this is gonna be another uh set of elements. So do an open curly brace enter and then do context colon. And I bet you you can guess what to put in here in a string. Uh Well, it's gonna be in a string. The whole thing is a string but you need to do dot dot slash API because remember OK, we're in, we're in infra, right. OK. OK. So then after that curly brace to a comma that's the only, the only thing. Yeah, you can just, that's the context is the only one that we're doing in there right there. And then do, but, but a comma after that curly brace because we've got a couple more parameters at the same level as built. Um So you're gonna do image name and I believe that will be a string. That's API is the name of the image, right? Or at least that's what we're gonna call it, right? And then you probably want to skip push because you're not gonna, so if you look at what skip push says it's gonna do and that should be true. Yeah. You just because you're, you're, yeah, we don't want to push this anywhere, right? And so that's just plain old. True. No string. No, nothing. True. Come. Yep. OK. Cool. And do you um OK. And then do you have to pass anything to it? Uh So when we create, now we're gonna create the container. OK. So we have to pass this in for the build. I have to pass the AR OK? Um React. OK. So let me hang on, give me one second. I'm gonna pull up. Now. We maddie, we can cheat for a minute. I can go put this. Why don't I put this in the Docker file and then, and then we come back and play around with you because I want to see this kind of go right. You know, and then there's, there's definitely places where we um oh you know what? And, and we're doing the API I don't need an API right now. I, I don't need to pass anything for the API oh The API I don't have to pass anything. OK? So would, and can we test the API without the U I? OK. Save this file obviously. So we wanna make sure we're saved. OK? Go back to your um terminal and let's go ahead and do a Pulumi up. So type me in here. Uh it should, I think it'll, you know, you need to be in info because that's, I think where, where, where did you run it the last time? Yeah. I think it has to run inside in for. Yeah. Yeah. Yep. So, do you pull me up now? What it's gonna tell us here? Um, it, actually, it, it's funny so it didn't do anything even though it thinks it looks like because you got a bunch of Docker warnings. So go ahead, you can't see this on the screen. I apologize because it's behind Peter's name, but there's a choice under no that says details. So go to details and that's gonna tell us everything that it's gonna do by specifically if you were to run a plume up. So a couple of things that are, you know, so it's gonna create a stack, which is called DEV because it doesn't exist yet on the Pulumi service. We're gonna see that it's gonna create those images. It's gonna create the network. So if you ever want to know exactly what it's gonna do, details will do that. Yep. And so go ahead and say yes, we want to perform the update and let's watch what it does. Mhm So we can see, OK, it built the image. OK. Oh Something. No, it bailed on something. So this is one of the bummers of just sort of how Docker reports stuff back to us. We, we have to stroll back to see the error. OK. Um Let's see, unable to to create container. OK. What is the mango container? Maybe that image is not, I mean we can do latest um I'm wanna try one thing. OK. So wait, so that's on container, right? So let's see. I just wanna make sure that was um the idea of the back. OK. Yeah. See what it, I mean it shouldn't be that I mean that that that container image should exist. Yeah, because I I've pulled it 4.28. Yeah. Yeah. So uh OK. Go I'm I'm wondering if it's when I pulled this instead of that, you know how we would have uh for the con is it where's the error? It was unable to create? OK. So it's trying to create the container. It didn't want to pull that image. It could be because you already had it and it was super old. I don't but I'm wondering about that. We had that dot Latest on the image. So that's why I'm trying to figure out why yours. Let's see. So it takes image. I'm just looking at the API um wait, am I not on containers? Me too. Yeah. OK. So in the example if I took, if I if I take the tag off of the image and just said mango. Yeah, I got a a warning but seems to work. Uh but do you though this part will work? But it's when you actually apply it is when it had the problem. So go ahead and remember it was Yes, yes. Image build succeeded. No, that one was fine. It's the mango one. That's the next one right where it's and it's the container. Not the image. I'm just trying to get us in a good. No, no, no, no, I'm with you. I'm with you. I'm just, I'm just sort of narrating what's going on a little bit. No, no, I got you. Oh OK. Unable to create a container with image. Air pulling image. Uh What if you do me? A OK. Um What if we get, what if you whack your cache copy of that image? Yeah. Of the Margo one. It uh let me just do that. OK. Oh There see. That's weird. Did you see that? So there I, now there's the latest. It did pull it right? Because I, I took out uh I took out the and then ran it. So I pulled the latest but it's weird. It's um let's skip, get rid of him and then let's get her. What was it? 428 ah oh or PS dash A uh that's running. OK. Let's, that might be it right there. Let's remove that chef. Let's just stop everything madu and up. Yes. Images do it again. Oh Dark images. OK. I was let's um gonna remove Yeah dash F. There we go on. OK. Should I, should I just, I'm gonna remove all these images and then we'll just let her Yeah. Engines right by the way, when you're ready to do your Pulumi up, do Pulumi up dash Y because that'll just apply it when you're ready. Yeah, when we get to that, that'll skip us having to go and say yes, I missed that. Oh, you were answering a question? No, no, no, I was just telling you. I was just uh sorry, sorry because you don't see the chat. Um One of the there you go. So when, when, when you're ready to run Pulumi up do Pulumi up dash Y and then that'll, you know, that's YOLO. So that, that way we don't, it won't, it'll just go ahead and apply it since we know that's what we want to try to do. Um OK. It's creating the container. Oh That's looking promising ish come on mango image and I can, I also have it. Uh It's just a quick flag in the code that I can um change it to. No, no. OK. No, that worked. I think it's hard to tell because of the, but it did scroll back up to make sure we didn't hit an error. Make sure, you know, because because again, normally you'd see the out no update failed. OK. Error pulling image. So it's something in, I go back to the Pulumi code for a second. I can kill that too. By the way, we could take mango out. I know, but I'm trying to figure out why. So when you create a new Docker container, new Mango image. Yep, that's the image is Mogo image, which is the Docker remote image that we pulled. That should all be fine. Um I had some, the worst part is I was just playing with this. If I can find my code, I was doing exactly this but in Python recently, but it should be the same thing. Um Go ahead and, but just for fun of just to see how it builds your thing. Go ahead and take out, you know, like just comment out the mango contain the whole mango container part and let's just let it build your, your image. OK. Yeah. And just to pull me up, pull me up. Yep, that's fine. Which doesn't depend on anything, right? So it was or no, it, it uses, yeah. So your API built but there's no way to see what it does, right? We can, we can run it. We should get um so you should see it running, right? So if you look at your, if you look at your running containers, right? Yeah, I think we have um yeah, we don't have the connection string in there. So if we don't have the connection string, it doesn't. Right. Well, well, the connection string is what? Yeah, is what takes it to Yeah. Uh Got it. OK. So I could run it, test it. Do I run it in a container? Or Yeah. Yeah. And then what we can do. Yeah. Uh well, no, it's running right. Yeah. You, you read the contain that that's what we did. So, but how do you? Yeah. Ok. And, and we're running on we do we expose the port. Uh I don't think so. No. Yeah. Ok. Let me see. Let me see if I can mess this up man. Let me see. Port. Oh we know it's above uh Is it the same as here? What's it? Is it the same as? So if you're gonna, if you're gonna, you've got the app? Uh Well, that's just the Oh no, no, we never ran the container. We just made an image, we just made an image so it didn't do anything yet. Cool. OK. Well, let's do that. Yeah. OK. Let's see if you can do it. Let's see what happened. Oh no, no, don't call it. Yeah, there you go. Yeah. Docker container and then we'll go API container not square. OK. So this is why I think there's something squarely with the because like what you should do here is you should do image and then it should be a API image OK? Do this do API image just hit dot What does it give you as autocomplete? So you should have base image name, right? Yeah, so I don't Yeah, that's cool. OK. So actually go back up to the select base image name like like that is now just stop where we are for a second. Go back to Mango to the Mango one for a second. I think I wanna fix this. OK? Un uncommon out that block. OK. And then under image where it's Mango image line 16. Remember we had had it as dot latest. So go go to Mogo image and hit dot And what are our choices on the API force ID? Why is it, I guess try image? Oh yeah, it is. I mean that is that that'll be it. Yeah. OK. Uh Was it lowercase image? Uh I think so. I no it oh we got two both. See. Yeah. Try the upper case one. That's weird. OK. Let's see what happens. OK. Um Anyway, go go don't, don't, don't run it, go back. Let's finish up your I know we're changing two things at once but we might as well finish up this. OK? So you're gonna have you got your base image name comma uh Now do your ports just like we did the mango an array, right? Mhm Inside curly then. Yeah. Yeah, you could just copy that and change the ports and then if you, oh you need to tell it the network as well, right? So you're gonna go ahead and do that. Um Did you? But if you do networks advanced, all you need to do there is just set the name, right? So do networks advanced and then just do name colon network dot name for now what you could do as well. That will be interesting. Um OK, after the so just do the after your square brace there. Do a comma. Now watch this this fun part here. Um or I'm sorry, do you need to do this after? Yeah, after your square brace. Now after that curly, you've got the curly that's coming off of API container. So line 41 like put between the curly and the per put it a carriage return or no, I'm sorry, put a comma don't go unc carriage return that sorry, put a comma space. Now do curly and say depends on. So depends comma an colon and then in square braces mango container. Yep. OK. And then I think that's good. So that will tell Pulumi don't try to launch this container until the mango container is up. OK? Makes sense. Yep. OK. Theoretically this might work. Let's find out Hollywood stars and celebs. Do they know things? Let's find out that was a little deep uh deep Netflix cut there. If anybody got that joke, let me know. OK. Um You got it. No, no. OK. OK. Missing property image. OK. We're it should tell us a new container index J so it's line 15, right? I think so. OK. Let mango container image. Maybe it's not, maybe it's lower case. What was it again? Yeah. Yeah. It's just saying it says it's oh image. Yeah. Yeah. Yeah, that's Yeah. So that's oh Yeah, I think engine might be right. It might be the ID. It might be ID. Uh, so go back. Yeah. Yeah. Yeah. Yeah. I think it's like. Yep. Yep. Ok. Try that. There we go. Yeah, there we go. Yep. No. Uh, it still doesn't like to pull that one. Ok. Go ahead and just for fun. Comment back out the mango container stanza or, or block. So we don't do mango anymore. No, no, no, no, no, no, no, no, no because the problem isn't the image. The problem is it's trying to build a container. It's not finding the proper name. Yeah. So com comment that one out just we're gonna go back to building just yours and then now the only thing I want you to do is take out that depends on because obviously it won't ever get anywhere because it depends on something that doesn't exist. So just go from there to there. Yeah. Yeah. OK. At least this will build your your container and run it and then you should be able to. Mm OK. That worked. I believe so. Now you should be able to Yeah. Now if you want to be really slick, go back to your Oh, well, so you, you don't know you don't need to. OK. So if you open it, if you do your local host on the app, right? The port? Oh yeah. Is it not working? 00 our port didn't get OK. Can I see your code again. Uh-huh. Ok. Wait, let's see. So ports internal. So you're exposing through 80 80 is it ports or port ports? That would be wise. But now, now, now, now wait, I'm gonna, I'm gonna uh be clever for a second. So don't yeah that that's your, that was your problem. But now right before you um do the eight. So like line 32 do a new line in here, we're gonna set the external port as a variable because we're gonna do something clever with it. So just say let my port equal 80 80. Yeah. OK. Now instead of 80 80 down there. Yeah, make that be my port. But the reason you should set it for both maybe but but we're not, we're not gonna set both. Now the very last line, sorry, all I was saying is you would probably make the internal port of variable maybe but you don't need to. But here's why we're gonna make the export port of variable. OK? Go to your very last line. I want you to say, oh and I have to remember how to do an export. I think this will work. Um Hang on for javascript inputs and outputs. I've done inputs and outputs and javascript. So bear with me for one second to remember how they work. Um Let's see if we're gonna do. Um So I think you're gonna just say, let's see. Uh because here I know how I want to say OK, try export. No, no, just do export. Oh OK. And then do let export space except I don't think it doesn't like that because it's not uh I'm trying to remember how to export uh from javascript because it's different in typescript, how you export the output of um you mean like the module that exports? Was that what it was? Well, no, no. What I'm trying to do is export the uh the value of the string. It's just gonna give us the URL you would load. It's just all it's gonna do is interpolate. Um So actually I I'll give it to you in a second. Hang on. Um Oh, just to um do exports dot Sorry, sorry, I remember how to do in javascript now. So do exports dot URL equals Pulumi dot interpolate. OK? And then do back tick. Http. No, no, no back tech. Not, not backslash uh http colon slash slash local host, right? Because that's what you're hitting and then do colon uh dollar sign um squiggly, you know, curly brace, uh API port and, and the curly brace and then do the back tick and then close that right. OK. Cool. And put your semicolon after that right at the end of the line. OK? Save that. Go ahead and run Pulumi up and that's the last thing we got. But you're gonna see one interesting thing theoretically should happen. Yes. OK. Cool. So it gave you that URL. So do you remember? So now if you were to say curl um and then do um um oh I just cleared the screen. Yeah. No, no, no, it's uh uh yeah, sorry. Uh Do uh so you do curl space a dollar sign per Pulumi space stack space, output space URL and then N per that uh Pulumi dot No, no, no, no space. Those are all spaces. Pulumi space stack, space, output space URL and, and hit, enter. Um, see that. Oh, that, that's, uh, I think that's fine. 00, you should get a 404. Yeah, because can I, can I do this and do services? 00000. yeah, that should work. Yeah. Cool. Awesome. Well, that brings us to the end. This was a lot of fun. Peter. Um, where can people find you on the internet? Uh Best place is either, um, best place is Twitter. Um mckee. Yeah. Awesome. Well, thanks for coming on. We'll, uh, we'll do this some more and, uh, everybody don't forget to if you're on Twitch. Uh smash that follow button if you're on youtube, like and subscribe. That's how we, that's how we do things and we'll see you this same time next week for some more Pulumi vision.

---
