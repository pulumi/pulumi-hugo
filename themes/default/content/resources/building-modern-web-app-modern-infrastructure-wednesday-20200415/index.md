---
preview_image:
hero:
  image: /icons/containers.svg
  title: "Building a Modern Web App | Modern Infrastructure Wednesday 2020-04-15"
title: "Building a Modern Web App | Modern Infrastructure..."
meta_desc: |
    In today's episode, we are building a modern web app using React, AWS API Gateway, and Pulumi. Code for this episode available here: 
url_slug: building-modern-web-app-modern-infrastructure-wednesday-20200415
featured: false
pre_recorded: true
pulumi_tv: false
unlisted: false
gated: false
type: webinars
external: false
no_getting_started: true
block_external_search_index: false
main:
  title: "Building a Modern Web App | Modern Infrastructure Wednesday 2020-04-15"
  description: |
    In today's episode, we are building a modern web app using React, AWS API Gateway, and Pulumi. Code for this episode available here:  https://github.com/pulumi/pulumitv/tree/master/modern-infrastructure-wednesday/2020-04-15  The examples are in TypeScript but Pulumi makes it easy to stand up infrastructure in your favorite languages including Python, JavaScript, Go, and .NET - saving time over legacy tools like CloudFormation and Terraform.  https://www.pulumi.com/docs/get-started/?utm_campaign=PulumiTV&utm_source=youtube.com&utm_medium=video  This is the first part of a multi-part series.
  sortable_date: 2020-04-16T19:24:20Z
  youtube_url: https://www.youtube.com/embed/3kVJaF9eU9M
transcript: |
    Hello and welcome to Modern Infrastructure Wednesday. I'm your host, Lee Zen from Pulumi Corp. Today we're gonna be talking about building a modern web app. This is the first part of many parts. I had a recent request on one of the youtube comments, asking to build a longer kind of more in depth example around building a web allocation with a front end, a back end, how to hook up all that infrastructure, how to actually have the API talk to the, the front end and, and all that jazz. So uh we'll be walking through this in multiple parts today. We'll be going through uh the first section of this which is to create a React application, uh publish that react application to AWS, you know, just hosting that statically uh connecting that application to a domain name. And then in the next parts, we'll then focus on how to actually build the API hook that API up to the front end and then have that front end actually make rights to a database. So yeah, let's just get going. Uh So I have a terminal window open here. Uh We're gonna first uh do our typical Kami New. I'm in empty directory right now. So we'll just go with the defaults here. We'll call this, uh, a modern web app, why not? And sure we're on the DEV stack and we'll stick this in the US list two. So I actually blown away a lot of my node caches. I think. So, this probably can take a little bit longer, um, while that's installing those tendencies, we can, uh, actually jump into um next Ts and we're gonna blow this part away. We don't need any of that. Um We're also going to uh create a React application, right? So we can MP X create the React app call this just an app. And all right, let's see how long this takes. All right, let's take a while. So let's while that's going on. Uh We can kind of get our infrastructure set up. Um What we're gonna end up doing is we're going to build the app and then the application is going to, you know, we're gonna have a way to uh make a production version or build a version of that app and then that build version, we're going to want to then uh push up um into Aws and then have that uh served. Um We're gonna use API gateway actually because that way that allows us to then later on add on the other routes uh that we care about from an API perspective and then we can hook that API gateway up to a uh domain name. So we're gonna try to do most of that in this editorial in terms of the, the actual setting up. Um A lot of the actual setup on the um API gave stuff is, is actually a lot of our examples. Um So we can actually kind of just copy and paste on some of those uh if we want to be um expeditious about it. Um But then otherwise, um uh you know, we'll just be walking through kind of a lot of the setup here. So let's, let's do that. So, uh first, let's actually make sure this React App stuff works. So let's the yarn start and let's see if this actually just a web server and this should hopefully load up. OK, great. So that worked excellent. So let's pull this. And now what we're gonna do is we're going to uh actually uh build and then that's going to actually create a, that should create a directory that we can then deploy from. So, um you can, let's look here, so you can see that we have this build and then this is, this has everything we want. Um That's, this is our, this is our quote unquote production build. So let's do that. So what we want is we want to create an API gateway and let's do that first. So let's call it. Uh Yeah. Uh Let's see what we want to give it. So we want to give it some routes. Um, and they believe it should be an array. Uh, and we're gonna give it our first route, which is just a local path. Uh, so this, you can see here on the, on the, uh, the docks here, it says we're gonna, uh, point to some local directory. So, uh, in our case here, it's going to be a build. Um, and then the, the path we actually care about on the web server side is gonna be slash um And we'll see if there's any, I don't think we need anything else here. Uh I guess give it yet and we don't need, I don't think we should need anything else. So by default, it's conserving except smell, that's what we want. Uh We don't need any of the request for stuff. We maybe later on if we have time. Um As I go through this multi part series, we can add some, uh you know, authorization and things like that. But for now, let's just see if this works. And so we wanna get the um, a Pisa you were all back. Um Oops, is this, so let's see where we are now. We're in app. So we'll come back down and uh we will plu me up and let's see if this works. So, what this should do is it should take the local path, which is the production build I just made. Um And then put that into an API gateway with a path of slash and, you know, allows me to get any of those objects. Let's see this, I'm going to create all these objects which looks right, uh, with the API and, um, yeah, that looks, that looks good. Let's try this. So. Yes. Oh, just that fewer issues, huh? Ok. Well, let's try, let's try this. Um, let's try actually just going ahead and adding, uh, the rest of the things. Uh first, um, even though that might not be the best since we actually don't know if this is working correctly or not. But let's, let's at least try adding the domain name uh to see if that works as we would expect. Um And then, uh assuming that does, then we can come back to see what's going on with these uh permissions issues. So, what we wanna do there is we want to actually, I believe if I recall correctly, uh The way this looks in, um, the way that this looks in in API gateway is you basically have a base path mapping to create that domain name. Um And that way you can end up uh um connecting that to, to a DNS. So let's go ahead and do that. I'm actually gonna look up a quick example uh to reference here. Um Let's go to the example and I'm having this on top of my head. Let's see, I believe we have a API gateway example here. Yes, see if this does what we want in terms of milk does not. Now here, maybe this one the six you get away does not. Let's let's go back. No. OK. There's no example like that. Just kidding. For some reason, I thought we actually had an example. OK? So we're gonna build this, we're gonna actually build this from scratch, which is cool. Um Let me just get something else open here. OK? So um oops, right? So we want, I believe yes, we want a custom domain name. So the base path mapping. So this will ensure that it's created. OK? So we actually use, right? I should just use an example here. So let's do this. Um So we're gonna copy most of this stuff. So we need this here, this domain name and we need that. So let's do this. OK? So we're gonna create this domain name. So we'll call it uh web app dot dot TV. And this actually expects a domain name and I believe, let's see, you can also give it a certificate. So we're gonna, we're gonna provision a certificate using um a certificate manager. So we've done that before in other examples. Um I was gonna put a thing here for now and how this, OK? So how do we get that certificate? So let's create a certificate and we're gonna actually have to create a provider in US East one because we want this to be global and, and for that to happen. It has to live in us east one to connect to cloud front uh correctly. Um I think let's actually try to see what happens if we don't do that first. Let's just try to create a certificate. Um But I think you do have to do that the way I described it, but let's try it so we can give it a domain name and then we want to validate that this, we actually have this domain name. So we will do a uh we have to get the zone. Um So we're going to give it the name of the zone, which is for the TV. So we can actually do something with it. We treat this asynchronously. Um And so uh we can actually do, we can actually turn this into an output so we can give this actually a promise like this. And so if we actually look at the type of HC ID, you can see it's a output of this zone. OK. Um And mhm I guess OK. So now it, so that what we want, this should be the zoo. Yeah, this is the string now, which is great. So this is the zone id has an output. So we can feed that into um our record. So we have to create a record to validate that we actually own this domain. So foundation record, I have to give it a name. So this will come from the certificate uh domain validation options. Um It's just the zero with one and it's gonna be the uh resource record name and there's a type and it's gonna be the same thing, but it's the resource record type. And then finally there's a value I would admit that the records, of course, the actual records themselves. No, I think this is just a list. This is about array. I yes, a ray of strings. OK. Great. So we just give it the actual um let me do this, it just certificate, work it out and give it ac tl give me 50 seconds. I'm missing something. Uh zone ID. Of course, we have to tell what zone it is. So we give that uh we had that earlier. All right. And then we can wait to see if that this is actually created so we can do a um and this is that special. I think we talked about this in a previous episode where we have a certificate validation. This is just a special record to tell us that um you know, we actually did have what we expect to see. We actually have this document actually has an example. We create the certificate. Oh Wait a good thing of this. We at this two R of then um we get the, we create the record, the record, the Vaid record uh like here. And then um then we actually go ahead and create this, this resource uh to verify that we actually have what we want. So let's actually just copy that and um here we can do and uh this is the uh previous um the validation right here. So uh we also, as I mentioned, we wanted to do this. OK? So let's basically make sure this actually works. So this should create the uh certificate we wanted, so we can use it for our website. And then we're going to uh get the zone that we're gonna stick that record into, let's say, take this wrong. And let's see. Oops, I had all this code down here that I haven't used yet. So let's fix all that too. So we have this and then OK, so now we're gonna do the uh actual base path mapping, which we forgot about. So this is the certificate, that's it. This is this the certificate dot A RN and we should also make sure actually. So we have, we need to actually depend on this validation uh to exist. So you can see here, we don't depend, we depend on the certificate. We don't depend on the validation having happened yet. So we need to actually add, it depends on the cause here. Yes, a certain. So what we're doing here is basically uh earlier we created. So let me just feel like we did a lot actually in the last couple of minutes, let me back up. So we created the CP I gateway thing which you know, we did a long time ago and we say, OK, we actually want to hook that up to a domain name. So I said, oh, well, to do that, I need a certificate. So I created a certificate and to prove that I can actually create a certificate for this name. I need to actually uh validate with DNS. So I go fetch the hosted zone and then I go create the record to prove that I actually own this domain. Um And we have this special handy thing that basically tells us that Yep, indeed, uh certificate manager has validated that it's issued certificate for domain. And then we depend on this validation before we go ahead and uh create this API uh gateway domain name. And then finally, we just have to map um uh we have to map this domain name. We call this uh web app for me called API gateway custom domain. And we have to map this custom domain now to our actual API because you can see here, there's no no mention of the API period at the very beginning. This is just a abstract custom domain you can use with any API uh in API gateway. So we'll call this uh domain mapping and we can point out the API we created earlier and should be the rest API. This is the id for the rest API and then we can give it the domain name. So this is the uh API gateway custom domain. And then this is the stage name of the API. So this is the API um stage and oh, this is not match, this is a string. This is the stage. All right. So let's see if this works. The only thing I'm not sure about, I think this should work. The only thing I'm not sure about is whether or not that certificate needs to actually be created in us East one for these domain name mappings. But we'll find out in a sec. I think. So let's see what we're gonna create here. We're gonna create the cert the record that validation thing and then these, these mappings. So let's say yes. So while we're waiting for, let's see if this actually does not fix itself. So I have to investigate that as I mentioned uh after this because I think it may also have to do with the fact that it's just coming in off of this path. Um And you can see this is not this, this is not really the slash. Uh this is sorry, the stat, this, the static stuff is not, you know, off that path necessarily. So that's the other thing to investigate. OK. So as I suspect that this has to be in Us East one, so let's go ahead and actually um let's fix that. So we have to create a provider that's in us East one specifically to do what we want to do. So us East provider, the region just right there and then we can feed this provider into this stuff. So here give it the provider Us East Fighter. And then here actually after three, always talks to the US East just because um and here this isn't not regional resource. So we should be able to do this. And now we should create the certificate in Us East. You can see this is the create for the one in the east. And then we've, we were had to replace all these things since uh we're changing the, the whole dependency chain there. Oh, ok. Interesting. I tried to just use the certificate before it was placed. Ah because I ok. So this, this, this is because this actually does depend on this new, this new cerf this uh this this new provider base. And so I think I should have actually gone and updated that to use the other providers. I think if I just do this, it should be ok. Should, yeah, this should be ok. Uh And so we can see now it's gonna actually try to do this replacement here. Let's see. Let's try actually doing this then, like I said, because yeah, that certificate validation actually has to, I see. Right, because the certificate validation is gonna talk to the certificate manager to verify that we actually were issued the cert so it does actually rely on being in the correct region. So that's, that's my mistake. I should have realized that earlier. Uh Now I should be able to actually determine that we were or were not issue the certificate and then uh proceed the execution as, as expected. So this is taking a while. I wonder if it's because I also, oh, there we go. All right. I was about to say, I wonder if it's because um I created that RD three record and so it uh it did not, uh it didn't um it was cashed or something like that, but it seems like that worked. So let's see if that actually let me, let me do uh web app dot dot TV. Oh, that's not what I expected. Let's uh do a quick look here. Right? That looks like, right? Those should give me back different IP S right. This is the cloud front distribution which by default directs us to our beautiful youtube page and this should be, it looks like an API gateway address so that I think should work. I'm not sure why. I wonder if my browser has the um you know, let's curl this ourselves. Oh, no, that's still give me the redirect. Interesting. Oh, silly me. I did all this. And uh I, so yes. Ok. I'm being silly. So the API gateway will accept traffic for web app dot Pulling me dot TV. But I actually never created the record without dot Pulling me dot TV. So we should go do that right? So route uh web app record, went down to put another record. Uh We'll call this the web app record and uh this time the name is uh web app dot dot TV. Believe actually this can just be this. Uh it doesn't have to be fully, fully qualified domain within the zone. It could just be the name within uh just the name. Um And then I will give it a second detail. Um And actually there should be an alias uh to the uh the API gateway. So uh the type is uh it should be an alias. And uh out here, let me see this flis with TT Ln records. OK. Right. So we don't need any of this um and check something else. This is actually an a record alias. Uh So let's see and we of course, don't forget zone id and that was the HC ID a bit earlier and here we actually, this should be in a ray, right? Um And we'll have in alias two the actual uh name from the A P gateway and I believe there should be uh something here for us. Uh It should be in the sorry, it should be in the um yes cloudfront domain name. So this is the distribution now that we use for this and then there's the uh zone id and that's the platform uh zone id and we obviously want to pass through the health of the underlying target. So, OK. So uh this is the record. I forgot that would actually route web app correctly. Um And what this is gonna do is it's going to point the web app record at the custom domain name we created um earlier. So let's do that. Now, does she create one record what she does? And I'll probably have to clear my DNS cache uh to make that work. All right. So let's actually take a quick look at the stack itself. Make sure this is what we expected. So if we look at resources, we should have this record, which we do indeed. OK. So now let's try that again. OK. Still, still cash. Uh Let's try to uh and DNS, there we go. Believe the pass. Go up as well. It's hot. Sorry, let me do it. Yes, let me do this. OK? I think that should hopefully do it. No, still doing that. All right. Took that record again. Wonder if the other TT L is really long actually. Oh, no, that was the, that's an A alias as well. That should be 60 seconds. TT L there should be 60 seconds tt L that actually should be pretty straightforward in terms of how long uh TT Ls last. And yes, this is a wild card, but the more specific name should always win over the wild card. At least that's in principle how um we have to do should work, but that did not seem to be doing what I wanted to do, let's actually go back and try to use that platform distribution directly and see what happens. So we have this, let's see if we go to this. Yeah. OK. That's what I expect. So this is, this is the API gateway and you, we go to like, you know, stage um I'm not sure why that doesn't work, but I would, but this actually does do I think it does. I wonder if, um, come back here. Oh, I wonder if this is not this, not this mapping of the stage name. This is all right. So this should point me straight at the stage and I shouldn't have to actually add anything additional to the path. At least I don't expect it to um, double check that. Oh, wait, this is the interesting we indexed the uh dot net documentation there. First. See, did this, did this. So our stage name was, you know, we actually gave it the stage name and don't think I need this. I don't, shouldn't need the deployment because I it's already deployed. Um Let me check that as well. Yeah, there's a deployment that's part of it that we do that as part of AWS X. So that, that should just work. What if it's just cashing? And I'm just having a weird day. No, it's not it. Oh, I wonder if I just realized that that the previous response was a, let me just do something in private browsing Here, there we go. OK? I said I knew I was going crazy. I was like, II I had, I, I realized what happened was um my browser had cash the 301. OK. So now this is yes, of course, Lee browser cache exist also, right? Um So yes, the brow the browser had cash the 301 response from the previous time I chose to go to web app dot point me dot TV, obviously in an incognito session that is not the case, we don't have the same cash. Um So, OK, so this is doing, this is doing what he expected it to do so great. Now, we are actually at the end of where I was hoping to be at the end of the day. Um Sorry, it took a little bit extra time to get there. Let's just review the roundabout way in which we got there. Um Right. So uh what do we do? We first created this API gateway which uh creates this route that maps the local build path. So we, we actually did very little reactivity. You'll recall at the very beginning, we did uh the NPX to create React app and then we went into that directory and then we, we ran yarn build, which created this build directory with the application fully packed up. Um That then uh allowed us to shove this, basically, this, this using AWS X automatically just puts this into an S bucket and maps the slash path to that bucket for us. We then created a certificate using the US East provider that we created so that the certificate exists in the US East one region. And then we validated that we owned that uh domain name with AC M so that it would issue the certificate to us. Uh And then once the certificate was validated by AC M, we were able to map that certificate onto a custom domain with API gateway map that custom domain to the API that we created. And then finally, the step I forgot which caused all the issues because then I ended up cashing uh the 301 and everything. But then you finally um create this rough D three record which points the name you, you wanted web app at the actual uh custom domain name uh that we created for the API gateway. And so at the end of all that, we can actually export uh the uh the name here uh though we actually constructed it by hand. So we actually know what that is, but we'll, we'll just um uh we'll do that anyway. So we'll call it the actual site ur so we'll call this the API URL and we'll export the site URL to be um the web app record QDN. So, and we'll just do uh pull the triple eight Right. So let's run that and then while that's running, let's, oh, let's do this, you know. Yes, we can see the API U role is that thing. And now we have this which gets us uh oops, this is the not in the right browser window but in the, in the incognito browser window where I don't have that cash, we have this. So um let's actually go and make a change and see that works real quick. And then, and then we'll end uh we'll end today and then we'll um continue on uh uh next week in terms of modifying this application to be able to do something interesting with state and then uh create a API uh to handle taking that, that web apps, um that web apps API call and then we'll plumb that through to uh actually managing the state uh in, you know, dynamo or some other underlying database. So, real quick, let's go and uh modify uh the uh file here. So it says, hey, save. So we'll call this, you know, I made a change. Um And it'll go to this and build and you can imagine totally automating all the stuff I'm doing here, right? Like we can imagine, you know, in AC I CD environment, it will just run yarn BUILD uh from this directory and then it'll then do a pull me up after the yarn build is done. Um And then, you know, it'll then say, OK, here are the things that are changed and what we need to actually uh obviously, as you can see, it's exactly that what it's doing is saying, OK, these, these things change within the bucket objects and we're going to go upload those things. So we have three new files create, we have to update and to delete. Um And so it's, it's pushing the new, the new changes and actually we actually delete the old files that we no longer use, which is pretty cool. Um And if we reload this, I made a change. Great success. Cool. Uh I hope you enjoyed watching today's episode. Uh next time, like I said, we'll, we'll go through the rest of, of the example uh as far as we can in terms of hooking it up to uh an API gateway uh on, in terms of the, the actual Lambda functions that we used for um for the web app. Hope you enjoyed watching today, please follow us on Twitter, subscribe and like this video. And as always, please leave any comments for future episode ideas or uh whatever else you want to, to talk about. And of course, if you want, you can find me on Pulumi Slack channel as well.

---
