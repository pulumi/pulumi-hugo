---
preview_image:
hero:
  image: /icons/containers.svg
  title: "PulumiVision - Testing With Pulumi"
title: "PulumiVision - Testing With Pulumi"
meta_desc: |
    "Learn about Pulumi and Infra Code in our live stream series. Join us every Thursday for insights, demos, and more. Follow us on Twitch and YouTube...
url_slug: pulumivision-testing-pulumi
featured: false
pre_recorded: true
pulumi_tv: false
unlisted: false
gated: false
type: webinars
external: false
no_getting_started: true
block_external_search_index: false
main:
  title: "PulumiVision - Testing With Pulumi"
  description: |
    
  sortable_date: 2021-11-05T08:05:18Z
  youtube_url: https://www.youtube.com/embed/G2Jz82UgGIw
transcript: |
    Here we are, Laura, we're live. We know that because it says live, live and like, so like your head except live. Oh, we got a couple of people who have already tuned. We got two viewers. All right, cool. Awesome. Well, I guess we just got to get, get this stuff started. Um Welcome to the first episode of what I Today am calling portions. Um This is subject to debate. This is uh we're gonna be doing these live streams, uh pretty much about once a week shooting for about the same time every Thursday. Uh We got a bunch of different ideas of things we're gonna do. Um Mostly gonna be learning about Pulumi but uh maybe some other Infra Code stuff, some other dev stuff. We're gonna kind of see how things go. Uh My name is uh Mattie um Matt Stratton. I'm a developer advocate here at Pulumi and joining me today is, and I'm Laura Santa Maria. I'm a developer advocate here at Pulumi as well. And there are two dogs that probably will eventually cross the stream. There's Duke right behind me in the scene over there just in case people need to know who's here. So, so we're doing a little experimenting with the stream. So we like, we'd love to hear your input as we're going as well as we're trying things out. So we're streaming this to Twitch. So you can always uh follow us on Twitch dot TV, B slash Pulumi uh ring that bell, smash that button. Whatever the kids are saying, this is also going out to our youtube live, um which is where that is at, youtube dot com slash Pulumi TV. I think Plume V and somehow we're tweeting this and I'm not sure what that means. Um But uh rest says that I can uh send it to Twitter. So, in fact, actually, I'm gonna take a look at uh this will be an experience for everybody. No idea what's about to happen. So, um oh no, I, I see it right now on my look here like I can see that. Wow, that's super meta. OK. Sorry. Um We're not gonna anyway, anyway. Good deal. Uh Y'all aren't here to hear us. Just talk about uh our streaming capability. Yeah, youtube is good, you know. Uh And then like, uh you know, mash the button on all the things we're, we're, we're trying to meet y'all where you are. But, so here's like kind of what we're gonna, we're gonna uh talk about today. So one of the things that's awesome about when you're using something like pluming where you're writing your Infra code uh in uh an actual programming languages, we can do all the cool things you can do with programming languages. Like one of those things is testing. I want to think a little bit about Infra testing and we're gonna, we're gonna be very exploratory. This is not slick demo time right here. This is uh Laura and I kind of decided we're gonna go through the testing guide on uh the plume dock site and, you know, see, see where it gets us and maybe, you know, kind of try some, some different things ourselves and uh see where we go. Um The, the thing when we think about testing is there's like, you know, we could talk about testing pyramid and stuff, but we're gonna kinda talk about um it from the Pulumi standpoint, like on our testing guide, we're kind of thinking about different styles, right? So there's unit tests, we call them property tests and then integration tests. And if you want to kind of see what we're talking about here, you know, if you go to uh the docs testing, you'll kind of see what we're gonna be working through today. But in a unit test, we're just sort of looking only it's, you know, you might say it's an in memory test, it's just the code, like it's not actually running anything. It's saying if you were to run this is what we expect to happen, but I'm not gonna actually execute and provision some actual infrastructure. I'm not gonna spin anything up and do a thing. Um And they're really fast because they're all in, in memory and you're gonna write those in whatever is the language of your plumbing program. If you're writing a plumbing program in Python, you're gonna write the test in Python. You're specifically talking about unit tests. I do want to clarify this is unit test only, you know, property tests and integration test, do provision, real infrastructure. So yes. Right, exactly. So, uh and one of the things that's interesting when we start thinking about unit testing uh for Infra Code. And some of this is me thinking about when we used to do when I used to do stuff with chef and everything. A lot of times people would want to write unit tests that we're fundamentally just testing the uh the tool itself. So like let's say that I had a chef recipe that just did a it installed a package just installed. Um uh I almost said engine X but NX is actually uh screws this up because X or no engine X would be fine. Let's say I was gonna do package install, you know, and then I would, it would be a one liner of chef code that would install that package and then I would write a unit test that would say would it install that package? And you're like, you know what, you don't have to actually test that the tool. Like when you write unit tests for your, you know, uh C# applications, you're not testing to make sure the dot net compiler actually works right now. But if you're doing something interesting, so the example would be Apache where depending upon the platform you're on, the name of the package is either HTPD or it's Apache too. That's a thing to test, to say if I'm on this thing, do whatever. So think about when you're writing your test, like you're testing your program, you're not testing Pulumi. So if your test is just fundamentally does Pulumi do what it says it's gonna do, then maybe it's not so much a test. Um cool, but don't like be beholden to that coverage percentage because sometimes there's things that you're not going to test. So yes, coverage is good, but maybe, don't worry about the imports. So what I was thinking we would do so if we're kind of going through our, um, our testing guide. So for unit testing for this first thing, what we're gonna do is, uh, and we, we'll talk this through, I think maybe we'll follow the guide at first, which is gonna be based around EC2 and using AWS. But then like after we sort of see how to do that, let's maybe throw some Azure at it and see what happens. Let's go break it, let's go do that. And we're gonna do this in typescript because I got to choose today. Um So, so, uh, what we're not gonna dig into, uh, specifically is some of like your Pulumi setup. So you could just, so you have a background if you're watching and you've never done Pulumi stuff before. Um, I've already got the Pulumi cli installed. I've already got, uh, my Aws credentials are all set up and everything's working. So we're just gonna sort of focus on, on this and I've got my, this, hello, people is just so we can make sure that everyone can see my text now. So kind of the first thing that we need to do is we are gonna need to get ourselves a Pulumi program. So we'll say it's a new type script and, you know, whatever it's fine. Um Oops, uh Nope, you know what I forgot to do, I'm trying to run this flag to actually do. So I, I always actually do dash dash four. Yeah, but I don't want to actually do this directory. This, this directory is where I'm gonna do other. So that was just me like, um, so we're gonna call this, uh, you know Aws. Why do we call like, you know, stream one? I don't know. Well, well, it's, but we're going to do multiple plumy programs in this thing. So we call it Stream one Aws unit stuff. Sure. What a great name, you know. Ok. Fair enough. We devs naming things is hard. It is, it is. Ok. So now we're gonna say we're gonna create our new typescript ploy program go is gonna chug away. And that why flag is just saying, give me all the default things for those of you who don't know the Pulumi C I Yeah. And I actually could have even scaffolded this scaffold, scaffolded it out as an AWS one, but there's not a whole lot that we need to do there. So, um but if you're curious just to sort of take a look again, this is just gonna make sure we've got the right Pulumi package and in our index. Ts absolutely nothing interesting happens. So, what we're gonna do is the first thing we're gonna do is we're gonna kind of, uh, do, we're just gonna write our Pulumi code first, which you might be like Mandy, you're supposed to write test first, but I'm not doing that part yet. Um, that'll come up, uh, maybe in, in a different way we do this. So let's go ahead and we want to do Aws stuff. Oops. So, and we're gonna import this from Halloumi Aws. Ok. And what we're just gonna do here is spin up some Ec2 nonsense. Um, I don't think you've actually put the Aws one in there. I guess I haven't installed it. Yeah, I need to do M PM install. Yeah. There we go. Then it'll give you all the lovely things that we love. I needed to. Yeah, I needed to move my, uh, windows around, you know what's crazy? Oh, Zoom a little bit on the, oh, the sidebar. Yeah. So, the problem with that sidebar. Yeah, the list of the, the files. Um, because if I zoom in it's gonna increase that. So, you know how we're gonna solve that problem there. Look, I don't even see it. So short version is, there's a index dot Ts final. That's where all of the Pulumi codes are gonna live right now. Um When we get around to testing, we'll probably move a little bit of cheese around and then there's a Pulumi dot yaml which is holds a little bit of metadata so that you have it. And what else is in there package dot json uh couple of other things like that. So if you go to, I think it's uh github dot com slash Pulumi slash templates I think is the repo you can actually see what all the templates have inside of them. So it's a good question though. Ok. So we're gonna do our security group. Oops, I can all this camel case with typescript. You take your people, I do this. Um OK, I got my way there ingress. So we're gonna say our protocols. So right now, Maddie is kind of working out of the uh doc slash guides slash testing slash unit if you are looking at the code itself and you want to kind of follow along that's at plumy dot com. So that's where we are and we are under the typescript tab. Nice thing about the docs is you can actually go in and change to the language you're most comfortable in. Um, I happen to be more comfortable in Python than typescript. So, uh you know, trying to figure that one out is always highly entertaining when I'm flipping around. So it's a lot easier to just be able to switch it over to Python to see what is going on. Super lazy here because that's how I roll because the other protocol is gonna look exactly the same except that it's not 22 it's 80. And what we're just saying, OK, we're gonna create a, you know, a security group um for the protocols we want to do. Cool. OK. So we wanna get our oh nope semicolon. This is typescripts. Uh And then we're gonna throw some user data at this because that's how we a role here in Aws. And we're just doing a simple HTTP server uh with Python to serve a tiny little thing that says hello world basically. So that's what all of that is. So we're saying, hey, echo this into the index dot html file and uh serve it with a little um that Python dash M as a module. That's simple Http server at port 80. So if you're not really familiar with um Python Simple http server while Mattie's typing, it's a tiny, very, very small, little little server that just kind of shoves up HTML for you, which you would probably never do this in production. Uh, although I don't know that but, you know, you know, but, but one of the things just if the Pulumi is new to you, that might be interesting is you're seeing, I'm getting all this type of head and autocomplete and stuff and that's because there's, I don't have the magic Pulumi extension to VS code. This is all just because it's coming from that package that we installed and the same thing would be true if I was in Python or Gola or whatnot. Um So this is helping me kind of figure out as I go. And one thing if you are into uh the whole um co github copilot thing is I've actually found Copilot's pretty good for writing Plumy code, but I, I turned it off for this because let's just kinda, you know, try to avoid doing things like that with the demo. It's not really a demo that just makes me itch so much the idea of using Copilot for stuff. Well, it's, I actually don't mind it for this particular thing because it also looks at your other code that's in the folder where you're at. So I've actually found it to be more helpful for me in this particular case. Um We won't talk about how I've used it to actually maybe write blogs. But by the way, if you write your blogs and mark down and you turn on copilot, you're gonna get some good ideas. Um Well, but the thing is about that though is that, you know, it, it does take from everybody else's mistakes at the same time. So yeah, so, so don't just do it arbitrarily but 55675567380. And uh and then, you know, send user data to the value that we did up here for user data. Cool. Cool. OK. So just one thing that's just interesting. This is again because hey, programming language, what user data if you want to date with my user? Um because remember we created group up here, so we're referencing it here. So yeah, programming. OK. So fundamentally what we've done here, we've written um that this is just gonna create a security group, it's gonna create an instance. But we want to make sure that when that when we write code because there's a couple of things that maybe matter to us in our organization. So it kind of sucks when you have EC2 instances that don't have uh a name, they're not tagged with a name. That's not great. I don't know about you, but I've run into an awful lot of EC2 instances where I'm like, what the hell was this again? Um We also uh maybe, you know, so remember um you know, Laura said we did this user data where we, we basically ran in line our code just throwing in a user data, remember, Laura said, please don't do that in production. Well, maybe we want to test to make sure that we don't. And also uh you know, remember we opened up these protocols up here and um you know, who can tell me what's uh what's sucky about this. We just said, ssh is open to that whole big bad internet, which is maybe not amazing. So that being said, uh wouldn't it be great if we had some tests so that we could make sure that when we write code it doesn't do that. Um Or to make sure that our code will, will take care, will do the things we want it to do. So if we first thing we wanna do is now you can use whatever testing framework makes you happy. Um We're gonna use Moca right now because why not? Uh So if you're into writing tests and your programming language of choice, you probably actually know how to write the tests. I mean, what framework you wanna use that you love? Uh So we're gonna get N PM installed, we're gonna install Moca and we really uh we just need to make sure we add the types, right? Because we're doing typescripts. So, and then we also are gonna install TSM. So these are two packages that's gonna give us um the ability to use that. Now, what we need to do is we are going to um because remember, we're not gonna actually really run anything here. So we're gonna mock it and we need to mock the calls that go to Pulumi. So we're gonna create a new file um called EC2 tests that PS and uh which is over here and what we're gonna do in this file here is all we need here. We don't need the EC2 stuff because remember we're not actually testing EC2. So we're not gonna use EC2 related stuff. We're just gonna pull in Pulumi. So we're gonna import uh as Pulumi from Pulumi. Pulumi. I love all the repetitiveness of, you know, things that we do and, and just to reiterate, you are not using a Pulumi extension. This is actually just because we imported the Pulumi library because I think there's a question in the chat. There is there's no extension. This is just because we have the library. So we'll, we'll, we'll do another one some time where we use a different testing framework. But my, we're, we're following the docs which I in there, but maybe we'll play later also just and Laura, I appreciate you looking at the chat the way that I had to lay out everything on my screen. My V code window was overlaid on top of rest. So I'm not actually seeing the chat so you can, you can see for the chat that's, it'll be fine. OK? It's perfect exactly how it works. So we're gonna do uh we're gonna set our mocks here and what do we wanna mock? Right. So we're gonna mock that. We're creating a new resource, right? So which is, that's OK. So let's pretend we're gonna do that. And just in case you're curious that Pulumi runtime is the Pulumi service or Pulumi cli I know I'll get this wrong every single time I say that. Um But that run time, we do actually have a mocking, mocking engine, mocking class la mocking Library. I don't know what else to call it. Uh So we do have that in there, which is basically what we're filling in. Um But that all also is in the API reference if you are so inclined to go rooting around in the docks and find all the information about the Pulumi run time. So, and we've got our mock resource arcs, all of the arguments that come in that we're that we're mocking out here. And basically what Maddie is doing is this mock is saying whenever there's a resource that we want to create, here's what I want you to return. And it's basically the inputs because in Pulumi, your inputs are also given to you as an output. Um So inputs into the Pulumi program, um you then get that as an output, you can call for other systems, uh that's called a stack output and a stack reference. So you're able to do all kinds of fun stuff with that. So that's basically what Maddie is currently mocking and what? There we go. That should do it now. Ok. What's not closed? Uh You forgot the semicolon after return Ags dot Inputs in the call line 12 0 semicolon. Not a comma. That's why I did it. Ok. So like Laura said, what we're doing is we're, we're pulling these out. So the more that we, we know um that the name looks a little different than that and cool. So we have that. So now if we're kind of looking at our EC2 tests, so now we actually wanna write. So we set our mocks, now we want to write our tests and so we're gonna describe who remembers cucumber. Um Yeah, cucumber and I still describe right. Yeah. OK. There we go. And we're like Infra is and uh like like Laura said this is an import, right? So where the rather we're importing our index? OK. And then info it's like the info Mafia. I don't know. Did I know something about that? Uh oh because we don't have, do we not have why is it not pulling up index? Do let me see. Uh do do do could be just that we're not done. Um Yeah, it might just be that we'll keep, keep going, we'll figure it out, we'll break it first and then we'll figure out where we, we didn't import moca. That's why. OK. Sorry. Oh, that might be kind of important. Sorry. There you go. Uh oh now we lost my call. Ags. Um, because we is, oh, because it's, uh, yeah. No, this, this is basically how we, how we, how we run through some things. We gotta fix that in the dock. No, something's called the function because it wanted to because it didn't bring in a, from, but it brought in happy to watch. Actually, I'm gonna do this. There we go. So that should you get quotes around it? But that actually isn't in the ducks. I think there's actually something not correct here in, in our, but that's what gives us our call. But we still need to put, yeah, there you go. And all you weird typescript people, like, just putting them in any order. I still don't know why. This is not why I can't find index, uh, because it should be, it should be pulling that. It should be importing the index dot TS. Are they, are they in the? Oh, wait, why is it up a level? Shouldn't be dot Index dot slash index maybe. Oh, yeah. It's because again, like I said, I think something is up with this whole, I feel like, um, the problem is that it thinks the test. Oh, because the tests are probably supposed to be in a test directory. That's why. Yeah, probably. So, either you can move it or you can just kinda kind of go there and, uh, mm. Oh, yeah. No, this, if, for those of you, like, watching this pair programming is highly entertaining. At least for me, I always find it very entertaining because I'm like, wait, what, what about this piece? It's broken but you're right. It is. It should be with the way that this is laid out. It should be ok. So, so how many people like out there when they're doing pair programming? You have one person looking at the docs going? Wait. That's not right. And then you get into an argument about which one is right? The docks or the ID E on how to do something, right? Because I'll do that. It's very entertaining. And also I'm gonna pronounce this awfully but happy Do Wally uh yell at me if that's the wrong pronunciation because I'm very bad at pronouncing things. I can type things very well, just not pronounce them very well. So, but we're doing, yeah. So the reason that we're, we've got this, uh, this awa is because we want to make sure that those mocks are defined before we actually load the program because otherwise it won't make any kind of sense. So that is, you know, now we're gonna actually go in and check for our thing. So I'm gonna start just scaffolding out where we're gonna put the tests. So we're gonna have our first, these are sort of your certain equals true. Uh Is how you start, um, those of us who can type there we go function and, and then this is where we would say check for name tag, check for uh no user data nonsense. So we're gonna write our tests into there. And then we also say we want to describe the other set of tests which is gonna be um we're gonna call this group. Oops, because this is a sort of testing, right? So the first was sort of our tests around our EC2 instance, this is gonna be our tests but around the security group that we're defining, which was uh with that pound group number. Oh Yeah, I mean, it doesn't matter. This is just I know, I know but, but it, you know, yeah. And then the same thing we're gonna say check to not let s open to the baddies. OK? And then uh so we have a whole bunch of tests to do nothing now. So we want to actually do that. So if we take our look at our first one which is check for a name tag, um We're gonna say it and it must have a name tag because otherwise your poor server puppy might get lost and nobody knows who it is done it instead of if you get the, if if and then it and it's all confusing and this is why I don't, this is why I don't use this anymore. Gloomy and then plume me all. And then you've got, so remember we did, we created info was our actual program. So this is saying uh if you were to run that mhm Eggs apply. Yeah. So while, while Maddie is typing the, the Pulumi dot All dot Apply, um that's how we get out the outputs. So if you want to be able to use the outputs programmatically in your system, we use this dot apply uh pattern that you're seeing right now. Yeah. Now you get the NBF. There we go. So yes. So this is basically just saying like here with the, with the applied outputs from this expected call which we're mocking up above. Um We should be seeing something that has a URN and some tags. And if the tags um thing array, there is the word I'm looking for. If the tags array doesn't actually have name in it, then it says, hey, you need to have this. So your test will fail otherwise good job, your test will go and actually work. So that's the short version of what that code exactly is saying. And remember like, like we were saying, in this case, we're not actually doing a deployment. So there's properties that won't exist yet, right? Because names of things, especially if they're auto generated. So uh we're just checking to make sure that they would look valid and um yeah. OK. So cool. So now we wanna make sure that user data is empty. So for this one, we're just gonna say it not if must not use user data, U as in ami U Haven that person. So Maddie, is it Ami or Amy? Amy? It's Amy. Did I just say Ami? Wow. I always say, I always say Amy, which nobody else does. People who say Amy or Ami and I say Amy. Um So I'm just waiting for like Corey to pop out of nowhere. I mean, I, I actually, I love that like when he did the t-shirts that were about pronunciation, he made the, the one like the ugliest color choice. So you had to really be, so I was really invested by getting that shirt. Um oh I do this on Infra at server and it's gonna look really familiar. Um So we do our info server this time where instead of the tags, we're gonna look in user data, right? And we do this thing, we're gonna do our do apply urn user data. Wow. I really want to make it say user dates. Have you been working with date time lately? When are you not working with daytime? But I, I actually was uh in user data. No. And er oops, I love this one where it's gonna be illegal. Use of user data server. It's like we have a little traffic cop, right? That's illegal. Don't do that. You can tell that Maddie's been dealing with a puppy for a little bit because all of the examples are bad puppy. Exactly. OK. So that got us OK. We got our two exam or those and then, so this one is, um, this one is a little bit more complicated. Uh because now we want to go ahead and make and we're gonna kind of search for the Ingres rules and it's still not too much code. So we're just gonna say it's must not open 22 to the bad people on the internet. Uh Don't, don't have me write your uh tests. Hey, I think that's perfectly explanatory. I don't know, maybe that's just me. So we'll do our Infra and this time it's gonna be group instead of server because when we created that constant called group uh URN and we're gonna look for Infra group dot Wow. Yep. Yep. I need to take, I need to maybe be teaches type again apply. You are in ingress in grease res and then we have our a sync call here. Yeah. And again, we are doing uh outputs in Pulumi are figured out asynchronously. Um Just because that's really how the engines built. So we have to use asynchronous stuff to uh test to the built in asynchronous testing. So just a side note. Bye. Remember when it's not just don't have 22 but we explicitly wanna make sure that it's not 22 to that side or block of 0.0 0.0 0.0. Done new error and you're gonna want a double AMP or sand up there because we want both roll. Oh, there it is. That's why. Yeah. Yeah. Mhm. There you go. Hey. All right. Uh uh mm and, and do our else done? All right, done and done. Ok. So we have all of our tests written and now we want to actually run these tests. So we'll run Moca. Uh I don't have Moca installed on my own machine. So N PM installed G oh God, there you go. Um OK. We're gonna go ahead and, uh, and when this runs it's what you didn't do when you did the global install, you didn't install the thing. I guess that's why. So I didn't install, didn't install the uh TS node and all those things. Ok. Let's do. So I think I need to do this. Hm. And it's supposed to fail so, but it failed because it said it couldn't find any tests. Oh, wait, play it again. Now that you installed it? No test files found EC2. 0, because it's easy to test. Not easy test. Ok. There we go. Oh, yeah. It's like, yeah, I didn't find it because it's not there. Ok, cool. Um, there we go. So we got our fails, right? So, uh everything's unhappy. We're very sad. Um, and now we could write, um, now we're gonna go fix our code to make the test pass. So I guess step one is very easy. We're just gonna, oh, wait, well, first we're gonna go to our code. Um, let's just get rid of this guy here. Ok. And uh, we had on our instance, we have a type and all of this stuff, but we don't have is we don't have any tags. So let's go ahead and tags are name. We're gonna call it the, the, the server. Actually, we're gonna call it. Yeah, that sounds like a better name for a puppy than WWW server. Ok. And then the final thing we wanna do is we don't, we need to get rid of our user data. There we go. So now, and we're gonna, if we run our test again, there we go. We get all the green checks. It's very exciting. Life is good. So now if we wanted to sort of think about this a little bit and uh so Laura, we could either sort of replicate this again and I'm not gonna make everybody watch me type. I might do some copied pasta stuff. But if we wanted to do this with Azure, uh we could do something very similar um where it's simply just a matter of we're just checking against tags, checking against our arguments. Uh So there's nothing specific about this being um aws in perspective or in specific the now, uh So if we're gonna go on to our next one, which I think is really kind of cool is when we think about uh what we, you might call property testing or also policy is code. So we talked about infrastructures code. Now, what we've done here is I put these tests in place, but like it's incumbent upon me to run these tests and I could put them in my C I CD pipeline, but they're all kind of in, in that part. What we do with property testing is we're taking these policy definitions and then we can apply them. And we're saying when you're putting stuff in this particular Pulumi stack, these things need to be um set, right? So if we're gonna go ahead and I'm gonna clear this, I'm gonna close these folks out and let's go back up and we're gonna, uh, so we've got, um we're gonna work in policy stuff now. OK? Cool. Um And first thing we're gonna do, we have our typical Plumy program, you know, just like kind of what we just did. But then there is a subdirectory. Uh There's also, I can't even talk what we're gonna end up having is then there's gonna be a directory called tests and that's where we're gonna have our, our policy pack. So similarly to, before we're gonna create our new oops, um we're gonna call this policy code, we're gonna create a new typescript and um we're gonna, we're gonna approach this in slightly a different uh perspective. So the other one, we wrote our code and then we're like, let's write some tests that's not test driven development which, you know, is arguably good or bad. Um fight amongst yourselves on that, but we're actually in this case, we're gonna create the tests first. Um So if we are back in policy stuff as directory, we're gonna create a directory called tests. And then inside of tests, we're gonna create um an index dot Ts and that's where we're gonna start uh our life. Ok. So, um, we need to import uh Aws. Um, and I think we are gonna need to do a little. However, let's just go back to, we need to do N PM install Pulumi Aws, Pulumi. We're gonna need policy and we're gonna need Pulumi. Uh we don't need to import Pulumi Pulumi, we already have that. Ok. Ok. So while you're kind of getting some of the code over and maybe you do want to copy it over and we can talk like for time purposes, I guess. But while you're doing that, I can kind of explain a little bit. I don't know how many like if we really explain what we mean by like policy packs and policy stuff and all that. So if you want to make sure people can't do things without uh ensuring that specific things run, that's really what a policy pack is for. So if you don't want people to be able to delete something, let's say without going through a specific process. So, you know, you can't delete the resource, you can only update it. That could be something that might be as part of a policy pack. So you have a policy that is then wrapped up together with other policies that are related into a policy pack and then you apply that policy pack to your Pulumi program automatically. So that's kind of like the hierarchy of things as we go through the actual stuff. So if we kind of as Laura said, you know, sort of stepping through this code, so we imported policy which lets us, you know, as the library that lets us uh um write them. So we've got, you know, we created a stack validation policy which is saying this must apply uh to things inside of this stack where this is deployed. And what we've uh kind of have in there is we have two. So we have two tests. We're gonna write this kind of went in and said, we're gonna validate the stack. We're gonna, we're gonna split up some kubernetes here because we can't do without Cotti. Um And we've got a couple policies, we want to be able to validate the cluster version because we want to be specific about the version that we support. And we also want to um basically, we're gonna say there's, there's two things that are, we don't want people spinning up eks if they don't follow these policies. One is that it needs to be at least one dot We need to be running cnet's 1.13 and also we don't want it in the default VPC because that's bad, right? Um So what we're doing here, we're importing the packages that we're gonna use. So we're specifically importing that uh policy SDK and, and we're doing Pulumi things, we're doing aws things. So, and then we're creating that stack policy. So we want to go ahead and for our first to do here, we're gonna go ahead and say if cluster version oops is not 1.13 oops or 14 or, or what? Jeez Matt. OK. There we go. Um Then we're gonna be like, you know, this, we're gonna report a violation. OK. And we're gonna say we expected Eks Cluster oops. Um Is it so hard for me to type today? Uh plus name? We expect bats version to be 1.13 but found get it. Uh a little bit of a sorry, I got straight there. Uh Cluster that version. Uh And this is actually kind of an interesting thing to think about when you're writing these. OK? Come on, get out of here with this nonsense. Um OK. Oops. Uh That was right. Yep. Yep. No, I just wanted to get the, oh, there we go. This. And you were saying the important things thing about writing these. Whoops. Why did I get an extra? Great. 00 Because I was uh OK, because I was word wrapped over. OK. Um As you notice, we say this is what we found, right? Like we could have written this to just say, hey, it's not the right version, but you're actually saying I expected it to be one at 13, but it was this instead. Uh, so that way I can understand it and this might sound really straightforward and be like, of course, Maddie. Um, but I often forget to do things like this and until I get angry at myself when I run my test, I'm like, who wrote this test? It doesn't tell me anything. Oh, I did. Um So the VPC test is a little bit uh more involved. So I'm not gonna type you type at all. I'm gonna actually, I'm gonna copy this in because in the interest of, of time. But I do want uh come on, you gonna purify this for me? Nope. Don't you have a reformat on, on the BC code? I don't know what that is. Uh the beautify. Um Let's see if that, yeah, that might be helpful. One thing I was gonna say is, yes, we know that it's 1.13 and that's very, very old for a human cluster, but we're OK, just follow us. So we're doing a couple of things. Yeah, we can and we could always change that too if we wanted to. Um Yeah, so what we did with this is um the, we're, we're basically uh we're having to go out and actually find what the default VPC is. Um Why did it response dot VPC S 0.0 I, my beautify actually jacked up my code a little bit but I fixed it. OK? Yeah, it, it did the, the, um, it put a space right here. OK. So we set our, so we basically saying, where is that default VPC? So we have to reach out 322 and get that. And so now if we say, OK, cool, let's, uh, go ahead and write our, our crappy program, um, which is gonna look like this. Oh, let's do AM PM install at Pulumi. Pulumi Eks Pulumi. I've had a lot of people ask me how to pronounce Pulumi. I saw Joe uh Duffy tweeted the other day that like um like some of our top hits are on all the different ways that people misspell Pulumi. Uh So that's, that's the thing. OK. So what we've got there is we're like, OK, cool. We're just gonna, you know, we got a ploy program that's gonna create, you know, a cluster with kind of our default stuff. Now, in this case, instead of running like the Moca framework or doing whatnot, we're gonna actually just run a Pulumi up but we pass an extra parameter that says here's your, your tests to run. So we're gonna say Pulumi oop Pulumi up, but we're gonna pass in, we're gonna say policy pack and then we're gonna say it's in the tests directory. Mhm. Now, it's gonna be interesting to see uh we're gonna wait and see what happens. OK. Um OK. Well, that's not great. Fail to load Pulumi policy project located at tests. Uh, why I see. Did you actually test Pulumi policy dot Yaml? Oh, did we hold on a minute? I'm going back and taking a look. 000, I missed the whole thing. I tried to do this all by hand like a dummy. Um, we need to actually, so what we're gonna do here because I don't want to lose my code. Um, we're gonna go into tests and then we're gonna MV index PS two dot that slash thing that PS OK. Just because I wanna, I need a, I need an empty directory in here. So then we're gonna do a Pulumi let me policy new Aws type script. What you're missing Maddie in the chat is currently we're having a lovely discussion around how to pronounce Pulumi and what it rhymes with. What I, what I think I want for Christmas is to have everybody go in and just send me a little video of how you pronounce Pulumi and maybe we'll cut it all together just for fun on Twitter. But anyway, OK, so if I go back to this one. ok, so I believe now if I were to go back to this is the uh the policy pack that created one, but we're gonna wipe the whole thing off and yep, and we're gonna paste back in our thing there. So now that that's there. So now if we go back to CD dot dot Let's clear this and let's run our policy pack tests. Oh, that looks a little more promising. I don't think we got this. Yeah, it does. So here's something just to know, uh, while, while we're waiting for this to run up. Ok. Uh, no, wait, no, that's right. I guess. Yes. Um, because the preview failed. That's what we wanted to. Oh, no, no, it's, yeah, but that's no, I think something. Did we break something else? I see, I see the policy. The it should complain about the version. Yeah, we didn't get that one Eks Cluster but found zero. So something um 00 Hello. Uh You know what I didn't do on this file? I, I didn't say so. Our index dot Ts was blank. So it was like, um I don't know why you want me to test an Eks Cluster if you're not gonna bother making one Maddie. So that uh gives us they're OK. So now we, now it wanted to do something and of course I didn't set a region. Um So let's do. So, so while, while you're doing this, I'll let you kind of do and I'll, I'll talk over you for a minute. Well, I also just said something I didn't mean to set but it doesn't matter. Yay for history. OK. Oh So while this is going, one of the things you're gonna see when it comes up or you'll find out when it comes up for the actual policy violation. You'll see a little thing in practice that says mandatory or advisory. So you see what we have an advisory and we have a mandatory, your violations can be basically critical warning or just info uh We call them mandatory advisory and I forget what the info one is. I can never remember them off top of my head. Yes. And this worked the way that uh we wanted to. So the advisory thing that happened is it said, I actually can't um because it's just a preview, it doesn't get a value for the VPC ID. So it doesn't know what's up. So the preview won't actually run that test. But then like laws that are mandatory and again, we find it says cool, hey uh Maddie, we thought this cluster was gonna be one do 13, but you didn't even tell me what it was gonna be so you can pound sand. Um So this is pretty easy. We just go back to our cluster where we edit all these things and it's like, all right, fine. You want a version? I'll give you a version. How about the one you asked for 1.13? Cool. Right. Sweet. And then if we were to go ahead and run that again, now the preview will actually pass because like Laura said because it, it failed the mandatory. So it's like I'm not even gonna tell you that this was an OK preview. This was just a bunch of nonsense. So, what we should see now is that it would actually, yes. So it says it gave us an advisory thing. That's just like, um, by the way, there's a thing that you might suck at, but I can't tell you if you suck at it yet, but be advised that you might be doing bad things. Um, and then if we were to now, what I'm gonna say is if you were doing this yourself, you would say yes, go ahead and perform the update. Uh We only have about four minutes left in this stream and it definitely takes more than four minutes for uh an EKS cluster to come up. So what would happen is it would um Yeah, we would fail and then we could go ahead and um, and go fix it and fix that, but we're, we're not going to. So, uh but this seems like a fantastic time to. Um So we do have some, some questions. Yeah. So first things first, uh when does gola support come for cross guard? That's a great question. Um I don't know exactly off the top of my head. However, we do have a public road map if you haven't seen it yet. Um I don't remember exactly where it is. Well, it's on, isn't it? It's uh isn't that the whole point of it? Well, no, I thought that, um I thought that uh we just, we're one of those people that github was highlighting because we're using um our road map in, I'm trying to, but it's, it's in the repo somehow. Yeah. So we are using the official new like fancy github road mappy thing. Um The blog post came out September 29th. That's how I find it. Uh So it's github dot com slash org slash Pulumi slash project slash 44. Uh That, that number is really important apparently. Yeah, we need a better link for that. Uh We should, we should actually, you know what, I'm gonna make a ploy for it right now. Um We're gonna have to happen in real time. What I would say, not my screen. There. You are sharing your screen. Yeah, there we go. Um If it's not on there, you can open up an issue against ploy slash bloomy or look for one and then add a thumbs up to it. We're using that thumbs up vote to be able to tell what should be next. Can you, can you throw that the real link maybe in the chat so I can copy if I can figure out, I don't think I can do the private chat, not throw it in the private chat. I just need something to copy paste. Hey, aren't you, aren't you all loving watching this? Um OK. And then the second question was, could you show the op A style maybe in another webinar? I think that'd be really cool. No, for sure, for sure. Um ok, so should we just make this be we'll just call it road map. Yeah. Ok. So, so the where are we going map? Um I think that'll be good. So yeah, so that's it. Those are really great questions. I'm literally writing down the. Ok. So if you, I will put the link in the chat that Pulumi uh road map will um get you to the here we go. Yep. And that should uh should do what I expected it to do. So. OK. Cool. That is gonna probably uh bring us to the end. So uh if you haven't subscribed in whatever mechanism you are doing to watch this stream, whether it's youtube live or Twitch, go ahead and mash that button. Uh Again, we're gonna be doing these every week at pretty much this time. I will tell you a couple um that are upcoming that are gonna be next month, but I am doing something with uh Frosty with Dan Marr of data dog. We'll be playing around with instrumenting uh data dog. Uh adding data dog to a Pulumi program. Uh not to instrument the plume program, but you know the cluster we build with that, the stuff we build. Uh Laila Porter at VM Ware, who's a dot net. Uh guru is uh gonna join me for some, some dot net stuff we'll be doing that also in December and also we've got a whole bunch of new uh educational content that actually Laura is working on and we'll probably have the next few streams are gonna focus on those as well. So I hope you uh subscribe and uh I don't know, what does everybody think? I mean, Pulumi portions. Is that what we should call this thing? If you got a better idea at us, you know. Um We, we do have Pulumi TV, that's the youtube channel um on that youtube channel, we are starting to publish more videos. So keep an eye out for those. Um So this, this, I, I guess you could call Paul this Pulumi TV. What if it's Pulumi Pu TV TV? Let us know in the comments as the kids say. So, thanks for joining us today. Uh And I'm actually about to run off to do another stream with our friends at Alma, which is an instant response uh stuff. I think so as always go break things. Uh Not important thing. So, yeah. All right. Thanks everyone.

---
