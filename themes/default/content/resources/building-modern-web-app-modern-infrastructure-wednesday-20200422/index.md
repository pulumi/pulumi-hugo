---
preview_image:
hero:
  image: /icons/containers.svg
  title: "Building a Modern Web App | Modern Infrastructure Wednesday 2020-04-22"
title: "Building a Modern Web App | Modern Infrastructure..."
meta_desc: |
    In today's episode, we're building a modern web app using React, AWS API Gateway, and Pulumi. Code for this episode available here: 
url_slug: building-modern-web-app-modern-infrastructure-wednesday-20200422
featured: false
pre_recorded: true
pulumi_tv: false
unlisted: false
gated: false
type: webinars
external: false
no_getting_started: true
block_external_search_index: false
main:
  title: "Building a Modern Web App | Modern Infrastructure Wednesday 2020-04-22"
  description: |
    In today's episode, we're building a modern web app using React, AWS API Gateway, and Pulumi. Code for this episode available here:  https://github.com/pulumi/pulumitv/tree/master/modern-infrastructure-wednesday/2020-04-22  The examples are in TypeScript but Pulumi makes it easy to stand up infrastructure in your favorite languages including Python, JavaScript, Go, and .NET - saving time over legacy tools like CloudFormation and Terraform.  https://www.pulumi.com/docs/get-started/?utm_campaign=PulumiTV&utm_source=youtube.com&utm_medium=video  This is the second part of a multi-part series.
  sortable_date: 2020-04-22T04:51:28Z
  youtube_url: https://www.youtube.com/embed/zJTU1nUwzyk
transcript: |
    Hello and welcome to another episode of Modern Infrastructure Wednesday. I'm your host, Lee Zen with Bloomy Corporation. Today, we're gonna be doing the second part of our series on building a modern web application. Last time we went through a number of steps to create an API gateway that we were serving our re application out of it was completely static in the last uh video. And today we're going to be hooking it up to do some more things in particular, we're going to be creating a Lambda integration to our API gateway. And so uh instead of just serving the static assets, we'll also be actually uh running code out of the API gateway and then we'll connect our react application to the API so fairly simple tutorial today. And then we'll follow up in, in a following session on having that, having that integration actually do something uh with a back end of some sort, maybe Dynamo DB or Mango DB or, or what have you. So let's get started. And uh one of the cool things I actually wanted to show uh before I really get going in the code is uh I'm really excited because today we, we launched the 2.0 version of Pulumi. So actually, if you, if you are using home roof, for example, you can just install it or, or go to the website and, and get the new version of Pulumi. Um I've actually also already updated the package versions uh in this example, to use Pulumi two OS DK and then also uh the corresponding AWS provider uh and then also it'll be sex. So all the, all the various libraries with Pulumi have been updated to 20 really excited about that. A lot of cool features that were, were shipped as part of 20. I won't go into the details here. Uh Definitely go to the website Pulumi dot com and check out all the new things that are really super powering uh Pulumi 20. So let's jump into the code and just really quickly review what we did last time. So last time as I mentioned the, at the beginning of the video, uh we created an API and we basically served our static assets out of app build uh on the slash path. And actually one of the cool things that I really like about the way you can do things with Pulumi is you can define infrastructure, you can see we define the infrastructure in this uh in this particular file, but we actually also in the same project, effectively the same repo uh we have our actual reactor app sitting right next to it and we can refer to it uh with this local path here. So, um this will actually, you know, when we run uh the, the build for React, that'll stick the production build into this directory. And then this gets shipped up um as part of as part of everything else. Uh And then we also in the last, in the last video, created a certificate uh in us East one validated the certificate with uh AC M uh the certificate manager. And then we created a custom domain for the API gateway uh and mapped it to the API and then created a route 53 record to point web app dot Pulumi TV at that API. And so the result was uh this, this website uh that we, we created and we also made a change to the website that we were then able to upload. So today, let's actually add a very simple uh API uh to, to our, to our program. And so it's actually as simple as creating a new route and we'll give it a pad. Uh let's call it API for now. And we'll, you know, maybe think of something else to do later. But for now, let's just do that and uh we'll just have a get method on it and then uh we want an event handler and this just takes a callback function so we can just do something like this. We can do uh a sync um and we can return a, uh you know, status 200 and, but I think it's ST ST code actually. And then body of um, you know, getting it, let's give it a, make it a Jason, let's make it an adjacent object and we'll say uh um status in the world. And let's see, what do we miss here is not, as I said, should be. Ok. I'm not sure what this actually. So what is this one? Ah ok. Yeah, that should be right. And that event Hammer uh let's see. Uh it's expecting a ring. So we should be able to do if I if I recall correctly that should work. Let me check the documentation here. I actually had this open just a second ago. Uh I know I had it right. I think if I oh I see body is supposed to be ok. Now, I understand body is supposed to be a strip. Ok. So we can't we have to do the Jason here. There we go. Ok. Now everyone, now all the now it's all happy. It didn't uh do anything too crazy there. So all we're doing is we're turning a status code of 200 let's see the status code and then uh the body is really just adjacent object uh with status he world. So let's first actually deploy this and make sure that works. So uh you know, you'll notice we we've updated the actual rest API itself. Um And then we're also going to create a function that goes with it and then obviously have to have to change some of the permissions here um for all this to be hooked up correctly and have it to all work. And then obviously, we'll do a deployment of that, of that particular API. So OK, that's all done. So let's actually curl um the stack output API URL slash DP A, a Laurel. OK. Great. So that worked as expected. And so, you know, super simply, we actually um in just a few lines of code, we created an API um uh function that we're able to call. So now let's actually call this from our React app. So let's actually run the server locally, make sure it all works. OK? So this is loading. And so, so this is the, this is the app uh running locally on my machine. And so we can use uh uh if I uh if I'm having done reacting well, but we should be able to use uh state and effects to kind of do what we want here. So uh we can use the React Hooks and let me actually just look up the documentation for that React Hooks. And OK. So we need to import uh use state and use effects. And so here was she able to say, you know, for example, um so we'll have an empty status initially and then uh we can also, we often also define the effect. So let's look at this. So we can actually uh do something like this and we just create a callback that we will call. And so we'll fetch. Um And uh here I will use for now, it was hard code this uh obviously, we could actually do something smart uh better here. Uh But for now we'll do this uh let's call this. Um and that's, that's a promise. And so, uh, we can actually believe we can actually write this as AYC. Uh, uh, ok. It's clearly, I have not used, I'm glad it's giving me all these warnings. So actually, let's do this and then we can set, we can set the status two status dot um, so Jason, let's do this for now. Um, actually, let's, let's call this s so we don't actually shadow our own stuff. Ok. So let's just see if this works. Let's see. Ah, because I'm right, there's no cores. Ok. So we're gonna have to try that. Well, actually, it's pretty easy to try this, uh, directly on the, on the server. So we can try that real quick real quick. Um, and actually let's just output this, uh, down here later too. So let's just do, um, wait, I'm in, I'm in a function so I can't do that. So let's do this. Ok. So now we can actually build and we can actually go back and up and like just like last time uh when we made the change, um this just, uh this just updates those various uh S3 S3 bucket objects uh to represent the new production deployment uh of our React app. All right. So that was pretty fast. So now if we go back to our production avenue can refresh here. Oops. Oh, and if I react error, all right. So we clearly did something wrong with the, the way we built the app, see what's going on here. Ah, so I tried to. Right. OK. So this is not OK, let's get rid of this for now. So, um, I believe we should be able to do, I haven't used special in time either but I, I believe we should be able to do, um, uh OK here because it's, uh, it's not an object. Well, spo no, actually. And uh, and then here we can, um, do reference the, uh, what I call it, the status field. You can just see it made the api call, it got back the object we expected. So that's, that, that all worked. Except for the fact that I tried to display an object as opposed to, um, as opposed to the actual text value, which, yeah, you can't, uh, you can't stick objects into uh values like this in react. All right. So now let's refresh the app and uh, we got the status. Oh, I actually should have gotten the body. I guess this is this is the actual um status, the status value of the uh of the fetch. So this is s start, you can see this is status and that we actually want the body um as adjacent value. So you can just do that and then we'll change this to and she, it's still called status. So it's still the correct thing. Um Let's do that one last time. So again, actually, you know, we could, you could totally imagine, uh, putting this into a, a DEV lobe of some sort where you're constantly doing this build and then you're constantly pushing, uh, via pulling me up and it's actually, like I said, fairly fast. Um, you know, this is done in seconds. Uh, we come back here. Um, we do pull me up, this is also done in seconds. Um, so you really don't have to worry ever about like, what it is to develop up on your local desktop. Um, you can totally imagine, like all the manual steps I'm doing right here in terms of like hitting. Yes. Uh, I can skip the preview. Um, all, like all the manual steps like ripping all that out. That would take that into, into seconds. Um, and, uh, let's mess something up and, and really like the DEV loop becomes way tight. Um, ah, ok. So this is actually still a promise. Interesting. I didn't realize that, um, I should just do this, probably should have read the fish. Uh, the fetch api before I try to do this. But this looks promising. So let's actually do that. We can do uh yes, skip preview. And so this will skip the preview and this will also just say yes. So you can, you, like I said, you can totally imagine skipping all those manual steps and, and then now we just refresh this and boom. 00 And we're constantly calling API because uh of the way you did use effect, um We actually wanna give this a uh a empty dependency list. So that way we don't constantly change uh the status. So let's uh do that one more time. Make sure we don't uh end up constantly coloring API and your first one last time. And there we go. All right. So that's pretty much what I wanted to cover today. Uh Next time we'll go through uh the next part of this. So basically we covered today, you know, doing land integration and then connecting our React app to the API uh If we look at the code, fairly simple stuff we added, all we did was we uh first we actually upgraded to Pulumi 2.0 which like I said, I'm very excited about. We added this path and integrated the this super simple method into the path and then I followed a bunch around with React because it's been a while since I really touched it. But uh we got there, we use Reacts hooks to uh create a state state variable uh initially was a null. And then we, we, you know uh set the set, we have the set status method that we use uh to set that actual state. Uh We created an effect which has a dependency, which has a null dependency basically. So it doesn't rerun and then we uh fetch from that API and then set the status um within there and then we display it. And so within just those few lines of code, we're able to integrate our React App uh with our API. So next time we'll cover uh like I mentioned, we'll cover uh going through and, and having that API actually do something with a back backing store of some sort. I hope you enjoyed this episode. Please follow us on Twitter or follow me directly as well. LMZN uh subscribe and like the video, please leave comments, always trying to get feedback on, on how these videos go, what kind of content you're looking for. Uh In fact, this whole series was inspired by a comment from someone asking for API gateway kind of example, connecting a React app with a back end. So yeah, hope to see you next time on modern infrastructure Wednesday. Thanks for watching.

---
