---
preview_image:
hero:
  image: /icons/containers.svg
  title: "Secrets and Kubernetes Secrets | Modern Infrastructure Wednesday 2020-06-10"
title: "Secrets and Kubernetes Secrets | Modern Infrastructure..."
meta_desc: |
    In today's episode, we are exploring how to maintain secrets in your infrastructure as code programs and how to provide a secret into a Kubernetes ...
url_slug: secrets-kubernetes-secrets-modern-infrastructure-wednesday-20200610
featured: false
pre_recorded: true
pulumi_tv: false
unlisted: false
gated: false
type: webinars
external: false
no_getting_started: true
block_external_search_index: false
main:
  title: "Secrets and Kubernetes Secrets | Modern Infrastructure Wednesday 2020-06-10"
  description: |
    In today's episode, we are exploring how to maintain secrets in your infrastructure as code programs and how to provide a secret into a Kubernetes cluster. Code for this episode available here:  https://github.com/pulumi/pulumitv/tree/master/modern-infrastructure-wednesday/2020-06-10  The examples are in TypeScript but Pulumi makes it easy to stand up infrastructure in your favorite languages including Python, JavaScript, Go, and .NET - saving time over legacy tools like CloudFormation and Hashicorp Terraform.  https://www.pulumi.com/docs/get-started/?utm_campaign=PulumiTV&utm_source=youtube.com&utm_medium=video
  sortable_date: 2020-06-10T05:16:03Z
  youtube_url: https://www.youtube.com/embed/9tufFgJfoKM
transcript: |
    Hello and welcome to another episode of Modern Infrastructure Wednesday. Today, we're gonna be talking about secrets and Kin secrets. So we'll talk about these two topics. Uh It should be actually a very, fairly short episode, but hopefully very insightful around just handling secrets in Pulumi and how to deal with secrets in. Let's get started. So I have a project here. We're doing this in typescript today. Uh Last couple episodes were in other languages. So I decided to do some typescript. And uh today, uh first, I guess let's just talk about like generating a value and then also like, what does it mean for something to be secret? Um So in Pulumi, there's this concept of secrets and, and same thing in communities and they're slightly different in terms of what they do. Um But first, let's start to like, let's just ate some data. So we can actually do this with the random package. So I've imported the random package here. I'm in a Pulumi uh environment already. And so we can actually just do something like this. We can just say constant, you know, like value uh equals and we can say we can give the new random and we can, you know, say we want a password. Um So we'll give it a name and uh this takes a length. Uh And I believe that's all we need. Uh You can see all these other options are optional. So let's give it a length of 16 and let's uh get that, let's export that value. So we'll call this export uh pw oops and yeah, result. OK. So this should just give us a random value. And um let's see how, let's see what this does. Mhm So you can see we create this resource random password and you can see we export and you can see in plain text, we have this, this password. Um And so obviously, that's not what we want. We want this to be a actually, you know AAA value that's secret and, and encrypted in our state. So if we, if we look at, you know Pulumi stack export, uh if we look at this, uh we can also see here that this is just right there straight out in the open uh completely unencrypted. And so that's not really what we want. Uh We want this to be a secret. So how do we do that? We can actually use this thing in bloomy called uh additional secret outputs. And this lets us specify if there are any fields uh that we want to be marked as secret. So in this case, we want the result to be marked as secret and we can run Pulumi up again and let's see what this does. So you can see it's actually gonna change this from what it used to be into a secret. So if we run this and now we go and try to look at our sack, uh we can actually see that here. Now, it's, it's, it's, it's an encrypted value. So this is no longer uh in plain text in our, in our state. Uh It's, it's nicely hidden. Um And, and this is related to the idea that, you know, when you, when you have configuration in Pulumi, so if you have Pulumi config set, you know, let's call this uh uh key and we have some value. Uh It's just called value um you know, in the config uh oops, uh it's just, it's just there, right? Key value. And so again, you know, in a configuration, you could have things that are secret as well. So we can actually do this. And if we do, if we look at that, now, we can see that this is actually marked as, as a secret. And so if we, if we actually look at the file, um we can see here, it's actually a it's a secure string. So this is this is also encrypted uh using, using the secret provider. So that's kind of the, the si similar things are happening there, we can actually bring that value in. So if we um and so let's we bring in the config and then we can say, and so we can try to export this and we'll see what happens and we should see the same thing you can see here, the, the secret key is still a secret. And so it's, it's never exposed uh in plain text, even though um obviously, we, we know during the program execution what the value of this is. So at any point during the execution of this program, we can pass these in to other things. And so this is where uh cupidity secrets come in. Uh or what, what I, what I want to talk about today. Um So you can totally imagine, you know, you wanna provide this secret value uh in your cluster and use it in some way. And so you could do uh something like this. And so you can create a uh this is the a secret that's native to the community is API and this takes uh so some arguments and here we'll give it the string data and let's call this, you know, uh key and we can give it the value and here we can give the the secret. And once again, you know, let, let's, let's just verify that uh this is all nicely um nicely hidden. Uh we can export this. And so now you can see if we're gonna go create this, this community secret. I, I'm running mini cube on my machine. So it's gonna, it's gonna stick into, into my local uh mini cube cluster. And you can see once again that, you know, the secret is actually the secret this is passed through. Uh So what's nice is, is, you know, here you can see that this was marked as a secret and because it's still secret, the, it, it, it, it uh the secret propagates through to, to the other uh outputs of this particular of this particular resource. So here it is still secret because when it came in, it was secret. Uh And so secret is, is something that, that propagates throughout the program. Uh And so if we, if we go back to our uh sack export and we kind of look at what's in here. Uh If we come down here, you can see in our resources, you know, all this stuff, all these outputs are always uh always encrypted. And so, so none of those things are ever exposed um to the program. And you can see here in, in the resource itself, same thing uh those are never really exposed uh in any way. Uh Except, you know, obviously until it's until it's used at run time. Uh So whether that's, you know, in, in the communities, if we, you know, if you're using, using Q cuddle or in some other, you know, some other fashion uh by obviously by the pod uh for, for uh for the service. So I just want to kind of walk through uh the various ways of, of making secrets and passing secrets around and then also finally uh creating a secret uh in communities. So hopefully, secrets are no longer a secret to you and you'll be able to use them with great success in your programs. So thanks for watching, please follow us on Twitter uh at Pulumi Corp or follow me directly at LMZN. Uh Please like this video and also subscribe to Pulumi TV. Uh Make sure you hit that little alert button to get notified of new episodes. Uh We'll do modern inscription Wednesdays, obviously, every Wednesday. But also uh make sure you get alerted to all the great content that we're posting to our youtube channel. Thanks for watching and see you next week.

---
