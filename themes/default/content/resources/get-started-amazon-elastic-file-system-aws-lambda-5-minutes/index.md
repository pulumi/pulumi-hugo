---
preview_image:
hero:
  image: /icons/containers.svg
  title: "Get Started with Amazon Elastic File System for AWS Lambda in 5 Minutes"
title: "Get Started with Amazon Elastic File System for AWS..."
meta_desc: |
    Pulumi now supports Amazon EFS for AWS Lambda. In this tutorial, Luke Hoban shows you how to get started using these new capabilities in Typescript...
url_slug: get-started-amazon-elastic-file-system-aws-lambda-5-minutes
featured: false
pre_recorded: true
pulumi_tv: false
unlisted: false
gated: false
type: webinars
external: false
no_getting_started: true
block_external_search_index: false
main:
  title: "Get Started with Amazon Elastic File System for AWS Lambda in 5 Minutes"
  description: |
    Pulumi now supports Amazon EFS for AWS Lambda. In this tutorial, Luke Hoban shows you how to get started using these new capabilities in Typescript, however, Pulumi's Infrastructure as Code platform supports many popular programming languages including Javascript, Golang, Python and .NET.   GET STARTED: https://pulumi.com/start
  sortable_date: 2020-06-16T20:21:51Z
  youtube_url: https://www.youtube.com/embed/zPj_JxaRJyE
transcript: |
    Today, the AD BS team announced that they've added support for Amazon EFS to A S LAMBDA. EFS was originally uh supported on just EC2. But over the last several months has been extended to support EKS for Kubernetes, ecs and fargate for containers as well as now Lambda for services together. This means we can use EFS as a extensible uh network file system underneath all the forms of compute that we can run inside the US. In this video. We're gonna look at how to use Lambda with EFS to do that. We're going to build a simple application. Uh, that application is gonna have an API gateway which talks to Lambda and implements its functionality using some Lambdas. Those Lambdas are gonna run inside of E PC and it's actually required to run inside of E PC to be able to work with EFS. Since the EFS, uh, network mounts run inside one of your VPC S, the one unique thing related to Lambda working with EFS is that we're gonna have an access point. Uh So we're gonna have an EFS access point that describes how Lambda is gonna interact with our file system. The kind of user, it should act as the permissions on the folder, it should uh interact with uh and what folder it should actually use to mount into the Lambda. And so we're gonna actually go ahead and implement this uh using Pulumi. We're gonna start assuming that we already have a VPC with both private and public subnets. And then we have a EFS file system which has mount targets inside each of the subnets. And for each of those uh mount targets, we're gonna put them in the default security group, but we could put them in any security group that are, that Lamb will have access to these VPC and EE EFS uh resources could have already existed or we could build them specifically for this application to get started working with LAMBDA. Let's go ahead and create an access point. The access point describes uh what file system we're gonna access what pos user we should access it as so we're gonna use user ID 1000 and group id 1000. And what path uh to mount is the root directory for this access and then some information about uh the, the owner uh for that and the permissions that we're gonna use inside that path. OK? So now we've got an access point. We actually want to create a Lambda which uses that access point to connect instead of creating a single Lambda. We're actually gonna go ahead and create a function in Pulumi which creates callback sports. And each one of those functions is actually going to have a set of policies which allow us to work within a VPC. It's gonna have a VPC config which connects to the subnets we specified and using the same security group to give us access. And it's going to have a file system. Config this being the new part that's available for accessing EFS. That file system config allows me to connect to a particular A RN uh of an access point which will use this access point above and then mount that locally under the slash MNT slash storage uh folder. There's a limitation right now that with uh lambda, you have to mount this under something underneath the path slash MNT. Um And so we'll put that under storage and our callback function here will let us pass in any function we want and create a Lambda that uses that. Let's go ahead and use this to create a simple API. Our API is gonna have two methods, uh two pads on it. One we can get slash files, slash and then any file name the other, we can post slash files and slash file name. This will allow us to get and upload files from any place inside our file system to that. We'll take the file name that is specified and we'll put it inside the slash MNT slash storage path. And then we'll just use our standard uh API S from within the language we're using. In this case, we're using no Js to read file sync from the file system. And this is the beauty of being able to use EFS is that we can just use the existing file system API S. We don't have to use a specific uh A S S3 API or Dynamo DB API or database API. So very easy to take existing code that works in the file system and extend it to work inside and EFS in this case, the get will call read file sync and the post will call write file sync. And finally, we'll export API URO. Now they're deployed our LAMBDA and our API gateway. Let's go ahead and access them. So I'll post to that API in point the content seller world to file dot TXT. Now, we can get those that file back. We can see that we return back the contents he world from the file system. Let's do one more thing to, to be able to see more clearly what's going on with our EFS mount. So we're gonna add one more method to our API which posts to the root route. And in this case, it just runs an EXEC, it does allow us to run any command we want within that LAMBDA to access the file system. So we can see what's going on uh at the UNIX level with the file system. As we can see, we have our file filed TXT. It was created by that same user we specified in our access point. We could even see that the permissions are what we expect for this user. Finally, we can just cap that file to see what the contents of it actually are. There we go. We got the same heller world that we saw before. This is a very simple example of mounting an EFS file system into a Lambda and interacting with it using our our LAMBDA functions. This creates a really easy way for me to write simple pieces of code that use file system API S from within my language to access uh all the capabilities of a large uh effectively infinite file system inside data. Thanks.

---
