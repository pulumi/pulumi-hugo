---
preview_image:
hero:
  image: /icons/containers.svg
  title: "Let’s Build A Multi-Language Pulumi Component | PulumiVision"
title: "Let’s Build A Multi-Language Pulumi Component |..."
meta_desc: |
    Lee and Matty from Pulumi build a new Pulumi package that supports multiple languages, allowing teams with different preferred programming language...
url_slug: lets-build-multilanguage-pulumi-component-pulumivision
featured: false
pre_recorded: true
pulumi_tv: false
unlisted: false
gated: false
type: webinars
external: false
no_getting_started: true
block_external_search_index: false
main:
  title: "Let’s Build A Multi-Language Pulumi Component | PulumiVision"
  description: |
    Lee and Matty from Pulumi build a new Pulumi package that supports multiple languages, allowing teams with different preferred programming languages to consume a best practice piece of infrastructure. Written in TypeScript, the package can be magically consumed from Python, Go, and .Net.  Get the code at https://github.com/jaxxstorm/pulumi-aws-fargatewebapp Try Pulumi. It's free: https://pulumip.us/Get-Started
  sortable_date: 2022-04-09T05:06:56Z
  youtube_url: https://www.youtube.com/embed/4psf6WVLxtY
transcript: |
    Here we go for yet another Pulumi vision live stream. Uh We're mixing up the day and the time. So we'll see what people think about it this time. Let us know in the chat if you prefer this new time. Uh, joining me is my pal Lee Briggs, uh, at Pulumi. Uh who knows a lot more about Pulumi and coding Pulumi stuff than I do. So, I'm really excited to have, have Lee on and we're gonna kind of dig into this idea of building a, a multi-language Pulumi component. Um I'll, I'll say what I think this means. By the way, Lee say hi, I just talked about. Right. Hi, everybody. Hi. We're just getting into it. Um, I got a couple of people watching. Awesome. Say hi in the chat for sure. The, the idea is, you know, could one of the things that's cool with Pulumi, right? Is we can write our Pulumi program in a ton of different languages. But maybe I sit and I'm like, OK, I dig typescript, right? So I, I don't necessarily, but we'll pretend, um, that's cool. But like, and I write a component resource, right? That I want other people to be able to use maybe within my organization or even outside in the community. And I write all that the, the SDK for it basically, right? Like the resource and I write it in typescript and that's cool if people want to bring that package in that because basically an N PM package at that point, right? And bring that in. But then it's like, but then over there, I've got my buddy who's like, well, I write go, how come I, how can I use your thing? And that would require traditionally, I say, I mean, actually it's been a while we've added this feature but before you would have had to then go and it in a whole, in a whole new language. Yeah, like who's got time for that? Exactly. Exactly. I mean, so the, the back story here really is we have this uh ad BS crosswalk written in type script which many people who you might know it as AD BS X. And uh we realized that if we were going to maintain this in all of our supported languages and keep adding languages, the maintenance burden was just going to be huge. And so what we did is kind of double back and add this multi-language uh capability. And the best example that I can really give here is like I have this example um installation of a uh application with a load balancer and a security group uh and a target group. And what I want to be able to do is allow my colleagues and community members who don't necessarily use typescript to be able to actually use this in Python and go and dot net and any other future language that we support. So, um what we're gonna do is we're gonna kind of take this existing looking at this and we're gonna take this existing. No, no, I didn't have your screen share. This is great timing. So what we're gonna do is take this existing example of the security group and the low balancer and the target group, blah, blah, blah, blah, all of these different things. And we're gonna make them reusable uh into a component. But then we're gonna make that component multi language and then we'll be able to consume this with Python. Um So we've got an hour. It's pretty ambitious. We'll see if we get it done. Yeah, we get it done um in your browser. Yes, absolutely. There we go. There you go. Just when we're looking at it. So we're not going to be making this pot reusable, which is just retrieving the, the creating an CS cluster and the VPC and subnets because we're going to use those as inputs into our component. But we're gonna make that we're gonna create a security group per web application. We're gonna create a low balance per web application, target group listener, uh an I AM role and a policy attachment and then task definition. So there's gonna be a multiple different Pulumi resources in this kind of reusable component. So if you, you know the, I just want, I'm not sure. I, I, if I misread said, is this the Pulumi equivalent of Aws CD KJ? Si I, the J SI I is the thing I'm not familiar with. So J SI I is the mechanism that allows a W CD K to transpire languages from javascript into all of the other CD K supported languages. It's a, it's a language converter. What's unique about Pulumi is that we don't convert languages from one language to another. It all happens in the Pulumi engine. So we kind of like have this capability of, of creating multi-language components, but we're not gonna convert this code from one language to another. We're gonna write it in this code. Uh We're gonna write it in this language and then we're gonna use the Pulumi engine to create output types for the different supported languages. So that's the, the kind of unique and maybe just to sorry if I read correctly, like the J SI I, that sort of requires you to start in Java, right? Like now in this example, we're starting with typescript because that's what we happen to have. The same idea would happen if I wrote this in go first, right? And I, I commonly use go because go is my kind of like go to language, I commonly use go as the language to write multi-language components. So multi-language packages, but I decided to do it in in typescript today. Um simply because it's just less of a bo and it's, you know, it, it is just a little bit easier to, to kind of like gonna go through. So um if you at home want to create a multi language component, the first thing that you would do is go to one of our component provider, boilerplates. These are template repositories that we have in our um Pulumi organization, we have template repositories for all the supported languages that we have with Pulumi. So typescript Python go, I don't know if dot net is there yet but I, I believe it's, it's on the way because I remember seeing something in the hackathon and it's as simple as doing uh clicking, use this template and then you would create your repository name and then you would end up with something a little bit like this. So we're going to create an Aws Fargate web app and um the, the boiler plate or the, the kind of template repo uh has this kind of reference to XYZ in it. And it's gonna create a static page example. So it, this works like if you were to go and actually build this and use it, it would work with no problems, but we don't want to create a static static page. We want to create a, a far web app Right. Uh And so you do need to do some kind of set up steps here to replace some of the boiler plate and to replace some of the um you know, the existing code because that's what boiler plate is. Yes, absolutely. 100%. Um So what we're gonna do is I'm just gonna uh first of all, I'm gonna blow away. So if you look at the, this is in my uh C area, I mean, I, I kind of, I kind of already went ahead and clone it. So we're gonna blow away this examples director here and this SDK directory here. So the SDK directory in a Pulumi multi-language package is um generated for you. So uh the existing code in here, all of this stuff here, this dot net go. No, Jess and Python, we need to get rid of all of that and kind of start from scratch. So can you, you want to just like give a quick like just click out like I'm, I'm poking by the way, Lee Lee shared his visual studio code with which I'm looking at it, but just to sort of show we aren't gonna dig into it, but like, yes, hold on, like just to give an example of just how, you know, like again, it was, it was very nice of them to do this, very nice of the template to do this for us. And now we're going to go delete all this good work. Yes. So this is just gonna create the static page resource that the template provider uses. Um And you'll notice we're not, you know, we're not actually compiling like um and this is no, so this is a bad example. So let's go to, to Python here and you can see it creates a Python package in the SDK directory of XYZ. And you can see this static page here, but it isn't converting the code that we have um set up into Python code. It's only exposing the actual properties. This will make a little bit more sense when we finish doing our far web app application. All right. Well, let's just go ahead and just, just, just delete it with, let's blow it away. Yes, exactly. So you can see here. I'm gonna remove the SDK directory at Python. No go and dot net. And that's all gone. And so um we, we, we're at a, we're at a relatively clean, clean slate here. We're also going to remove the example's simple directory because we are going to create our own example at the end and it's gonna be complicated, it's gonna be a little bit more complicated. Um And then um so what we I ever do is simple. So, yeah, so now what we now need to do is look for all the references to XX YZ in this particular package and replace them with uh what we're gonna call our package. So we're gonna call this Fog Web app. And so there's a couple of places that you need to replace, uh, replace this, this string. So we're gonna call in the make file here. We're gonna call this Fog Web app. Can I ask a question that because I know what I would do and, and I want you to tell me if this is a good or bad idea. Um Is this a safe, uh, search and replace across all files? Is you, you don't get, you don't get ad it thing like Michael Scott in the office. Um But yeah, you can just do a search and replace. OK. IIII I just wanted to check cause because as soon as you said that I was like, that's where I went because I'm lazy but I mean, it's probably a better way but I, like, I understand you want to show like where those examples are. Yeah. Um I'm, I'm a little bit more um uh like uh reserved than most people, but I know when I was going through this with uh our CTO loop yesterday, that's exactly what he did. He did. Um Hey CTO is busy, busy, busy. He's a busy man. Yeah. Um So I'm going to replace this XYZ with Fargate. We and I'm gonna replace uh So this is the go mod that actually gets created when uh we build our package later. Um I'm gonna rename nice these directories. So that's gonna be called Fog Gate web app. I'm gonna rename this the Fargate Web app. I can't spell far properly. So, uh, let's see what else we've got left, um, in this provider Go module here, we're gonna do Far Web app. And you're probably wondering at this point, like, why do we have a Go module um, inside here when we're going to write this in typescript? Well, the exact, the reason for that is that we're actually going to embed into our final output, uh the scheme a file and it uses go for that portion. So you can do all of the work in typescript. Um I just moved, I just moved it around a little bit because like our beautiful faces were covering up some of your code and no problem. Um So there is a little bit of go code in here um in this, in this provider command in this generator. So when we do a generation, it's actually gonna use a little bit of go. But the final result is gonna be in uh in typescript basically. Is there any uh so along those lines, um if you're doing this and maybe you're not a go developer at all, you might not even have go installed on your machine. Like you would need to have go installed, you would need to have to go, you have to go one time at least. Right. Yeah, that's exactly. Yeah, you would need to go command. Uh Yeah. Um So then we got another web app here and then another one here and then I think there is one more at the bottom. So this here, let's just talk up a little bit about this. Um So this schema file is going to tell the Pulumi Engine information about our Pulumi package. So this is gonna tell, um, we're gonna come back to this a little bit later. This is either a Jason or file that is gonna record. Yes, it's in the root of the directory. It's gonna represent the final result of a uh Pulumi multi-language package. So the information that we have here are, for example, the input properties that we're going to add to our multi-language package and then the resulting output properties. So when we create a resource, we want to be able to like pass outputs often. Um And so we have the outputs. It also has metadata about the dependencies that our um resulting dks are gonna have. So, for example, because we're creating a multi-language package that is going to create C A bindings for AWS. And for Python, it's going to tell the actual resulting component that when you do uh PP install Pulumi Fargate web app, it also needs to pull in the Pulumi dependency and the Pulumi Aws dependency. So this schema file is uh really, really important when you're actually building these packages and we're actually going to come back and edit this at the end. Um but let's just update our um names here. I'm gonna do fog we like. So I think that is all of the immediate need to replace YZ. So um yeah, so we have, you also have some of the components that it created like the bucket, read the properties and stuff. But we're just, yeah, we're gonna be, we're gonna be removing all of this once we fleshed out our components. But right now if we did a build here, this wouldn't work because um it, it eventually this would stop working because um in our example, static page, we create a bucket and a website URL. So what we're going to end up with at the end is just a URL for our Fargate web application. So we're going to replace a bunch of this stuff later down the line. Um But I like to and I just think I found one again. I may be. Did you uh look at and the schema look at line 40 line 40? You've got the import base path is Pulumi Xyz or no? Oh Why is mine not updating? I don't know. Yeah, I, I thought I just save it. Maybe you need to save but I should have auto save. Turn on. So weird. OK. Well, go figure um we get to experience visual studio code live share right now. Yeah, we get to experience the phone of VS code live share. OK. Well, fair enough. Um So just a recap of where we actually got to here. We, we um we just replaced all the references to um the boiler play XYZ string with um Fargate Web back because that's what we're going to create. Now, um The next thing that we want to do is we need to decide what a, what an instantiation of this. We Fargate Web app, web app is going to be called because the idea with components is you can call them multiple times. And so I am going to make the executive decision of calling this a deployment. Um So we're gonna be able to create a deployment of a Fargate web app which seems to make a little bit of sense to me. Um And so this here, this type token um is a decision that you kind of make when you're building your multi-language component. So it's, it's usually something along the lines of a noun and a verb basically. Um But we're, we're gonna be creating uh a, an instantiation of a deployment of our Fargate web application um which is kind of like our um our decided way of deploying applications. So um the 1700 different ways to deploy applications up to now in a itself. Yeah. So what, what, what we're gonna be doing here is gonna take this existing stuff here and putting it into our Fargate Web application component. So right now we have this static page file um here. Um And we're gonna rename this to deployment because we've decided we're gonna create a deployment of a Fargate web app and VS code is gonna be nice and helpful for me and allow me to do a uh an update there. Um So we've renamed this um static page dot ts to um deployment dot TS. And um that will allow us to kind of create a reusable component. And now we're at the point where we're gonna start writing Pulumi code. So um let's um make sure that we have all of our dependencies so that I can get um uh inte sense working plume resource five gate web app M PM. Install A W No, because we're using Pulumi Aws. We want to be able to actually install this into node modules here while we're doing our development cycle, this is not gonna get bundled up into the actual resulting deployment. So this is just for your, just for my Yeah, for my uh you know, for my own benefit of getting a bunch of things here. So this is what a Pulumi component resource looks like. You may have written component resources already in your Pulumi uh life, which is just a uh a nice abstraction that you get in Pulumi that allows you to create uh reusable instantiation of um code. Now, if you've already written a Pulumi component resource, what we have right now is you could copy the Pulumi component resource you already have into this directory. Here. That's Pulumi resource, name of um name of a multi language component. And you pretty much two thirds of the way there or even 4/5 of the way there because we want to write a component resource and we have existing code here that is not in the format of a component resource. We're gonna convert this now to a component resource. I did consider just copying this over um and, and turn it into a component resource for the live stream. But I thought we'd be a little bit more ambitious and try and actually write to component resource in in the process of the stream. Our our reach should exceed our grasp. So this is, this is all your proof that none of this is slick demo. We are, I mean, II, I haven't actually got this working yet. So we're in full like we're in full. Uh Let's just try it out. Uh Also I thought peers like said he was gonna like be sitting back with a beverage and you know, yeah, II, I was fully expecting belligerence at this point. But yeah, absolutely. Um So what I've done here is because we have the static page um parts of the component resource, the interface if you're not familiar with typescript is going to allow us to define arguments and then the actual static page itself is going to create the instance of a deployment. So I'm just going to rename these to deployment uh arguments and then deployment and again, you could search and replace here. But you know, I like to be a little bit more explicit in what I'm doing um deployment arcs. And then remember we have an XYZ here, so we want to replace this with Fargate web app and then a type of deployment. Oh And if you look at the original boiler plate, you can see it's gonna create an, an AWS bucket and it create a bucket object and it's gonna create a bucket policy which would create a um kind of like a static web app. What we're gonna do is replace this on all of this with our um ecs uh example. So I'm gonna rip all of this out and we have a basic kind of like uh empty component resource. So this isn't gonna create any um This isn't gonna create any resources, but um once we add our Pulumi code here, it's gonna turn it into a Pulumi component, right? Um So we're, we're in a very, very good place now with a kind of like straightforward empty kind of like container to put all of our aws uh code into um one quick thing that I want to check here. Yeah, so this hasn't updated dated. So in this provider dot T si just need to change some um references because we have um changed the name of some stuff. So that's gonna be Fargate we and then we're gonna create a deployment. We're not gonna construct a static page. Do you know are, are you open to visual studio code? Uh Power tip? I, I always am. OK? Well, we'll stop first. OK? We'll go ahead. Do what you do. Finish that one up. OK? So select static. OK? Stop typing, undo what you need to. OK. Select static page, just static page, not the AGS uh I've removed all the references. You got them all already. So, no, no, no, no, you're good. You're good. Oh All the ones that look like that. Yes. OK. But you know, you can do command D and that will multi cursor select all the instances of it and then you could, but you wouldn't. So just to show you the exact here, hit, hit can command Z a couple times. I wanna show you how to do this. So I want you to have two. OK? Good, good, good. OK. So now you have static page selected, right? Hit command D OK? Now let's start typing in your thing and it's gonna replace both of them. Yeah. So you could have done that all over. Now, it wouldn't have caught the, the, the urn one because it's not, but you could, you could have done it for all of those right there. You know, I'm, I'm, I'm still only a couple of years from using V I for everything. And so the multi cursor and that's not A VS code. VS code didn't invent that. Like that's been a, that's like a sublime text thing. And uh Adam, it's hugely awesome. And that's, to be honest, multi cursor is one of the things that keeps me in a thing like this instead of them time because that is just really cool. Well, you can certainly do it in Vim and I know the Vim bindings. I just, uh I haven't, uh I haven't, haven't graduated to the uh Exactly. Um Cool. So we're now in a place where we've kind of replaced all of the references to, to static page, which is kind of where the boilerplate is. And for those of you who are watching at home, we thinking, man, there's a lot of manual work here. We know there's a lot of manual work here and we have an awesome team of people that are working on making this even easier. Um So that you don't have to do all of this search and replace and that you don't have to kind of like rip out all of the boilerplate stuff. Remember, this is pretty new to Pulumi. Um And so we, we, we're kind of like constantly adding new things to this particular part of the, the Pulumi ecosystem. Um So there's a lot of manual work right now. Uh But there's way less manual work than there used to be. And uh I actually saw a demo earlier today of somebody, uh somebody awesome on our team Daniel who has, um, kind of made a lot of this stuff way, way easier as well. So a lot of manual stuff right now. But, um, you know, by, by the time you kind of get around to kind of having a go at this in six months, maybe, um, this should be relatively straightforward. OK. So what we're gonna do now is we're gonna be able to do a lot, a little bit of copy and paste in. So, because I have this existing uh Fargate web application here, what I'm gonna do is I'm gonna take all of this stuff. Think so and I'm gonna paste it into my component resource um because we've already written a bunch of this Pulumi code so I can paste it into my component resource like so and then I'll do a format document to make it look nice and pretty. Um And then, so what we need to do now is just make this uh make this valid Pulumi code for the component resource. So I'm gonna use your little trick mat and I'm gonna change the example here and I'm gonna change this to name and you could have hit more. There's, there was more than the one because I see 56. Well, actually, I just realized that I need to actually, this actually needs to be a uh variable. So this is gonna come from the constructor um here. So when we create a new uh security group, we're going to grab the name of the actual component resource and pass it through to the security group here. Hey, remind me just because I'm following along on, on your live share and it could be funky deployment dot ts. Where is that in the file system? It's in um the type of resource. Yeah. Yeah. Right. So, um as we're kind of like turning this um this security group into a component resource, security group, the first thing that's gonna come up here is that you're going to realize as you are like creating some stuff that you want some of these inputs for this component resource to be configurable to the user, right? And the first thing that I'm running into here is this VPC ID, right? In the original example, I created a VPC in the actual or I grabbed the default VPC from my um you know, from my code, right? Uh So II, I grab the, the VPC in the Pulumi program, but if we're making a reusable instantiation of a deployment, we want this to be configurable to the actual downstream user. Um And so this is where we start to populate our deployment ads interface. Um And so what, oh sorry, go ahead while you're doing that. I wanted to sort of make a point about the idea of this is sort of like the thing that he's talking about is one of the reasons that make component resources really cool. And in this example, we're probably gonna expose a lot because this is a little more community, this is a little more whatever. But think about like within your organization, you might have, you might only want to expose a couple of the parameters, a couple of the inputs because you have standards in your org. And the, the example I've always given it like back in the chef days when I would talk about writing like a resource provider, I always would give the example of Tomcat. So we're dating myself here a little bit. But you might, you might think about something like Tomcat has like 100 different configuration parameters but a developer who or someone who just wants to instantiate it, that's not the middleware admin. There's like three things that either a they care about or and or that we want them to set. So you just expose that, right? So in this case, we're gonna probably expose almost everything because yeah, I'm gonna try and make this as, as, as, as, as like reasonable as possible. We could, we could make all of this like configurable. Like we could make the side of blocks configurable and the po configurable and all that kind of stuff. But you know, like as you start to add more stuff, we could be here all day adding configurable stuff. So Oh sure, sure, sure. I was just sort of given like the for people put in the context of how they might do something like this. You, you expose as much as the consumer of this as you want them to have because you uh within your org, you know, your, your place, you're the subject matter expert on all these pieces. So you can, you can and that, that just gives a lot of power for consumable of it with, with putting guard rails in place because a lot of times when we think about this about, you know, releasing Infra Code and stuff like that outside the organization, it's like, oh, well, then how do we make sure that that folks are following our good practices and this is one of the ways to do that, you know, um is to, to just have building blocks that just start the, the shape, you know, that, that provide the shape and then people can set the dials, you give them to set that are, that are appropriate, you know, from that. So it's, it's one of the things I really like about being able to do things like component resources and exposing them this way. Um It democratizes the Infra Code across the, I mean, you, you, you did a really good job of like kind of like defining what I personally see as, as um you know, the, the correct way of doing this. So what I'm just doing here while we're kind of like uh on a, on a time crunch is adding um more input. So the subnet I DS is a great example of like something that you're going to want to um allow to be input. Um So if you ever like wonder like, what do I want to make the type of my input? You can see here that the uh um the Pulumi input ID here is, is, is going to um be a uh an array of different things. And so I'm basically gonna copy that input like, so um so this is um allowing us to pass the Subnet I DS from another created uh resource when we use our uh multi language component. Um This will make a little bit more sense if you've never done a component resource before, this will make a little bit more sense when we kind of get to the end when we're doing the example in Python. Um So let's replace our VPC ID here, uh our VVC ID because we wanna make that, that configurable. Um And then um we can look at, we got uh our listener, I'm gonna remove this here. We do need to update the names of these resources. So I'm gonna remove the string here and allow it to be a variable. And I could probably do the search and replace thing that you show me, but I'm gonna fall back to what I know and uh you know, stay in my comfort zone and do it all manually, but we can still pass the dependencies between these resources. So we can still pass like uh the role that we create inside a component resource and we can pass it to the list uh to the policy attachment, for example. Um So we can still make this relatively straightforward. Um I'm gonna change the family here to name. Um And then the other thing that we're gonna be able to do here is um allow the um the actual um the actual container definition to be configurable. So I did do a little bit of um I did do a little bit of prior um work here because we do need to be able to make this um uh we do need to make, make this configurable, but we want to allow Pulumi inputs to be in to be put in here. So um ecs particularly has um a uh a property that is a string so um that you're not allowed to pass inputs to a container definition. But if we want to build a, um actually, I'm gonna make this relatively straightforward because I don't wanna, I know we're running out of time. So let's make container name a standard string rather than a Pulumi input all kinds of time. Don't worry about it. Yeah. Um And so we're gonna put a dot container name and then we also want to make the image configurable. So we'll call this container image. We'll add that to our input stroke to contain an image string. So we can see, you can see here, we're, we're making a bunch of these things configurable for our downstream users. Um And then we're, we're getting close to the point where we've kind of got a completed uh multi language component here. Um We do need to allow the cluster that we're going to um to pass to our multi language component to be configurable. So let's make this A dot cluster A RN make that and put that into our interface. We have a, we have a couple, a couple of new folks. So Nova Chris, Nova sent a bunch of people over to us. So we are just catching up. So while you're typing, just gonna give a quick, quick update. So one of the things that's cool here and again, because if you're, you're coming in, you'll see that Lee is writing this component in typescript. But what's gonna happen is it's gonna be uh made available in, in all the languages plumy supports. But as we, we covered this a little bit earlier in the stream, you could have written this in go if that's where you wanted to start. I usually write them and go. So you probably learn. Has this guy have a re written type. I'm just gonna go out and say if you're coming from Novas Stream, you're probably a gofer. So that's why I Yes, absolutely. Uh A lb dot DNS name. OK. So what we have here, I think um is a uh representation in our multi-language component of um the uh far web application with some configurable inputs, for example, a VPC ID ID container name and contain an image. Um So we are pretty close here to something that is actually gonna be able to build. Um the final thing that we are gonna want to do is allow us to actually put what we call out output. So like the result of some of the the the stuff here. Now, something that I generally tend to do is expose a lot of this stuff. But in this particular best practice implementation, all we want to allow our um downstream users to be able to like access is the DNS name. So the actual load balancer, DNS name that we're gonna be able to create um when we um create this because it's gonna create a bunch of resources, right? It's gonna create um a bunch of resources and a security group and a bunch of other stuff. But we want to allow people to be able to actually look at the DNS name for the low balance that's gonna get created. So what we now need to do is configure some outputs and I'm gonna make this uh me, give me a second. Let me look at my reference example real quick. Uh What we're gonna do is expose this as a read only value public read. I think I'm putting this in the wrong place. So um pro provide a command there we are. Yes. So I'm gonna make this read only. So while you're sort of wiring this up, like when we think about how this could be used, um Because there's, there's a couple different cases where you might write a, a component resource like this one might even be to the level of that you're providing it to the community, right? But it could also be again, like we said, it's within your, your organization. So that being said, like how you share it is really dependent and it's, it's what, whatever way you share libraries and stuff in that way. So, right, if it's gonna be public, you're gonna push it to N PM or you know, Pipo in all those different places or if you have your own internal way of consuming them, so maybe it's published in that. So just think about it any other way you would share a library with the appropriate audience. That's how that's gonna gonna work out. Yeah. In, in a couple seconds, we're gonna be, we, we're kind of done with the code part of it really now at this point. Um And so um we, we've added our code and there's a bunch of things I could do to improve this. But, you know, I, I am conscious of the time and I want to at least get a, an example running. So, so like this is not the best typescript I've ever written and the one that I check in will be a finish. I know. Right. Um So, but what, what we are, what we are going to do is create a couple of art, like a bunch of different artifacts as a result of this. And I'll talk a little bit more about those when we uh when we go to our build stage. So we've, we've kind of completed the code part of this now. And so what we need to do now is wire up some stuff in the Pulumi schema itself. So in the schema dot JSON, we need to wire up some stuff in this Pulumi schema. So that Pulumi is able to um like uh understand when it does its generation part, we need to make sure that we're able to actually guide like Pulumi knows the things that it's gonna have as inputs. So all of our inputs are defined in this deployment arg struck here. So what we need to do now is um kind of make sure these are available in the scheme itself. I saw an awesome example earlier today of how this is going to get easier in the future. Um And so it is gonna be really, really straightforward in the future. There's a little bit of manual work that we have to do here. So we're gonna take all of these kind of input properties and replace them with our input properties. So we're gonna do VPC ID and we're gonna uh which is obviously this input here and we're gonna say the VPC ID. Uh This is also possible in uh yam too if you want to do this for the schema. Um But uh just for my perspective on this because again, when I think about one of the things that I think is awesome with Pulumi is because all of this stuff is built into the package, right? So like all your type ahead and all this, this is so these descriptions, this is all the stuff that someone who's consuming it when they've imported your package in whatever way they're using this that's gonna give them. So like, you know, you want some whatever in this particular case, there are pretty straightforward, you know, but if there's any kind of specific parameters or specific things and again, getting back to, I always sort of go back to like the internal usage of this, right? Like you can give a lot of interesting hints that are, are helpful that people might not even know. Like for example, the VPC ID, like maybe, you know, you could say go look that up in our, you know, confluence or whatever. Here's how you find a VPC. I don't know. This is a, there's a terrible stupid example. This is, this is gonna just be the the types that are gonna get passed through to the actual like SDK that's generated. That's what I mean. So I'm saying it's, it's, it's actually so the, the, as, as, as someone who's creating something for re, for reuse by someone else, you have a lot of power. Absolutely. Make it easy. And, you know, you're gonna be pretty genericized when it's something that's like for external. But like you have, this is one of the places where I think it's, it's a really great opportunity to super enable folks who might not have that knowledge too, right? You know, so, you know, in your organization, you know, a VPC ID, like you might have folks who are going to wire this stuff up who don't know what a VPC even is. Like, you could, you could put more information there because they'll see that when they're trying to use it. That's, yeah, you, you, you can basically populate all of this stuff um with any description you want like put it if you're doing this internal at your organization, you could put like explain the links in here. Yeah, there's loads of different things. We don't need to do that right now. So sometimes you want to have optional inputs in your component. We don't have any of these for this particular example. Um But you sometimes want option inputs. So there's this required inputs here, which is gonna tell the SDK um like all of the actual um things that we need to pass when we kind of instantiate this. So all of these are currently required So I'm gonna add them all to this required inputs array. But you, we could make some of this stuff part optional. Quite happily. Um If, if we wanted to, um you know, depending on the language that you are using, you would just want to make them optional here. So for example, I can make this optional in typescript. I know that I need Subnet I DS. So I'm definitely not gonna make that optional. Um But a great example of using optional stuff is like, like if you know the default ports, for example, like we've hard coded a lot of the parts in here. But what I could do is allow this to be configurable and provide a default. And so the schemer allows you to kind of make these um um kind of like required or not. So that's uh that's right there. What, what, what lee kind of alluded to goes back to like a real foundational principle of creating reusable infrastructure as code, which is as much as possible, provide reasonable defaults. Yes, absolutely. Um And again, in your org, they may be things where it's, it's not configurable at all, but almost anything that's configurable as much as possible. And again, we're, we're, we're going through relatively quickly. We're not creating the most perfect thing, but when you are creating the closer to perfect thing, providing reasonable defaults is, is a really good practice. Absolutely. Yeah. Um And like I, like I said, I could make the pot configurable and all that kind of stuff. But in the interest of time, I'm just gonna kind of throw in a bunch of hot coding here and uh and show you what the result is. Um And then the final thing that I did while we were just having a little chat there is that the, I'm also gonna um specify the output property. So the things that I want other people to be able to use um when they have created the the the components. So for example, I may want to expose things like the task definition name in future or the I am role name or maybe other things that are in here for now. I'm only exposing the URL because I'm trying to create something that's relatively best practice for like my poetical internal organization. So you can set the output properties that are available here. Um And then you can also make some of those output properties required as well. So there are situations where you can create components and it's like an optional output. Um And so there's this required array here that um will um you know, make sure that um when the actual component has, has been created. If that property doesn't populate, then something has gone wrong. Basically. So we've actually, I think uh and you know, this may be my famous last words, I think we've created a multi language component now one way to find out, I think we find out. So what we are now going to do is we're gonna use our make file to build all of the sdks. And so let's take a quick look at this make file. So it's going to create a few artifacts. It's gonna create a binary that needs to be installed on your system. And then it's going to create an SDK for all of the different languages. So we got this generation target that's gonna generate the go dot net, no, GS and Python sdks. And it's got this build target, which is going to do a build of the actual provider binary itself. Um And so this is all going to kind of get set up for you. You remember earlier, we replaced this pack for XYZ with Fargate web app. Um Like so, um and so let's give this a try. I'm going to do make generate, build and install and hopefully we won't get any errors and I'm in the wrong direct. Actually, it'll be really, it's, it's that thing when you run it the first time and you don't get errors, you're like something actually, probably, I mean, if this works first time, I'm gonna be, I mean, yeah, unsettling. So what you can see is happening here. Look, it's taking that schema dot JSON with Go run and it's generating an actual a Pulumi engine. Schema that's gonna get passed through to the Pulumi engine when we use this. And this is a pretty good sign that the actual schema is valid. If you do make a mistake in the schema, this error, this will error and tell you, hey, you screwed up, you added an input or an output that you missed. So now it's generated the schema and it's actually kind of like ready as an artifact. It's then gonna go and generate all of the SDKS. So one thing I've, I've popped the, I've featured the, the chat message a couple of times. Uh Fraser mentioned that there is future work that will remove like the go dependency even for this. So like which is cool. Um If you aren't a go person. So yes, but for now, you know, it won't, it won't, uh you know, it won't, hopefully won't offend you too much if you're a Python uh purist to have to put the go. Uh So if I write it, will it say I screwed up? Um If I write it, it definitely will say I screwed up. It is, it is pretty like we have made a lot of different changes here in terms of like error generation and stuff like that. So, um yeah, you should get pretty, pretty good feedback from the actual build itself that tells you the mistake that you made. Um This is looking pretty promising. So you can see here, we generated our typescript SDK because we run it in typescript, but we still need to create a type type typescript SDK. Um And now we're going to generate the dot net SDK and we're going to generate a Python SDK. So that's just generated a Python package and a um a go package as well. So if you remember earlier, uh I'm gonna bump up the size a little bit. Yeah, I was gonna say some stuff happened here. It looks like you're back to your prompt. So if you remember um earlier, we blew away all of these SDK directories and they've now been repopulated. So we now have a valid multi-language component with a deployment like so which is exciting because I think that means everything went, uh everything went very well. Um And I gonna that down a bit because I'm having trouble seeing that. So we've created our dot net SDK, we created our Python SDK and our go SDK and our javascript SDK. They're all available in this SDK directory like so, so we've now created a multi language package that's consumable by all of the supported Pulumi Pulumi languages as we add more languages in the future. Um which is an exciting prospect. Um As we add more languages in the future, you should be able to just update your Pulumi dependencies to have the latest version of the Pulumi um Pulumi SDKS and you'll also get support for any other languages we add in the future. Um Oh, sorry. So in theory and maybe if I'm I'm stealing your thunder is that you're saying, like, let's say we do this now. And let's say, you know, we, we add support for a, in the future. I'm potentially picking a language. I doubt we would do. But that would, I don't know, maybe that'd be cool to, like, all I would have to do is just sort of like you said, update my providers or not providers but my internal stuff and then just run that make command again, basically correct. And you will get all the support for all the languages that we eventually add support for. Um So we've written this, can I ask a question? Like, is it reasonable? Like you could even put that into like, like you sat and just ran that here, but you could put that even into some kind of a uh github action or, or, or something that just automatically builds those and, you know, so you don't have to sit and do this yourself. Like it'll just keep, that's what we do for a lot of our um providers as well. Like we do the generation part obviously in excuse me in C I. Um And so yeah, so you, you're essentially gonna kind of automate a bunch of this stuff. So we've written a multi-language package in typescript and I could obviously consume this multi language in typescript, but that's not super exciting, right? Like we sound like much fun at all using the same language that we already use is really not what we're here for. So, what I'm gonna do now is I'm gonna create an example of using this particular thing in our Python SDK to show you the uh cross language capabilities. So it's very nice of you as the component author to actually provide some examples. Absolutely. Um So what I'm gonna do here is I'm gonna create a new uh Aws Python uh project in my examples repository Python Fargate example. So I'm just using the Pulumi new command to create um a um you know, I'm just using a Pulumi new command to create a new Pulumi project. This is just an example of how we might use this in the future. I'm gonna close all of these down, right? So where was, oh, that's a deployment dot pie or no, no, sorry. That's in examples. Um You don't have it, you don't have it. Oh Because you closed, you closed it out of VS code. That's why I, yeah, I just, I just close all the old stuff. So I think I'm not following you anymore because I clicked on stuff. So let me again. OK. Now I see. OK. Now I see. Oh, it's still got, you got provider dot ts open but not your example. Um OK. OK. So in our examples, Python thing here. So we've, we've added the Pulumi Aws dependency. What we need to do now is add our Python uh SDK that we generated um into this particular project. So I'm gonna go into the V virtual. Mm Because Python loves virtual MS like so and then I'm gonna do pit three install minus E so I can use a local package SDK Python bin like. So now what you would obviously normally do here is you'd publish this to PI P or something along those lines, but I don't wanna go through that hassle right now. So I'm just gonna use the local install like so and this is promising. So you can see here we've a success, successfully installed a uh a new um you know, a new uh package with from our local SDK. That means that the, the, the SDK that we generated is is more than likely valid. So our multi-language package is more than likely valid. So let's um so if you remember in our example code here, we did need to create our own cluster because remember we're going to make that a configurable input and we also need to retrieve a VPC um from our um you know, from our existing A S infrastructure. I do have some code that already does that. So we're gonna save a little bit of time. So this is not a typing tutor. You know, we don't have to watch A S. So what would be cool? OK. So you're gonna do that, but you're gonna, you're not gonna copy paste in using our component because we know, so I'm just gonna add the cluster and then outputs and stuff like that. Yeah. And then let's import our Fog Eight web app. Um uh oh, it's actually called Pulumi underscore eight. And I need to actually to get my um auto Complete working. I just need to do this is I'm paying close attention because this always screws me up because you, because you installed it in the, but it's not installed like getting, getting uh and my auto complete is set up to grab from my site packages. My my um yeah, and I installed it in the VM. So I'm just gonna do was uh 58 web app that should have worked. But it's not. No, because it's, this is I've run into this all the time and it's only with Python. It's only in VS. Python is my least favorite line and, and, and, and Kat and Laurie yell at me all the time because I use VS code and it's always been working VS code. But I think, and I recall this from a workshop you did before. Is that you install the packages outside of the Yeah, that's what I, that's what I do. But I think there's a way you can tell VS code, you can force it to say like what, what, what like environment it should be using. And anyway, like the problem is everybody I know who like is a Pythonista is also not a virtual visual studio code. So nobody has a good answer for it. So it looks like um that works. So do app equals web app do. Oh This is, this is promising. So you can see here, you can see here. Um Remember we created an instantiation of a deployment. So now we are, we are getting access to our um to our typescript component directly from Python. Um And so I'm now able and I need to put this on a new line like, so I'm now able um to uh start populating this from Python. So we're gonna do just to be OK. So you oh you autocomplete deployment arcs there, right? So, so I feel oh wait 00 You know what's fun. OK? Got it. See, I'm sitting and I'm watching the VS code live and it doesn't show all of this. So I'm thinking it's not working. No, that's awesome. Yes. So remember we, we, we made our cluster A RN configurable. We're gonna make our uh cluster. So cluster A RN equals cluster dot A RN image uh container image equals let's just apply X and we're gonna call it X like, so what other inputs do we need? We need the Subnet I DS. So we got those here. So Subnet I DS equals subnets oh I DS like. So this is also showing off a couple of things that I love about Pulumi because we're writing in a programming language like Python, we're able to get those things as just properties that come off of that sub nets. My personal experience as somebody who's used almost every other infrastructure tool that you could possibly think of is that I am so much more productive in Pulumi than I am in any other language. Um Sorry, any other, any other tool simply because of not having to cross reference a bunch of stuff all the time and being able to examine and look at the definitions of stuff like so if you remember, we, we generate, we just generated this deployment ags here and we're getting all of the inputs um from, from here and look, these are all the descriptions from our schema, right? So the container image, the container name the subnet I DS. Um And then we got nine minutes left. This might be a successful. Uh I think, I think we're good, man. This is exciting. I'm gonna make sure I'm on the right account and right. So I'm going to pull me up the moment of truth. No. Oh We missed the VPC ID. That's why. So, so the error here is it's telling me that um the we're missing the VPC ID. We haven't added it to our input. So let's do VPC. Uh man, I, I am not a fan of Python. Uh VPC ID equals VPC dot ID, like so PV S code command, let's look the interpreter. Yes. Thank you. Let's try another Pulumi up. So, oh, I know, I missed a step. I missed a step. This is gonna error. So what it's going to tell me here is that Pulumi plug in install um Resource Farge web app is not installed. The reason this is happening is that it Pulumi doesn't just generate uh the SDK. So like the, the dot net and Python SDKS, it also generates a binary which has been added into bin here in my directory. So you would publish this to something like github releases. Um And you would be able to install it with Pulumi plug-in install um or with our automatic plug-in acquisition. But for the sake of this, depend for this particular thing, I'm just gonna add it to my path. Uh Like, so, so that um the Pulumi can actually find this binary that it's created here. Um So I can run I can run this binary um locally if I wanted to. So let's try one more time. So a couple of things uh why you're, you're doing this because there may, before you move on just real quick, we may have some folks who are joining, who aren't familiar with Pulumi. So it's Pulumi up. Basically, it was showing what's gonna happen, right? This is like a preview. Um And saying you have to create 11 resource, which is, that's what we wanted, right? So it's this, this is looking pretty, pretty good so far. Yeah. So um we've created all those, I'm sorry, sorry. Lee, I was just gonna say most of those resources were not defined in our main dot Pie. No. Right. They're all coming from this Friday uh web app thing here. Um So, yeah, absolutely. Uh And it's now gonna go and create the low balancer in the service and all that kind of stuff. Um And like, let, let's remember here, like I, I wrote um how many lines of uh typescript that I wrote? I wrote. You mean in the actual, yeah, in, in our, in our multi language package, I wrote 100 and 40 ish lines of typescript. And in my actual instantiation of that in my uh Python example, I only wrote less than 20 lines of Python and I'm getting all of these resources. I'm not having to rewrite everything in Python. I'm not having to maintain everything again in Pyy on. It's just going ahead and creating them directly from the component that I built. Um Which I mean, I've done this a bunch of times now and I still think it's absolutely magic that I can write something in one language and a completely separate un un kind of like unrelated language is able to interpret it and use it. It still kind of blows my mind a little bit that this is even possible. Um But yeah, so we, we've, we've essentially created our multi-language package here uh without actually having to um you know, do anything at all in the Python ecosystem, except do an import of the actual package that we created itself. So, you know, from, from a uh a user experience perspective, if you're the kind of person who's maintaining best practice infrastructure, either in the community or in your organization, and you want to be able to support the widest number of um languages that you, you can, this is the easiest way to do. So this is, this allows you to be able to reach all of these language communities without ever having to kind of write your own um you know, interpretations at all. And if we actually take a look at what gets created here while we wait for AD BS to not value our time. Um It's not transpiring this code, it's not converting it from one to an O from one language to another. You know, you can't see in this kind of generated SDK any um any um any code in uh uh dot net or anything like that. It's not converting it from one language to another. It's all happening in the Pulumi engine itself. And I think that to me is where the real magic of this is coming from is like not having to kind of read one language and write it to another language is just really, really exciting because it means that you can reach those ecosystems and you can kind of just publish a pipe package or publish a not dot net package in new get uh and all that kind of stuff and not have to worry about having a full understanding of that particular ecosystem. I personally um think that's really, really exciting. I don't have to no go. And of course you can write these in which um language uh of Pulumi language that you want. So let's go back to our Pulumi here. Um And to our boiler plate can see here, I've used this particular template, but you could use the uh Python template. So you could write your uh multi language package in Python or you could write your multi-language package and go and uh this is the one I generally tend to use when I'm writing these things is writing them uh in the go programming language. Um But you can see here, this is the exactly the same kind of concepts that we've already seen from our um do from our text test. Ek oh It looks like you're uh your uh Pulumi up is done. Excellent. Uh And then while you're looking at that just I just dropped in there, um we have on May 4th uh will be Pulumi up, which is our free uh all day virtual event. We're going to be uh there's gonna be a bunch of new product announcements and fun stuff. Some great talks, super fun. Uh May 5th the day after will be our first uh Pulumi Community Summit, some more details coming about that and some fun stuff. So go ahead and like, yeah, sign up and join us. It's gonna be super super rad. If you go to, I put the link in the chat um on our short link uh down the Pulumi link, uh join Pulumi up. I think uh another additional plug where we got three minutes left. I think uh one of our, one of our other awesome uh developer advocates. Uh David is going to be um creating, he's doing a workshop on, I think it's the 17th where he talks even more about kind of abstractions um about abstractions. I don't know if we have the link to that. I'll grab it because I'm, I'm, it's, I believe it is going to be, it is the 14th, it is a week from yesterday. Um Let me find the link. Um So if, if you just want to create abstractions and you want to kind of follow along with somebody, David is gonna be guiding you through that process and talking a lot about how those abstractions work. I did an example here of a multi language abstraction which is always useful if you want to reach other people. Um And so other languages outside of the one you're writing, but just the, the practice of kind of writing the component that we wrote earlier on in here is um you know, something that we um we, we have put a workshop together and David's gonna be running that and David's awesome. So I expect it to be a brilliant workshop in which you can kind of take existing pieces of Pulumi code and converting it to components. I just dropped the link in the chat uh to the, the sign up for that uh workshop. So uh that is on uh like uh so it is Thursday, April 14th. Um It is exactly at this time. So whatever your local time is right now, that's the time of it. Uh Go ahead. Sign up. Yeah, David Flanagan A K A rock code will be leading that workshop. I'm gonna be hanging out in the chat and helping out with stuff, but uh should be, should be a lot of fun. Um Everybody thank you for, for tuning in. I hope, hope it was, it was fun for you, Lee, this was awesome. Thank you so much. Right on time as well with one minute to spare. I know. Right. And let me tell you if you are watching and you thought, OK, you've probably done this before. I promise you. This is the first time that I did this particular one because I was very worried it wasn't gonna work. So uh I'm, I'm glad we kind of got a successful example here. Um Yeah, thanks so much for having me, Matt. I appreciate it and we'll have uh I, I, you know, definitely whatever platform you're on, fun watching us. So either match the subscribe or follow button on Twitch or youtube or any of the things. Uh We do Pulumi vision every Friday and uh you know, spoiler Lee is gonna be back in a couple of weeks. Uh We're gonna dig into a couple of different things. So, you know, if you subscribe to us, definitely follow us on Twitter. We, we promote all this stuff, but awesome times and we, as always, we will see you on the internet. Thank you. So.

---
