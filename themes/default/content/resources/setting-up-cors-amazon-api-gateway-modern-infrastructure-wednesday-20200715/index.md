---
preview_image:
hero:
  image: /icons/containers.svg
  title: "Setting up CORS with Amazon API Gateway | Modern Infrastructure Wednesday 2020-07-15"
title: "Setting up CORS with Amazon API Gateway | Modern..."
meta_desc: |
    In today's episode, we setup Amazon API Gateway with CORS support. We show how to configure API Gateway to front a static website backed by S3 alon...
url_slug: setting-up-cors-amazon-api-gateway-modern-infrastructure-wednesday-20200715
featured: false
pre_recorded: true
pulumi_tv: false
unlisted: false
gated: false
type: webinars
external: false
no_getting_started: true
block_external_search_index: false
main:
  title: "Setting up CORS with Amazon API Gateway | Modern Infrastructure Wednesday 2020-07-15"
  description: |
    In today's episode, we setup Amazon API Gateway with CORS support. We show how to configure API Gateway to front a static website backed by S3 along with an API backed by AWS Lambda. Finally, with just a few lines of code, we add CORS support. Code for this episode available here:  https://github.com/pulumi/pulumitv/tree/master/modern-infrastructure-wednesday/2020-07-15  The examples are in TypeScript but Pulumi makes it easy to stand up infrastructure in your favorite languages including C#, Go, and Python - saving time over legacy tools like CloudFormation and Hashicorp Terraform.  https://www.pulumi.com/docs/get-started/?utm_campaign=PulumiTV&utm_source=youtube.com&utm_medium=video
  sortable_date: 2020-07-15T06:28:10Z
  youtube_url: https://www.youtube.com/embed/typ-AJQGKKI
transcript: |
    Hello and welcome to another episode of Modern Infrastructure Wednesday. I'm your host, Lee Zen. Today we're gonna be talking about setting up cores with API gateway. This is a pretty frequent topic. I see uh on the internet in our community slack as people wanting to understand, I have API gateway. I wanna set up an API and I wanna be able to use uh cross origin resource sharing so that, you know, any site can call into this API uh via client side script. And so um that's what we're gonna cover today. So we're going to create a static website with API gateway. We're going to arrest API to that and then we're going to uh make sure it works with courses. So that's, that's really the goal today should be pretty fast and easy. We can accomplish this with just a few lines of Pulumi code. Before I get going. Please make sure you subscribe to Pulumi TV. Uh just click the subscribe link down below and also turn on notifications for new videos. We drop a new episode of Modern Infrastructure Wednesday every Wednesday. So here we go. I have my uh editors brought up here, I already have some stuff typed in. Uh This is just a very simple API, I'm pointing at my build path for my React app and uh I'm pointing at slash one thing to note real quick uh when building React apps, um when you're using API gateway, if you're going to use the API G directly like I am here where I'm just gonna try to go to the URL directly. Um It's useful to include this in your React uh package dot JSON where you just build the home page relative to the root path. Uh This way, it doesn't expect to actually go uh directly at the root, but really everything is relative to index dot html. So that way we can go to a site like this and have it work. You can see in my React App, I actually tried to fetch this slash API, which obviously doesn't work right now. So let's get that to work first. And so that's actually really simple. We just have to add a separate route um over here. So let's add another route and we can just add a uh if we can add a path, it'll be let's, you know, we set it slash API. Um We'll add a method, it's that we get and then we can add a um a handler and we can just write this event handler and we can write an A sync Hamlet like this. And uh we can actually just uh for now we can just return um fairly simple thing. We can just say like, you know, status code is 200 the body can just be, you know, hello. Uh And that should work. Mhm So we can actually run blu me up and add this additional uh method here. Let's see what happens when we do that. So we'll add, I'm just gonna say yes, we can see we, we're gonna add this additional function, which is what this event handler is representing or this function represents this event handler and, and kind of everything else kind of is wired up nicely. So let's let that run for a sec. All right. So now we've got that deployed and uh if I go back to this page here, if I refresh, uh uh maybe not quite yet, let's see. So let's try a lot more time. Oh, yes, of course. I'm trying to fetch slash API when in reality, I should be trying to fetch slash stage slash API. So let me update my program code. Um Let's just actually just stick the whole L in here actually because we're gonna, we're gonna want that later uh before we try this locally to make sure that cores works. So let's try that. Oops, let me uh actually run my build since that's actually gonna be part of the package there. So, OK, we run the bill to uh update our React app. Now we can run for me up. So you can see we're gonna update some of these uh bucket object resources here. So, OK, we've done that. Now we refresh and ok, now we make this api call, you can see it succeeds. Um And if we look at a console, we get hello. So that's what we expected. Great. So now let's actually run this uh program locally and see what happens. Um Because now let's see if the cross origin resource sharing actually works. And here you can see uh oh no cores doesn't work. OK. So now how do we make this work? Well, we have to do a couple of things. First, we have to return uh an options uh parameter. We have to use options to actually return back the right set of headers. And then we have to also return those same headers um in our actual application codes. So let's let's do that actually. If we, if we Google for like API gateway cores, you can see there's this like handy D result here how to cores and it tells us what we need to return, we need to return these particular uh headers with. So we can actually like let's copy this. Um So if we stick this into here, uh this is what we need to return. So we can, we'll say we can allow from anywhere. Uh We only really have options and get and then um we love, so this is this is what we want here. And one difference is going to be that um we, we, we want to do the same thing for options, right? It's because uh we need, we need to have this preflight method uh figured out as well. So let's add another path to that. So this time it's for the we met the uh options method and here we're just gonna copy and paste this. Uh but here, instead of uh having any kind of body, we, we just return an empty body. So let's run Pulumi up here. So you can see we're allowing from any origin to call this API. And then we have these allowed methods options and get, which are the two options we have to find here. So we can call either of those from anywhere. And then we obviously allow the, this, this particular header. So if a assuming this is successful after this, after this runs, this should just work. Uh So we'll do two things. We're gonna double check that the API as it is hosted uh still works, which we should expect it to and then we can verify that we can actually call this thing uh locally. So let's see what happens. So if we go to this, this is, you can see this is running on API gateway, we refresh this. Yep, our API still returns as expected and we still get back. Hello. So that's great. Now, before this was returning this, let's see if this works. And Voila. So really just in a few simple lines of code, all we did is actually just added the these headers back in our returns and then also added this additional options, path uh in order to return these headers correctly on options and just like that. And really just, you know, this is like an additional 10 lines of code uh from what I originally had, we enabled cores on our API. And next time we'll cover this uh in a little more depth where we try to do the same thing, but instead of doing it via LAMBDA, we'll do it via the mock integration in API gateway. I hope you enjoyed this episode of Modern Infrastructure Wednesday, as I mentioned earlier, please make sure you like and subscribe uh the episode, uh subscribe to Pulumi TV. You can also follow me on Twitter LMZN and we'll see you next week. Thanks very much.

---
