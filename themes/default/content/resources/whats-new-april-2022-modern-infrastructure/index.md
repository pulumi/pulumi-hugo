---
preview_image:
hero:
  image: /icons/containers.svg
  title: "What's New (April 2022) | Modern Infrastructure"
title: "What's New (April 2022) | Modern Infrastructure"
meta_desc: |
    In this video, David guides you through 5 new features introduced into Pulumi over the last 8 weeks.
url_slug: whats-new-april-2022-modern-infrastructure
featured: false
pre_recorded: true
pulumi_tv: false
unlisted: false
gated: false
type: webinars
external: false
no_getting_started: true
block_external_search_index: false
main:
  title: "What's New (April 2022) | Modern Infrastructure"
  description: |
    In this video, David guides you through 5 new features introduced into Pulumi over the last 8 weeks.  Chapters ‚è±  - 00:00 - Introduction - 00:28 - Import Improvements - 02:40 - Retain on Delete - 04:20 - Diff Improvements - 07:07 - Clear Pending Operations - 12:00 - Lambda URLs  Links: - Pulumi Up!: https://www.pulumi.com/blog/announcing-pulumi-up-2022/ - Import: https://www.pulumi.com/blog/changes-to-import/ - Lambda URLs: https://www.pulumi.com/blog/lambda-urls-launch/ - Release Notes 70: https://www.pulumi.com/blog/pulumi-release-notes-70/ - Release Notes 69: https://www.pulumi.com/blog/pulumi-release-notes-69/
  sortable_date: 2022-04-28T15:30:13Z
  youtube_url: https://www.youtube.com/embed/3j3XHZe9B1I
transcript: |
    Hello and welcome back to Pulumi TV. This is modern infrastructure. This week is another watch new episode. We haven't done a watch news since February, so we've got quite a lot to cover so much. So we're going to take a look at not three, not four, but five brand new features. The Plume team have shipped over the last two months was diverting. All right. So the first thing we're gonna take a look at is some improvements to the Pulumi import command in order to show you this in a rather visual way. What I've done as I have downloaded an old binary, you can see this is version 3 25.1. Whereas my about most up to date version of the movie is 3 30. Uh and we're going to do this with both versions. So you can see the improvements. Now, I have a small script called import dot sh which just uses the plum old command to import this instance, some random generic, arbitrary EC2 instance, I don't even remember what base image I would say. Not really important. What is important is that if we run the import SH command is that the plumbing program is going to go fetch some information from AWS and try to bring this into our stack. However, it's going to fail. And the reason for this is covered in much more detail in a blog post which the link is in the show notes below. You can go read that from my colleague Fraser. But what's really important for us to take a look at today is that it's fixed? All right. So let's copy our import command and use our new Pulumi command. Hm. And we can see that this can be successfully imported. Wonderful. And now that that's finished, the plum program has told us that this is a code that we need to put into our Python Plimer program to persist the state. So it's a wonderful improvements there to import if you've used it in the past and you've had problems, try it out. Now, we hope that it solved a lot of those older problems. Alright, new feature two. This time we're gonna take a look at return on delete. What is that you say? Well, we have a program here and go. This Pulumi program is relatively trivial and that all it does is deploy engine X to a KTIS cluster. However, on the custom resource options, we're now using the Pulumi dot Retain on delete true. So this is exactly what it sounds like when I run and apply this stack, it will create my engine X deployment And when I run a Pulumi Dr, even though the deployment is being removed from our state file, and our stack is essentially destroyed. The resource was created to have Irri on delete. What this means is when I run cube control, get deployments, we're still going to see our deployment that was created 28 seconds ago by the P program. This is one of those features that people ask about a lot as an alternative to protecting certain resources within the stack. But retain on delete allows you to use Pulumi in new ephemeral one time run scenarios. So check it out, have some fun and let us know what you're using it for. All right, feature number three, better depth support. And this may not sound very exciting, but I am thrilled with this addition to me. So let's take a look at what I mean. This time we're jumping into a javascript project and we've got some more Cotti resources. The first thing I'm doing is creating a conflict map with some deeply nested things. In fact, we have a value here of one which I'm going to increment to two. And if you drop down to our deployment, you can see that we have more deeply nasty things only less time, less contrived. And what I'm going to do is change our image to 1 14.2. Now I've already spun up the stack before, so we're just going to do a Pulumi up and this time, it's going to tell us that it needs to change our conflict map and our deployment. When you see the screen, we do have the ability to see that the depth changed on the data and the config map and something on the spec on the update. It's not until we jump into the details that we see more information. Now, before I show you what it looks like new, let's try old. So this time, I'm going to do a preview death to go straight to the details view. And what we'll see here is that we do get a decent understanding of what changed on the image. We have the red of the old and the green of the new. And this is this is because the has a pretty good understanding and a strict specification for that object. However, with the conflict map where we're actually working with Jason data, then all we see is that we have a large string that looks structured that has been replaced by another large string that looks structured. And in fact, it is really difficult to see where the one has changed and the two has we add it. So if we use a new Lyme and this time we'll run the preview de again, we're gonna see something a little bit different. We still, we still get the great support with the image uh annotation here just showing us that this is actually an additive green string, we haven't actually removed anything. So previously, it says Andro was removed and this was added. So the death is slightly more advanced. Not only that it, that it understands the deeply nested thing, even though it's a string is the no, even though it's just a string, it knows that it's Jason and it knows that we have a key thing which is deeply nested where the value has changed from 1 to 2, your notifications and comments on your C I CV process are going to give you much better visibility into the changes that are actually happening within your deliver program. Ok. Let's take a look at the fourth new feature. This one is special to me because I have been complaining I've been this behavior for a long, long time and that is pending operations. What do I mean by that? Well, I prepared a very, very contrived example to show you. The first thing I want to do is run, pull me up. This is going to create a random resource. Essentially, it's a dynamic provider that I'll show you in just a moment and what's going to work just fine here is this entire career process. Um We do have some output that tells us that the create process slept for zero milliseconds and that's very intentional. So everything here looks good. So what I'm gonna do is make a small change to our program. You can see the dynamic provider here actually it will do is sleep on a create and on an update so that we can get into a certain situation. And down here, we have a very high sleep threshold set on the update. So what I'm going to do is change the threshold honor create to the equally high number. And using Pulumi old, I'm going to run a Pulumi up. So I'm going to accept that this update can be applied and this is now going to sleep for a long time. In fact, we can see sleeping and the diagnostic logs here, but this isn't gonna finish, at least not in an acceptable time for me to complete this video. So I'm going to do something that I'm sure we've all done in the past controls. The I like no, God, no, God, please. No, no, no, no. We're now in a situation where Pulumi attempted an update operation. And for whatever reason, whether an error on a remote API or the user has explicitly killed the process. We're in a situation where Pulumi may or may not have applied an update to a resource. And this gets us into a situation where if we wish to run that blew me up again, we're going to be informed that, hey, actually, you can't do this because there are pending operations within the state fail the state of a law that the update operation was started but never completed. And the only way previously to get rid of this was to run a plume stack export to a fail. We can then jump into this file search for pending operations and we'll see that resource and operation pending and we had to delete this every single time. Now, I'm not going to save this file and instead just confirm that we're still in a broken state. So what you pull me old, I'm going to do a pull me up. Yes, just to skip the prompt. We should get the ed that the pending operation is still there with the new version of poli. This is from 3 to 8 I believe is that the Plum program is not going to consider a pending operation, at least an update, pending operation to be a deal breaker and then try to update a resource again. Now, of course, this is going to fail because we still have a very annoying extended sleep delay. So let's change these back to zero. We'll run Pulumi up one last time with dash dash. Yes. Now we do get a warning telling us the dependent operation is in the state file and that if we run a Plimer refresh, that will be cleared so we can run poll refresh. Now, it's important to note there is a caveat on this warning. Let's just say yes. And that create operations will never be cleared from the state file. They are no longer blocking, they will not stop your C I CD process or your ability to run, pollinate up commands, but they will remain in the state file and this is a warning or a reminder to you that at some point during a create pli may or may not have created a resource. Now, the team are investigating ways in which we can also handle failed or delayed or killed, create processes is the work in progress and hopefully we'll have an update for you again soon, But this is a very welcome change. I'm super thrilled with this. Thank you to all of the team that put this together. OK. Number five. And our last new feature for this episode of Modern Infrastructure AWS recently launched LAMBDA URL functions. This means it's never been easier to deploy a Lambda that has an H 22 P endpoint. OK? So let's run through the code quickly. First, we have a Lambda role and a Lambda role attachment. If you've applied Lambda functions before this will not be new to you. However, I'm not going to go over it in any more detail. If you want to learn more about this, check out the blog post in the show notes below by my colleague Kat. Once we have the appropriate role and role attachment, we create the function. Now we're doing this nice and easy. We're just gonna do an online function that has a response of hello world and uh Pulumi is gonna handle the rest. Sweet. Yep. Next, we're gonna say that we want a new Aws native Lambda URL. It just takes the function A RN and we, and we tell it that the authentication type is none. We're gonna make this a public URL available to anyone. Now, I got a little bit of code here commented out because of a small change in the aws API which will be resolved soon and this will no longer be required. But you will see me execute this command on my terminal. Although you could make it into your political program too, we then export the URL so that we can carl our function. So I'm just going to run and pull me up and give Pulumi a couple of minutes to create everything that we need for our land URL experiments. All right, let's try the curl one more time. First time we got Hello world. So Aws Lambda, URL S make deploying LAMBDA functions with a public or private UDP M point. Much, much simpler. So that's it for today. We hope you like these updates to Pulumi. There's plenty more coming. In fact, just next week on May the 4th 2022 we have our Pulumi Up conference links are in the show notes register. Now we have some amazing things to share with you. We hope you enjoyed these videos. Please remember to subscribe like and if you have any questions drop straight into the comments, we're always happy to help until next time. Have a wonderful day. I'll see you soon. A.

---
