---
preview_image:
hero:
  image: /icons/containers.svg
  title: "Workshop: Introduction to Pulumi using Docker and Python"
title: "Workshop: Introduction to Pulumi using Docker and Python"
meta_desc: |
    This workshop is designed to help users completely new to Pulumi become familiar with the core concepts needed to be effective with the Pulumi Infr...
url_slug: workshop-introduction-pulumi-using-docker-python
featured: false
pre_recorded: true
pulumi_tv: false
unlisted: false
gated: false
type: webinars
external: false
no_getting_started: true
block_external_search_index: false
main:
  title: "Workshop: Introduction to Pulumi using Docker and Python"
  description: |
    This workshop is designed to help users completely new to Pulumi become familiar with the core concepts needed to be effective with the Pulumi Infrastructure as Code platform. Lee will guide you through the Pulumi platform with diagrams and a series of hands-on exercises to help you understand the building blocks available in Pulumi.  What you will learn: - What is Pulumi? - How to install Pulumi - Configuring your development environment - Choose your Pulumi language - An introduction to the Pulumi state & the Pulumi Service - An introduction to Pulumi config - Storing sensitive data in Pulumi securely - Provision your first resources - Understanding stacks - An introduction to the Pulumi programming model  Prerequisites You need Docker installed on your machine -- https://docs.docker.com/get-docker/ You can also install the Pulumi CLI ahead of time - https://pulumip.us/PulumiCLI.  You can follow along using: https://github.com/jaxxstorm/infrastructure-as-code-workshop/tree/master/labs/intro/python  Join the slack channel: https://pulumi.slack.com/
  sortable_date: 2021-07-28T22:39:36Z
  youtube_url: https://www.youtube.com/embed/YfdFxae8Bxc
transcript: |
    Today, we're gonna be talking uh about some Pulumi concepts for the, for, for beginners. Um And so, if you are familiar with Pulumi, uh many of the things will be going over again. Um But the, the point of this workshop is to get you a grounding in some of the core Pulumi concepts that you may or may not be familiar with before we begin a couple of housekeeping things. Um You can follow along um with the workshop if you, if you take a look at the handouts tab on the right hand side, uh You can see a link to the, to the code that, that I'm going to be using today. Um Many of the concepts that we going to be talking about today, uh language agnostic inside Pulumi. So they're available in all of our SDKS. Um And if you're familiar with the language um with any of the languages that we support uh from the No jas ecosystem, Python go and the dot net ecosystem, um we are going to be uh learning about the concepts I will be using uh Python today uh for, for these, for these examples. Um But you can basically follow along in any of the languages that you feel familiar with. Um a reminder to join the community Slack. Uh There is a workshops channel um in the Slack there and again, in the handouts that you can see a link to that to, to sign up. Um And of course, uh as I mentioned, this is my first workshop here. Uh And we're always iterating on the content, especially in this uh new, new times where in person workshops are not, not possible. Uh So please feel free to give us feedback uh via slack in the workshops channel. Uh And there will be a follow up email and a couple of polls that we'll do during the course of this content. So before we begin, um I'd like to talk a little bit about, about what is Pulumi. Um You may be familiar with Pulumi uh already, but um I'd like to take the opportunity to talk about exactly what Pulumi is. Um Pulumi is a modern infrastructure as code platform. Um There are um alternatives in the space. Um But what differentiates Pulumi from uh from our competitors is that we use uh familiar programming languages and tools that you may be familiar with from the software development life cycle. Um So instead of using a configured language or a uh you know, a custom DS L to define your cloud infrastructure, you can use the programming languages that you are familiar with from your um application development life cycle and define the infrastructure decoratively in those imperative languages. Um We pride ourselves on the idea that we are available for the entire cloud organization. We have many infrastructure engineers using our platform as well as many front end and back end software engineers. Um And with, with, with this approach, it means that you are able to kind of define the infrastructure as code um methodologies um in a language that your users and your organization feels comfortable with. Um So, um what is the Pulumi platform? Uh the, the Pulumi platform consists of two separate um but but very, very related components, we have what we call the Pulumi SDK, which includes all of our language SDKS in all of the different languages we support. Um And also the Pulumi cli um you can use Pulumi um with, with none of the Pulumi enterprise uh console and a um and those options are available for you, but we also have the Pulumi console which manages uh collaboration and state management for your organization. Uh We have a, a free tier for individuals and a team and enterprise solution um which, which you can, you can use as well. Um The idea here is that we are meeting everybody on common grounds. Um So if you are an open source user, um you can do the same things that you could do as an enterprise user in the console, as I mentioned before. Um you can define your infrastructure in any of the languages that you see before you. Um because we support these different language ecosystems, it allows you to kind of use the tooling that you are familiar with in your, in your workflow. And you can see here um These are some examples of the editors and the tools and the package management options that you would use. And if you're a software developer and you're familiar with any of these languages, um You can just kind of pick up these tools and use them straight away. I'll be using VS code today for the examples. Um And as I mentioned before, I'll be using Python. Um I, uh but all of these tools are available to you to allow you to kind of get involved in the ecosystem and define the code in the language that you sorry, define the infrastructure in the, in the code, in the language that you feel comfortable and familiar with. So before we actually get into some of the examples, I'd first like to introduce some of the terminology that I'm gonna be using today um to get you familiar with the ideas behind Pulumi. Um And there'll be a few examples here. Um But it, the, the intent really is to kind of make sure that when I'm gonna go through these very, very um straightforward examples that I mentioned before, that I don't use any language or terminology that you might feel is, is, is unclear. So, before we uh before we kind of get into the nitty gritty things, let's first talk about what a Pulumi resource is um in the, in the Pulumi um in, in a Pulumi uh application or a Pulumi infrastructure uh declared infrastructure, a resource is any object or anything that Pulumi manages the life cycle of. And it's, it's, it's a very, very broad term because there are so many different um resources that are available across all of the different providers that we support. Uh It can be as simple as uh uh an S3 bucket or a security group rule in a to a fully managed uh cluster in um in in uh in any of your cloud providers. Um You define these resources as you can see here in this typescript example, you define these resources using the language that you feel comfortable with, as I mentioned many, many times before. And this is an imperative decision. Um So when you write the code, it's imperative code and then this gets translated into decorative infrastructure by the Pulumi engine. The second term that I'd like to introduce you to is a Pulumi project. Um A project is essentially just a directory that contains Pulumi code and and there is a key thing inside a Pulumi project. Um There is this YAML configuration file that you can see here. Um We just change the actual brush color, real sec, real sec quickly to red. There we go. Uh There is this Pulumi dot Yaml um file that lives inside these uh inside these projects. Um And you can see, I've, I've, I've output the um what the contents of that here, this Pulumi dot Yaml file tells Pulumi which of the language SDKS that you are going to use. Um And then it also sometimes has options to on the language. For example, here in this Python example, you can see there is a, a virtual environment defined. Um This is taken care of setting up these Pulumi projects is taken care of for you by the Pulumi new command which we'll be seeing shortly. Um And depending on the language SDK that you choose the contents of this Pulumi project folder will be different. Um In this particular example, as I mentioned that this is a Python example. Um So you can see that there is a file in here that manages our Python dependencies in the requirements dot text. Um But essentially like these Pulumi projects is just a container for all of your Pulumi for Pulumi code. Um And it's essentially a directory on the file system of your machine. A Pulumi program um lives inside a Pulumi project. Um So, the, the relationship between a Pulumi program and a Pulumi project is that a project exists, sorry, a program exists inside a Pulumi project and a program exists uh consists of several resources that you manage as part of your Pulumi life cycle. Um Your Pulumi programs can contain as many uh Pulumi resources as you like. Um You can, they can have a single resource or they can have hundreds and hundreds of resources. Um When you run the Pulumi update uh command, um AAA Pulumi uh program is executed by Pulumi. And that's the thing creates your infrastructure. That's the thing that actually talks to your cloud provider and creates that infrastructure for you. Um This is um mainly what we're going to be operating today. Um We're going to be creating a couple of Pulumi programs um and writing them out into our Pulumi Pulumi um into our Pulumi project. The first, the, the, the first term that is I think you need to Pulumi is this concept of a stack. Um A Pulumi stack is a um is a, a configured instance of a Pulumi program. Uh And what that means is that um when you're writing your Pulumi program, there are often times when you actually want to add configuration values that, that differ between different environments. Um A common use of a Pulumi stack is um if, if you want to apply the same Pulumi program to different environments such as a development and a production environment, a Pulumi stack allows you to configure those values for that particular environment and this is regularly used um as I said between switching between different environments. But there are other examples when this might be the case. For example, if you are operating in a cloud provider and you have applications running in multiple different regions. Um You may use Pulumi stacks to differentiate configuration values between those different regions. Um Pulumi stacks are very, very flexible, you can use them, how you choose to use them. Um And it's, it really depends on your workflow. I'll be showing you an example shortly of what a Pulumi stack looks like. Um But essentially, it, it, it is this differentiation between duration of different environments and it may be the case that you don't actually need to use stacks at all if you only have a single environment and a single program, but we often find that our users very quickly get used to this stack concept and they really like this ability to make configuration, you know, to, to configure things in this way. You've heard me use the term provider a couple of times already. Um A provider is a thing that interacts with a, with infrastructure on Pulumi behalf. Um And it has two components that both need to be available in order for you to actually use Pulumi. Uh The first is the, is the language SDK. Um And you interact with the language SDK using the familiar programming language installation mechanisms that you are already familiar with. Um So for example, I'll be using Python today. So we'll be, we'll be installing the Pulumi language SDK using the pit command Um But if you are familiar with typescript or if you're familiar with go or any of the dot net uh ecosystem, you'll probably be familiar with terms like N PM GO modules and uh new Get. Um So you need to install these language SDK so that you can actually start writing your Pulumi programs. The second thing that you need is um a binary or a plug-in. And the Pulumi uh Pulumi platform takes care of installing these plugins for you when you bootstrap your project and you'll see an example of this uh shortly um on how this works, both of these things need to exist in order to actually create your infrastructure. Um And Pulumi takes care of installing these things for you uh when you create a new project. Uh but it's important to be aware that both of these things need to exist in order for you to create Pulumi infrastructure. Then the, the um uh the final terminology uh that I'd like to uh talk to you about is the concept of a Pulumi output. Um And an output is a special value inside Pulumi. Um When you create Pulumi code, there are things that the um infrastructure provider returns to you that are not known when you run your first poll until you run your Pulumi program. Um Examples of this can vary and differ depending on the cloud provider. But if we think about um Amazon web servers as an example Um When you create a um an EC2 instance as a very simple example, um The actual instance ID is not known until the cloud provider creates that instance. Um Another example that we'll see later is a doer image when you run a, a docker container on your local machine, um do a generates a unique ID for that container. Um That is not known until it's actually been created. These values are special in Pulumi and we call them outputs. Um And then when you interact with outputs, you have to um you have to use them in a special way. What's fantastic about these outputs is that when you create two pieces of, of two resources that depend on each other. If a Pulumi resource generates an output and you pass the output to a second resource, Pulumi links them together and makes the, the um and understands that because it's waiting for this output, it should not make the second resource until the first resource has been created. And we'll see an example of this uh when we create our dock container later, um these outputs, uh it's it's really important to know these outputs are still uh typed in our Polu uh language ecosystem. Um And so you, you know that the value that you're gonna get back from that resource is going to be a string, for example, but you don't know what the actual value is in the screenshot. By the way, you can see examples of a uh of an output actually. Uh like Pulumi knows what the outputs that are gonna get returned. Are it just doesn't know those values? Um And so you can see here in my uh my, you can see that I am uh the AMI and the A RN of this particular server um is going to be um is going to be available. Um And so you will still get that uh that auto completion in your, your code editor. Uh And then last of all, um we're going to talk about the Pulumi state um when you create Pulumi infrastructure, um you have to store what the state of the world is in a state store. Um By default, you use the Pulumi back end. Uh And I'll show you an example of setting that up in a few, few moments. Um But this state is what Pulumi uses to determine the difference between your running infrastructure and what the actual uh what Pulumi knows is the state. Um If you use the Pulumi dot com back end, uh this is all taken care of for you and it's completely transparent. Um You'll, you'll notice in this diagram here that you'll see the Pulumi cli interact both with the state back end and with your actual cloud provider. Pulumi never stores any of your cloud credentials in the state back end. Um So when you actually run your Pulumi up, none of the actual interactivity with the cloud provider happens outside of the context of your local machine. The state back end requires no um no resources, sorry, no credentials for your cloud provider. Uh And it's important to know that that all of the actual execution is happening locally on your machine. So we talked a little bit about um all of the different terminology. Now, let's talk about the Pulumi console. Uh I mentioned it a couple of times before. Um But the Pulumi console is key in your interaction with uh with Pulumi when you sign up. Uh you sorry, when you get started with Pulumi, you'll need to create an account. Um Pulumi offers free accounts for individuals and play pay plans for teams as I, as I already mentioned. Um But you'll need to actually create that account in order to kind of follow along. You don't have to do this if you don't want, but I would highly recommend um starting off with an account uh right now. Um So let's uh let's quickly share my screen and I'm gonna move this to the side and let's go to app dot Pulumi dot com. So this um if you go to app dot Pulumi dot com, this is the, this is what you'll see uh when you, when you actually go to that uh to that console, um you can, you can navigate to this via Pulumi dot com and you can click sign in and it gives you options to sign in. Um if you have a github account uh as I do, um I would highly recommend using the github workflow. Um If you don't want to provide that information, you can sign up via um via email um and click the don't have an account button. Um but I obviously already have an account as a Pulumi employee. Um So what will happen is that when you click the github button here, it will ask you for permission um to, to access your github credentials, which is a perfectly normal thing as part of the, the github sso workflow. Um And then it will drop you into an environment like this. Um And you can see here, I have access to the Pulumi Corporation. Uh But you, you, you will not have access to the Pulumi Corporation obviously. Um But you will get your uh your user name will have a um will be available in this dropdown box here. Um And obviously, I have a bunch of different projects that are available um that I've used previously. Um But you will have no projects. You don't need to create this click this new project button here. You can do this from the command line and we'll do that in a few minutes. Um But essentially this is what you need to be able to, to see here. And it's worth noting that you need to make a note of your um Pulumi name, which is also your github name for some of the later content that we'll be doing. So you've created an account uh and you have logged into Pulumi um at this point. Um Obviously, now what you need is to install Pulumi on your local machine. Now, the difficulty with this webinar is that everybody is um using different operating systems and everybody is uh using their own local environment. Um And so I can't actually show you a full example of setting up Pulumi on all of the machines that you you are using. I'm using OS X. So you should be able to follow along um if you need to. Um But there are multiple different installation options when you actually have depending on your operate operating system. Uh If you're using uh Mac Os, the easiest way to um to actually install uh Pulumi is to use uh brew install Pulumi. Um If, if you have already installed it, you can follow along um windows. We have um a chocolatey package um which will be installed with Choco install Plume. And then finally, um if, if none of those options really suits you, we have an install a script um that, that you can use to actually um install Pulumi which will kind of detect your operating system um and figure out for you which of the things that you need to install. Um and the way to it, then you can see that on the website which I'm just opening up right now. Um If you just bear with me one second. Um So we have a uh fantastic screen um here on the Pulumi website on the Docs. Get started and install. So if you click, get started, you click download and install on the left here. Um And then you can choose your different, um you know, depending on which uh environment that you have available to, you, you can install um uh and you know, select the, the selector here um and install things. Um So I would highly recommend kind of um following along uh with these um install uh uh mechanisms depending on the operating system that you have available to you. Um And what I'm going to do really quickly is show you what actually gets installed on your machine. So I'm gonna switch to a terminal here real quickly and I'm gonna increase the size. Um So what you're looking for in order to be able to use Pulumi is that you should have a Pulumi command available to you in your path. Um I can type the Pulumi version command here and it should return the, the latest version, which is version 2.13 0.2. Um If you've used any installation mechanisms that I previously showed you um in order to actually um in order to actually um know that you have a valid Pulumi installation, um you need to check in the home directory, which is dependent on your operating system for a dot Pulumi directory here. Um And you can see uh there will be a bunch of different directories available to you. Um That, that are important. Um What's important to note here is that with this dot Pulumi version, this is where all the actual Pulumi um stuff happens on your local machine. Um So the two things that you should feel familiar with uh depending on your installation version is that you have this Pulumi version Pulumi cli is available to you inside your uh path. Um And also that there's this Pulumi directory available. So the next thing that we need to be aware of is that we've installed Pulumi and it's now available on our sheet, our machine, we now need to set Pulumi up so that we can interact with our state. Um Logging in is the way that you do that there is the Pulumi login command um that allows you to um like actually interact with the state. Um Depending on the, the the state back end that you're using the Pulumi log in command will be different. Um But it, but for this particular demo, I highly recommend just doing a a plume logging in command and it will open a browser for you. So let's go back to my screen um real quick and you can see here I am not logged in. So I'm gonna do a Pulumi log in command. Uh And it will prompt you. Uh You can either uh enter an access token or you can hit the enter button. Uh And then it's opened a um it's opened a web browser for me in the uh in the background uh depending on the web browser that you use. Uh And then I click github uh which is obviously the, the, the mech mechanism that I signed up with. And then it's gonna tell you that I'm logged in. Uh And here you can see um it's, it's gonna give me a nice helpful tip um so that I can uh uh you know, have a look at some of the documentation. Um But you'll see that it's logged me in as this particular user. If I check my plume uh directory, it now has a credentials dot JSON file um which contains my plume logging credentials. Um So you can know that you are logged in correctly by checking if that, that um that file exists, as I mentioned before. Um We have multiple different language ecosystems available. Um No, Js go dot net and Python, I will be using Python today. Um And depending on which of the things that you want to do, you'll need to actually have the um the language interpreter available on your machine. Um It's important that this is done depending on your operating system. Um If you are using Mac Os, you can just do brew install Python three. If you're using any of the other operating systems. I highly recommend very quickly having a look at how to install those uh those interpreters on your machine. Um Again, it's very, very difficult for me to show examples of all of these different operating systems. Uh It really does depend on which, which, which operating system that you're using. Um So you just need to make sure that when you run the Python command um or Python three command from your machine um that it actually returns a version. Um And it, if you want to follow along uh in any of the other uh language ecosystems, if you're familiar with them, just make sure that you have that interpreter available to you. Um At this point, we're actually gonna go and start doing um more of the uh interactive uh projects. Um As I mentioned before, um these, these are all available as uh in a github repo which you can follow along and is in the um is in the um is in the handouts. Um And this is what you're gonna look at. And so we're gonna start with lab one and then we're gonna do lab two and then lab three and then lab four. So please feel free to follow along with me or you can just observe as, as you need to. Um But let's get started. So you can see here, I've created a directory um called workshop and this is an empty directory. Um, there's no other, um, directories in here. Um, the first thing that we're gonna actually want to do is just see an example of setting up or bootstrapping a Pulumi project. Um, so what does that look like? Um, you can type the Pulumi new command and it will give you a list of all of the different templates that are available for, depending on your cloud provider or, um, you know, what you actually want to do. Um I know that I'm going to be using uh Python today. So I'm gonna close that real quick and I'm gonna do Pulumi New Python. Uh as you probably mentioned, as you probably saw there. It's possible for you to actually do Pulumi new cloud provider dash language or you could just do a generic Pulumi New Python. Uh Pulumi will prompt you for a name for your project. I'm gonna call my workshop. Uh You can also enter an optional description. I'm gonna use the default here. Uh And then finally, as we mentioned before, Pulumi has the concept of stacks. Um So it will prompt you for a stack name. Um The default is DEV um But you can choose whatever you want here. Um And every Pulumi program must have one stack available to it. Um If you are using the Pulumi teams um uh Pulumi Pro sorry, team starter or Team pro enterprise, you can so optionally um put these stacks in an organization but everybody has a should have access to their own um personal uh organization right now, which is the default. So I'm just gonna use the DEV stack and you'll see that Pulumi will bootstrap all of my environment for me. So it's creating a virtual environment. And now it's also going to install all of the different Python dependencies that we need in order to be to get started. So it's created a virtual environment. It's installing all the dependencies in that virtual environment. And my new project is ready to go. Let's go back to my uh let's go back to the console real quick and see what happened there. So if I slip my organization, um because I have a lot of uh different projects, I'm going to search for my uh workshop and here is my um here is my uh workshop project. You'll probably only see one of these. Um But then like I have multiple obviously. So you can see here, it's created my uh my projects and I can click into that and this is my DEV stack. Um And it's not been updated, obviously. Uh But there's a bunch of different uh tags on here. And if you want, you can see the activity, you can, once we start adding resources here, you'll be able to see them in the, in the Pulumi console. And then there's also a bunch of settings that are available to you as well. So now that we've actually bootstrapped a Pulumi project. We're going to talk a little bit about configuration. Uh And this is the key. Uh the these are key components to any Pulumi stack. You are. Uh you already saw, I wanna talk about stacks and configuration. Um Pulumi has a series of commands that allow you to put configuration into your stack um and then read them back. Um So you can see here, I'm talking about the Pulumi config command and the Pulumi config set command. And I'm gonna show you examples in a few moments, but then you can also retrieve those values inside your code. Um And so once you actually set those values, there are options for you to actually retrieve that configuration. What's really important is that you can also set conf secret configuration values inside uh inside your Pulumi program. And these secret values are encrypted by a unique key that is individual to your organization or your stack. Um It's, it's important that you pass this, its secret uh flag when you do this. Uh But let's have a look at what, what let's have a look at what uh configuration looks like to, to you back to my machine screen sharing. OK. So we created a new Pulumi project inside this uh workshop directory. Um But we like each, each Pulumi. Um Each Pulumi uh project is, is has its own directory. So let's create a brand new uh directory inside here and we'll call it stack one. We'll go into this stack. I'll do Pulumi new minus Y Python, which will just kind of the one minus Y flag just takes all the defaults. Um So it's gonna call my project stack one. And it's gonna install all the dependent again. Give that a few seconds. OK. So it's creating my new project um very similar to the ones we saw before. And now I'm gonna open my editor vs code and I open my main dot py and this is the basic Pulumi program that you kind of get presented with. All it's doing is importing. Um It's just importing the, the default Pulumi SDK. Um So let's set some configuration values. Uh I'm going to start writing some codes. So I'm gonna create a variable in Python called required value and then call this config and then I can prompt with config dot Require required value. Um So you can see here. I've uh I've got a um I've got a um sorry, I've just forgotten something. Uh I actually need to specify equals Pulumi dot Config. There we go. That's much better. Um So I'm using the Pulumi SDK um Pulumi and importing the, the config package. Um And then from that config package, I'm doing a config dot Require. Um So what have I actually done there? Let's take a quick look at a terminal inside my stack one and I'm gonna run my first ever Pulumi up. Uh And you'll see here that I've actually got some incorrect. Uh Oh, that's why. There we go. Let's try that again. There we go. Um So you're actually seeing that I'm getting an error and Pulumi is telling me what the problem is. Um, because I've made this value required. It's telling me that I have to, please set a value using the command. Pulumi config set. Um, these required values here. Um When you use a require, it's telling Pulumi not to actually execute the program unless this has been specified in your stack. So I'm gonna do Pulumi config set required value. I am required and then I'll rerun my Pulumi up. Um And now you can see that my my uh Pulumi stack is going to execute. Um You get this kind of drop down box. Uh You can look at details about what's going to actually happen uh when you run the Pulumi up. Um But this is a very, very simple program. So let's just uh run up and you'll see that it been created. Um And you're wondering what has been created here um inside the Pulumi State. All we've done here is tell Pulumi that we've created a stack. Um And so that's all that's currently happening at the moment. There are no resources to be managed as it stands. Um It's just, we've created a very, very simple program. So let's enhance our program a little bit. Let's add an optional value and you'll see that I'm gonna use the get uh the get method here instead uh optional value. And then I'm also going to add a secret value equals config dot require secret, secret value. And then finally, let's actually see what the content of all these things is. So let's do required value with a standard print statement. Um And if you're familiar with Python, you're like, oh, you're probably thinking, oh, this is just a very, very simple print statement that everybody would use as part of their debugging. Um I've got all the safe turn on, so that should be OK. Um So here you see, I, I've set three values, one which is required, which we already set an optional value which will return non if it's not actually set and then a secret value, let's run my Pulumi up from this terminal. And as expected, um this is setting an error because we had a required secret. So let's do secret value. And then remember I have to pass the secret command uh at the end here, rerun Apple Luia up. And you can see here in the diagnostics output, you'll now see that the values of those confit commands are actually being output into my uh my my diagnostics. Um You'll notice that my I am required that I set earlier on um is now being printed. Um I haven't actually set my optional value. So as I mentioned, it's returning and then this one is particularly interesting because it's not actually output the, the plain tech, plain tech value. And the reason for that, as I mentioned before is because we've made this, this secret. Um We don't actually want this to ever be passed in plain text anywhere in our, um, in our Pulumi stack. If we take a look in our directory, now, you'll see that there's this new file here at Pulumi dot dev dot Yaml. Um And if you, you remember back to when we created our stack, uh we used the, the default DEV um to actually bootstrap this stack. So let's take a quick look at what's inside here. You'll see here that those values that I'm setting the required value and the secret value that I ran from the Pulumi Convic uh set command are actually set inside this file. Um And I really like to, you know, draw attention to the fact that when, when we passed the secret flag um to the Pulumi Con set command. Pulumi also knew that I, I don't want to store this value in my version control in plain text either where anybody can see it. So it encrypted that value inside the actual stack as well. Um It's, it's important that, um it's important that everybody's familiar with the idea that these secret values they get passed all the way through pollution and it's stack management and they never get started in plain text. They're always encrypted next up. Let's create a new stack. Uh In, in this example, um you know, in most examples, you probably want to have um you know, a, a multiple stacks. So let's create a prod stack. Uh And I can use the Pulumi stack in it command to do that. Um And then I can use the Pulumi stack LS command and it will show me all of the different stacks are available. You can see here from our DEV stack that we have a single resource um that has been created um which is actually the Pulumi provider itself. Um And then the pro stack has no resources in it. And it provides you this handy URL to go directly to the stack if you want to in the Pulumi console. Uh And what I'm gonna do here is I'm gonna run Pulumi up and you'll see that those values that we set in the DEV stack have not been passed to the P PROD stack. Um So I now need to, again like set these required values between the different stacks. Um And, and the idea here is to show you that those required values are uh uh um uh like all the config values that you use in a stack are specific to a stack itself. You'll see here that there is now uh no plume dot dot prod dot Yaml, but I can do Pulumi config set secret value and let's just add prod here. And you'll see that it's now populated, this uh this prod, this prod stack and those values are now different. Um We, we're not actually going to use this prod stack in the rest of the day, the rest of these demonstrations. But I hope this gives you an idea of how stack, how stacks and configurations are essentially the same. Um Sorry are, are related to each other, not essentially the same, these stacks are, are related to each other um are related to the configuration. Um So let's destroy the prod stack if you don't actually need it. Uh It should give you a, a prompt that says prod. Um And then I could do Pulumi stack, LS Bloomy stack select DEV, but now I'm back on my, my de stack. OK? So that's an example of configuration. Um Let's go back to the slides real quick and talk about what the, the next section. So we talked a little bit about stacks and we use the initialize it the in it command to actually bootstrap those stacks. Um But what happens if you actually want to interact with stacks um between different Pulumi projects? Um This is a very, very common workflow for our users. Um It's, it's in the case that you will have a Pulumi project with a bunch of resources. And then a second Pulumi project with a bunch of resources and those Pulumi projects, they can be in different languages, they can be in different cloud providers, but they may have some interactivity that you might need to use between them. So, what we do here is we use something called a stack reference. Um You can actually export these values from these stacks and then use them either in your shell scripts or you can use them in, in other Pulumi projects as well. So let's take a look at what a stack reference would look like in order to actually do this, I'm gonna rerun my Pulumi up to make sure there's no changes, which is what we expect. And then I'm gonna go back to my editor. Um And I'm gonna add this exported value, I think choir yeah value. And then finally, I'm going to use the Pulumi XPORT command and then I need to provide a name and then actually specify the variable that I'm going to actually um export. So you can see here, I've defined this exported value variable and then I'm going to export it. I'm gonna remove this and I'm gonna change this to just a standard, a standard string here. Um So I've created this exported value. Uh And then I'm using the Pulumi dot export command um to actually export that value depending on the language SDK, the mechanism that you export these things is different. Um And so I would highly recommend looking at the documentation if you're using no GS or go uh to look at how these values are exported. Let's run a Pulumi up and you can see that I've now got a change in my stack and I now have an output which is a exported value. And um the actual value is that I am exported from stack one. I'm going to run that. And then I'm gonna run the Pulumi stack output command. It will show you all of the exported values and then I'm gonna run Pulumi stack output and then one of the actual output values. And you can see we'll just return the actual string itself. Um So how can we use this in another stack? Let's go back up a directory and create a stack too. We're gonna use the Pulumi new command yet again to create a stack two. And again, it's going to set it up for us and now I need to open my editor in this new uh in this new directory. So let's make this bigger open here, make this a little bigger too. OK? So as you, as you mention, as I mentioned before, we now have a uh an empty Pulumi program again. Um Let's use some of the other Pulumi um Pulumi methods to actually grab these values. So let's create a variable called stack and then do plume dot get stack. This will return the current stack we're in, as I mentioned before, we're on, we're mainly using the DEV stack here, but it depends when you switch between them, it will just set the stack for you. Um And then finally, I'm going to create uh sorry. Next, I'm going to create a variable called called org. And my AG is obviously Jack Storm, which is my github user name. Um You need to actually fill this in the uh the organization that you got when you signed up with via github. Um And so again, this is uh this particular, uh this is this particular value here. Um It, it will be different for you and me. Um But it's important that you actually set that correctly. Um So I specified that as uh my organization name. Um And then next, I'm gonna create a variable called stack ref equals Pulumi do stack reference. And I can use a Python F string to interpolate these variables into a stack reference. Um And I'm gonna very quickly fill this out and then I'll tell you what I've done here. Um So a stack reference comes in the format organization um which is coming from this variable stack one, which is the name of the original stack that we created. And then the actual stack name, which in this particular case is being retrieved from Pulumi dot com stack. Um You could obviously hard code this to dev if you really wanted to. Um And you could also hard code this to this. Uh But in order to make this reusable for everybody following along, I'm just kind of using these familiar Python uh to like Python variable and string interpolation in order to actually um you know, make it easier for you to follow along. So now I want to grab my exported value if you remember from my other stack. So I'm gonna create a new variable equals extorted value. And then I'm going to use stack ref dot get output. Um And you can see um this, this is all being filled in for me by my ID. Um And I know that if you remember correctly, I know the value of that uh output is exported value. Um So let's grab that. Um This will retrieve um the value from stack one. And then I'm going to export this inside here. It gets, this is just so it gets printed to the screen. Um Essentially um I'm actually gonna make this a little clearer from the stack. There we go. Um And so now uh we should be able to run this program and it should return as the value from the other stack. Let's open up my terminal again and run. Pull me up. Here we go. Uh It's gonna create a, a resource which is our provider and it's read that value from the original stack one. And you can see here if you remember I did, I am exported from stack one. It's exported that value again inside this inside this particular project. Um What I'm gonna do here really quickly is open up. Um My workshop project. Uh sorry, not my workshop project. I want stack, here's my stack, one project inside the console and my stack two project inside the console. Uh And I can go in here and I can see that it's got no actual resources but inside the stack, it's got these outputs here. So you can see these values in the console as well um as well as locally on your machine. So this has all been great. We've like, we, we know now how to um you know, we obviously know now how to um pass configuration around. But for the last 15 minutes, you're probably thinking, oh, this is infrastructure's code and we haven't actually created any infrastructure yet. Um And so let's do that. Uh Now, um I, I've intentionally made this, this beginner introduction workshop, cloud agnostic. Um And so the, the idea here is that you would have do a installed on your machine and you can do this locally. Um In reality, a lot of the actual resources that you're going to be building are probably going to interact with cloud providers. Um But, you know, in a, in a one hour workshop, I wanted to make sure this was relatively simple to follow along with. So let's, let's talk about like uh let's talk about um Docker itself. In this example, we're gonna build a Docker image and we're gonna run it as a container. Um So we're gonna create a very, very simple Python web application. And let's, let's always remember here that we can use the same language to build our Python web application that we can use to build our infrastructure. And then we'll run a very, very simple, do a container locally. OK. So let's go back into our workshop directory and let's create a new um a new uh Pulumi project called Pulumi Goa. And we can go in here and our familiar Pulumi new command, which we've used several times. Now, we're gonna create a new project. Uh And obviously, I'm passing the minus Y flag so that I don't have to uh fill out all the details again. Um And we're gonna need, we're gonna need another dependency here. Um That's important for us to actually um to actually run this darker container that isn't installed by, by default. Um Python has the concept of virtual environments um Depending on the language SDK, you probably may not need to do this. Um But in Python, in particular, we need to activate our virtual environment list, all of the installed. Um you know, all the installed dependencies in this because we got our Pulumi thing here. So now let's install, pick three install Pulumi Doca. So it's installing a bunch of packages for me um that, that um need to be installed locally. Um And unfortunately because my machine um has installed this this multiple times, um It, it's not detected and it needs to install the actual binary. So I can do Pulumi plug in. Install Baker B 2.4 0.0 oh II I in on your machine. You'll probably notice when you did PP three install docker. This probably happened automatically. Um You can do this manually if it fails. Um Which is a rare occasion. Um If like uh as a Pulumi software engineer, I'm constantly um creating new versions of these, these, these plugins. Uh So in this particular case, it failed. See what's gonna happen when you run Pop Pit three installers, it's going to install this in the background for you automatically as part of that. Um But you can also do this manually as well by specifying a type uh in this particular case, a resource. Uh and um the actual name of the plug-in in this particular case, Docker and it's gonna be installed here at version 2.34 point r. What that actually did is it installed? Um This particular um in the Pulumi plugins directory, it installed a binary for me which Pulumi knows about. Um And so if you ever have a problem with these resources, it's always good to take a look inside this Pulumi plugins directory to make sure these resources exist. And you'll notice as a, you know, as a Pulumi software engineer, I have lots of different plugins and different versions available to me. Uh It's probably the case that you'll just have a single, uh a single thing here for the, for the plume resource doer, open up our editor and let's get started creating a Docker uh uh creating a uh creating an application. Um So, um I've got my empty uh Pulumi uh program here as well. But as I said, we want to actually create a um we want to actually create an application. So I'm gonna make a directory in here to store my application and I'm gonna go in here. I'm gonna create a uh main dot py uh And in order to speed this up a little bit, I'm gonna copy and paste all the code from the example. Here we go. So you can see here in, in Python. I'm re I'm imparting the http server uh package. Um I'm importing the um uh the socket server package. This is all very, very uh standard uh Python stuff. Um I'm going to write out in my HTTP server my name. Uh Please feel free to change it to whichever you feel is appropriate. Uh And then I'm gonna specify a part. Next, I'm going to create a do a file. Um And what this Docker file is obviously going to do is build is copy that um Python application into um into the Docker container inside this uh app directory. Um So the main dot PY for our application, not for our Pulumi program is going to get copied inside this Docker container. Um So I'm gonna save that and I'll do a quick listing. So inside your app directory, in inside uh inside your Pulumi project, uh you should have a main dot py and a Docker file back up one directory. Open my editor. Ok. So how do we actually build a Docker container here? Um Let's um let's make this a little bit configurable. So let's let's do a familiar get stack um call. Um And then we'll also create uh an image tag variable which will set to the value of stack. Um And the reason you could just pass past the stack directly. But what I'm trying to do here is just show you that this is just basically normal Python code. So I'm assigning the result of this variable to this variable. Uh OK. And let's build our image. And in part uh I don't actually need the whole package. So uh I'm gonna do from Pulumi DACA import image Docker file of uh when I did the PIP three install Pulumi Docker, this this Pulumi Docker um SDK became available to me and let's create an image um get the results, a name, my cool image. Um And then let's do build equals DACA file as if I a context, which is this directory here. Um So we're, we're basically saying to this Docker image build a Docker file in the app directory. And then I want to specify an image name which we will call my cool image image tag. Just gonna click on from the stack name here. Um And then I don't actually want to push this to um I uh by default the do A um the, the Doc Pulumi doca provider when you build this image, uh pushes the image to a registry that's configured. Um And I don't want to do that right now. I just want to build it locally. Um So let's very quickly talk about what we've done here. We've built an image from the do a file that we created in our app directory with this particular image name. Let's run Pulumi up from this, from this directory. Um cannot impart name arts because, oh, and of course in, in, in special uh oh, I see what I've done here. This should be Docker build and this should be Docker build. This will teach me to not follow the uh to not follow the instructions correctly. Uh OK. Build. Let's actually get it right. Do build, you can see here. Actually, this is a great example. Um It's showing me uh a standard uh uh Python error cannot import name Docker build from Pulumi Docker. It's because that method didn't exist. So I made a typo in my code um and it wasn't working. So now I've actually corrected that and I've actually set it to do a build, which is the name of the method. And if I'd let the uh inte sense, actually populate that for me, I probably wouldn't have made that mistake. Um So you can see here, it's going to build that image for me and it's gonna build a name of my cool image. Um So let's run this update. Uh You'll see it's creating my resource and I can run docket images and you can see it's creating my cool image locally. So essentially this is showing you what would happen if, if you are using any other cloud provider, it's going to create that resource for you. It's going to create it locally on my machine in this particular case. Um But in most cases, it's gonna create that lo in whatever cloud provider that you actually want to use. OK. Now we actually want to run the container. Um So let's do container equals container and I need to import the actual container. Um There we go and you can see this is the um if I'm actually letting the uh ID do it for me, uh I can actually get it right first time. So let's create a container, my running image. And then we can specify the actual image that needs to be specified for this particular container, we can pass it image dot um And so these are all the outputs from our image resource and I can select them here. We want to specify the image name from this particular resource here. And that's where this value is coming from here. This image name value is coming from that image Um And if we were gonna run this, um run this together, what this is telling Pulumi is, it's saying build the image first and then after that, build like run the container. Um So it's taken care of uh all this for you. I'm gonna really quickly copy and paste this. Um Unfortunately, I seem to have like uh had a problem with my uh I know this is actually wrong. Um So I'm just gonna specify this here. Um So let's run this image like this. Um Run Pulumi up. I have a syntax error. Oh Cause I haven't closed this out. There we go. There we go. Um And so now I've got a docket image which has already been created and then it's gonna actually run a container for me. So let's do that. I got an error. Um I think it's because there we go, that's correct. What it's trying to do. The reason it's failing is that it's trying to pull it from a remote repository um which we don't actually want to do. So let's my pulling it up. Uh It's gonna recreate my image. There we go. And it's running my image. Um And so this container ID value that I mentioned before is actually unknown when Pulumi runs. Um So what we wanna do now is just grab that value and output it so that we could possibly use it in other um in other um in the rest of our plume program. So let's do Pulumi dot export, container id and then do container do ID. And again, you can see it's auto populating these values for me. I can rerun my Pulumi up. It doesn't actually want to make any changes as if it's gonna change the image in this particular case and it's gonna out output the container ID. And you can see actually it's created that container ID. Um And I can actually run here um a, a command that will actually grab the container id directly from the stack and like actually run do a stats on it. So you can see here it's returning that image for me. Um And so those values, we've created this piece of infrastructure, we've done it using a programming language and it's run locally. Um And as a result, we can now feel confident that we can actually create this um this infrastructure um locally. So that's all we kind of had today. Uh a couple of a couple of uh issues uh uh at certain points there which I apologize for. Um Let's just quickly go back to the slides. Uh And let's quickly, very quickly go over what we learned. Um Today, we kind of followed the Pulumi terminology. Uh So you should be familiar with lingo like stacks, projects providers. Uh And the Pulumi console, we showed an example of managing the different configuration between different things in Pulumi uh between the stacks. Uh And we showed how to export those values. And we showed a very, very simple example of infrastructure that we can create locally. Um We can we built and ran a very, very simple um Docker image um that ran locally on our machine to show an example of infrastructure's code. Um There are more workshops coming up. Um If you are interested in Aws and Python, I will be running an Aws and Python workshop on Thursday. Please feel free to sign up. You can see that on Apple Lumi Resources page. Um If you want to kind of go off and do this yourself, then please feel free to take a look at the getting started document. Um It's, it's a great reference for you to be able to kind of follow along and then there are much more complex examples uh in our Pulumi hub uh examples repo. Uh So please please feel free to um to kind of look at those again, please. I will encourage you to, to join the workshop.

---
