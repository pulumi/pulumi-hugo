---
preview_image:
hero:
  image: /icons/containers.svg
  title: "Serverless GraphQL API - Python Example | Modern Infrastructure Wednesday 2020-05-20"
title: "Serverless GraphQL API - Python Example | Modern..."
meta_desc: |
    Last week, we built a serverless GraphQL API using Apollo GraphQL, Google Cloud Functions, and Pulumi completely in TypeScript. Today, we'll mix it...
url_slug: serverless-graphql-api-python-example-modern-infrastructure-wednesday-20200520
featured: false
pre_recorded: true
pulumi_tv: false
unlisted: false
gated: false
type: webinars
external: false
no_getting_started: true
block_external_search_index: false
main:
  title: "Serverless GraphQL API - Python Example | Modern Infrastructure Wednesday 2020-05-20"
  description: |
    Last week, we built a serverless GraphQL API using Apollo GraphQL, Google Cloud Functions, and Pulumi completely in TypeScript. Today, we'll mix it up and do the same thing, but using Python for the infrastructure bits, showing how easy it is to mix languages in Pulumi. Code for this episode available here:  https://github.com/pulumi/pulumitv/tree/master/modern-infrastructure-wednesday/2020-05-27  The examples are in Python but Pulumi makes it easy to stand up infrastructure in your favorite languages including TypeScript, JavaScript, Go, and .NET - saving time over legacy tools like CloudFormation and Hashicorp Terraform.  https://www.pulumi.com/docs/get-started/?utm_campaign=PulumiTV&utm_source=youtube.com&utm_medium=video
  sortable_date: 2020-05-27T19:14:27Z
  youtube_url: https://www.youtube.com/embed/khlIHFCh9RQ
transcript: |
    All right. So now we're streaming today. Uh just trying this out, haven't really tried uh streaming this before I mute this. Um Yeah, just for the heck of it, I'm gonna try doing a modern infrastructure Wednesday stream, uh live stream and see what happens. So, yeah, let's go. Uh actually gonna be covering the same topic as we did last week. Graph serverless graph Q API. But today we're gonna do a little bit differently. Uh We're gonna use the same example that we used last time, the, the Apollo Silver example. But today we're gonna mix up some languages. Um So last time I kind of showed how Callback functions work. Callback factories work uh in the node, run time. And so it's a very node specific uh tutorial, but obviously a lot of Pulumi users use different languages. Uh node Python uh go and, and dot net. And so today we're gonna be covering kind of how to mix those languages. And so you know how to write the, the, the serverless example still in node uh where the function is a node, but the infrastructure uh program itself is in Python. And so, yeah, let's let's go ahead and do that. Um And so uh we'll start with actually the example from last time. So this is the, the Apollo server example that we used last time and, and we copied and pasted this code and we modified it to be callbacks um in, in what we did. So, but today we're actually gonna change it up a little bit. So you can see our, we have our environment set up here. We have kind of some, some stuff going on here. But, but really, um we're gonna be trying to use uh uh instead the, the program to be in. Uh No. So we'll call this uh I don't know. We call this uh graph Q, call this graph, we call it API. Uh And within API, we can actually let's go there and we can um uh just create this API package. Um And uh let me just fix this up and we can actually delete. I don't think we need this license for example, or author uh doing any of this. And um we're also going to actually run the N PM command that's recommended by this. So we'll do this. It's pretty interesting. I've never done this uh live stream stuff before. So it should be pretty interesting. Let me increase the font size on this. So, OK. So um we've got this running, this ran great. Now we'll create this, uh I suggested this index dot Js and we'll put the contents of uh this file in here. So this is this is the function we want to deploy. OK. And now um really like this, this thing is ready, like this is ready to go. This is this is all the stuff we need for the function to work. So all we have to do here now is actually to deploy uh this function. So let's try that. So we have a bucket actually already from our previous uh just uh template. So we'll actually create the uh function uh source asset. And so this is, this is a bucket object representing the zip of um actually the, the function. So uh we'll call this uh you know, uh API uh bucket object and this is a storage uh bucket object and we'll call it, you know, uh API zip. Um And the uh bucket oops is going to be the previous bucket we just created uh that's the name of this bucket. And then the source is going to be the uh API that we just created. So it will be uh Pulumi and we're gonna create an archive. So asset archive. Um uh And here we'll just stick. Um It is that you can see as a dictionary of the, of, of what we want the things to be. So it will be um what we actually want is here, we want a uh just like the current directory like what's there to be. Um And we actually need to uh import. Let me see. Let me try to remember where asset comes from. I think it's from Pulumi Import asset if I recall correctly. Yes. Um It will make a follow archive and that will be uh of uh API OK. So let's make sure this works first. And so while that's running, let's also uh start thinking about how we're going to make the functions. We'll call this API funk. OK. Great. That worked. And uh this will be um a, a function. It's like just like last time and actually last time we did this in uh node. So we actually in lined the code. But here, uh since we're using Python, we'll do something that's slightly different. So we have, um we also need to import uh cloud functions. Um So this will be a function and uh we'll call it uh api funk. Let's stick with the same quoting style and we'll give it the source archive bucket. Uh And that'll be the uh bucket name. And we can also give it the uh the source archive object which we know from above and that's the API object and that's the name of this object. So that's actually very straightforward. Um And we have run time and that's uh Python 37. Um Let's see, what else do we need? We need the entry point. And as we see from here, this is actually defined as handler. So we'll call it handler and yes, we want to trigger HDP. Um And I think we just give it an available memory and we'll say it's like 1 28. Um And so that, that should actually give us the function we want. And then the last thing we need to do is actually uh just like last time uh give it a, an inker um so that we can actually uh invoke the function um from anywhere. And so we'll call this api invoke and this will be a cloud functions uh function I am member uh I in Coker. And just like last time we had to give it the project and this can actually just be um the product of the, of the function. So it can be uh and the region and we can give it the, the function. And then finally, uh this is kind of a little bit of a, you know, just you have to know this. Uh you can look it up on the, on the documentation obviously, but we have to give it the invoca role. Um And then uh the, the members is, is, is all users, all right. So let's, let's run this. I mean, actually, we let's not run that yet, let's export uh the URL from here. So we can actually try invoking it. So um export uh and point and we'll call, this will be the, the, the URL from the function. So it's a K function. Um And we want uh Oops, we want this guy. All right. So now let's, and this should be Pulumi export. So let's run that. Oops, I forgot to set the region. Um uh Just so now we're gonna create the function that's gonna point to the bucket object we actually already created earlier, I think. Uh Yep. So we created this earlier. This has the source of everything we had. Um And then this creates the function, then we have this ability to invoke it and then we'll export this trivial and uh doing this live. So I actually haven't tested this before, but assuming this, this all works correctly, um Then it can actually just curl that uh that URL and it should work just like last time except the big difference is we actually didn't end up doing any of the um the in lining of the function and kind of making it work as a, as a, as a callback factory. Instead we just um uh file that has defined the function is not. Oh Oops, this is so silly. Why did I call this? This, the run my run time here is Python 37. But here, obviously we're using node Js, let's say 12. Uh Let me just look up the um the GCP uh ski functions run times. Um So OK, so no, Js 10. So let's try that instead. That's very silly of me to uh think that the function is in Python when actually it's not, let me just double check the uh strings here. I hope I got that right. But we'll see. Yes. No, Js 10. That'd be great. So this time I should actually have it work correctly. And so really what we've done is, uh really follow the example here. Um But instead of, you know, deploying, you know, manually, the way it's kind of talking about here, we're just deploying with the Pulumi where this is in our index uh dot Js and we're uploading this function exam as is um And then we're going to trigger it um by calling uh via, via HTP. And so we can actually should once this uh finishes uh updating, uh be able to execute our cur command uh just like last time. So let me while that's running. Let me just not sure why GCP is so slow today. Let me just make sure uh everything else looks right. Didn't make any other mistakes. Council. All right. So let's try our curl. Um I can see if find the old curl command head before these are some. OK. Here we go. So we can actually just do this where we curl the stack output. And here the output is actually end point. And just like last time we're gonna give it the graphical care of hello. And assuming it all worked, we get back hello world. So great success. Uh Yeah, that's actually really all I want to show today. Um just kind of how all that works. Um And yeah, hopefully this was a cool way to do this. Uh This is the first time trying out the live stream. So I will figure out whatever it takes to do to post process this and have this posted as a video. Uh But thanks for watching. Uh Please make sure you subscribe and like the channel uh or rather subscribe to the channel and like this video. Uh And then also uh please follow us on Twitter or hit me up directly at LMN. Thanks for watching us.

---
