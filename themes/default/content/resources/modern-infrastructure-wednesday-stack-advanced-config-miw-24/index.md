---
preview_image:
hero:
  image: /icons/containers.svg
  title: "Modern Infrastructure Wednesday: Stack Advanced Config (MIW 24)"
title: "Modern Infrastructure Wednesday: Stack Advanced Config..."
meta_desc: |
    In this episode of Modern Infrastructure Wednesday (delayed due to Re:Invent 2021 to Monday), David, one of our developer advocates, walks us throu...
url_slug: modern-infrastructure-wednesday-stack-advanced-config-miw-24
featured: false
pre_recorded: true
pulumi_tv: false
unlisted: false
gated: false
type: webinars
external: false
no_getting_started: true
block_external_search_index: false
main:
  title: "Modern Infrastructure Wednesday: Stack Advanced Config (MIW 24)"
  description: |
    In this episode of Modern Infrastructure Wednesday (delayed due to Re:Invent 2021 to Monday), David, one of our developer advocates, walks us through understanding stack configs and secrets using Go.  Code for Modern Infrastructure Wednesday episodes is available at https://github.com/pulumi/pulumitv/  Today's example is in Go, but Pulumi makes it easy to stand up infrastructure in your favorite languages including TypeScript, Javascript, Python, C#, and Golang.  https://www.pulumi.com/docs/get-started/?utm_campaign=PulumiTV&utm_source=youtube.com&utm_medium=video
  sortable_date: 2021-12-06T18:00:12Z
  youtube_url: https://www.youtube.com/embed/MR8MOJjez2c
transcript: |
    Hello, welcome to modern infrastructure Wednesdays here at Pulumi TV. I'm your host for today, David Flanagan. Although you probably know me as rock load across the internet today. I am excited to guide you through the all unassuming stack fail. The stack fail allows us to tweak the behavior of our preliminary project by providing configuration and secrets in the wild. I've mostly seen this used in a fairly trivial way and that is simple key value pairs today. I want to show you how I use this feature. So with that being said enough with the talking and let's go straight to the coding. All right. So what we have here is a new Pulumi project created using the Pulumi new command as led in the GO SDK. So we said that the stack file allows us to store conflict and secrets to tweak the Pulumi run time. So let's start by setting our first piece of configuration. So we can do this with the Pulumi D I, we can say Plume convex set and we can use any name and any value to get started here. I'll see that my name is David. I'll also create one more, which says my age is 21. Yeah, we can also set secrets by modifying this command with dash dash secret. Here. I can say that my password is super secure. Now, all the Pulumi config command is doing is working and modifying E Gamal fail. In fact, if we run LS, you'll see that we now have apolo dot DEV dot Yaml. We can open us an edit editor. Let me see. We have our age, our name and our password, our age and name are simple key value pairs, but the password is a little bit different. So let me it will encrypt the secrets. And this just means that you can actually commit these stack fails to your get repository if you want to. The decryption key is either using the Pulumi back end a secure password that you configure yourself or any of the cloud providers, major K MS S. All right. So let's consume this one code. The first thing we want to do, import or per car package from here. We can instantiate a config variable with con dot new pass under the contact and an empty string. This empty string tells the conflict of new function to load the default project config which is names space to the project name. If we take a look at the plume dot DEV file, you'll see that all of our key value pairs are prefixed with advanced config inside the Pulumi dot Yamal. The name of this project is advanced Convic that's so that ties together. So we use an empty string to load it. We can then do some wonderful print light debugging to ensure that we can pull values out you. Is there print lane con dot Get name? No, we can jump to the CL A from pulling me up and we should see diagnostic output with the name loaded from a stack file. There we go. All right. Next, let's pull in the edge, we'll do our print line clump and instead of just get, we're going to use, get. And from here, we can add age and run li me up again and you'll see that we get David and 21. So that's the get helper. They allow us to pull out information and there's default values if they don't exist. OK? So let's do one more this time. We're going to do Con dot Get Boo. And I'm just going to take the copilot recommended here and say, are we mad at you? This value does not exist in our stack file. However, when we run a Pulumi up, we will get a default value here. The default value for a billion is false. If this is not the behavior that you wish, then you can also move from get to require and now that we have a require bill, if this does not exist and instead over a configuration, we will get an error message. Now there's a stack trace here. But if we scroll to the top, it'll tell us clear that the messin required configuration, variable of married was not set. So this is the basic way to work with the Pulumi convic. My preferred way is a much more tight structure based system. Let's assume that we want to load an author from our prelim conflict and we can have a strut that tells us what an author looks like. We can see that the author has a name, has an age and has a Twitter handle. We can now go to our stack file. I'll just remove our old age and instead of name, we'll have author now because this is just you can just indent it and set it like. So now we can go back to our main do go and we can try to load the property of author and to the strut. The first thing we want to do is defend an author object which has a tape of author. We can then say that are con but require object has a property name of author and pass a new variable. We can now just print line and debug the entire author object. No, when we ramp pulling me up, we will see that a diagnostic opens the name, the age and the Twitter handle. Now, what's great about this approach is that I can store my configuration and my stack file and a structure that makes sense to the way that it is consumed, the properties that are changed together, live together also because we have this very strict type within our code is that any decentralization editors aren't gonna resort or fall back on default values. They will fail the type checker. For example, have I come to here and set this age to not a number. If we were to do this as a key value pair, we would actually get the default value of zero. However, when we use the required object key, we're going to get a stack trace with an error message at the top. The es is telling us that we cannot unm marshal a strength and to an end, this is a great way to work with configuration that has structure in your Pulumi projects. Now, if you want to store secret information within this structure, you may be a little bit confused. How do I get encrypted value to this location? Is the poly I Well, when you're using Pulumi config set, you can use path and we can say that our author's password as a secret and the value is super secret. And if we jump back over to our stack file, we'll see that the secret encrypted value has been directed to the right location. If I wanted to store my author's books, we can say, but this is not a secret and that my favorite book is done and maybe we'll add one more for good measure. And we'll say that book one is snow crash. Now, when we jump back over here, we can see that the Pulumi Con set with the path parameter allows us to work with the types to build this configuration. You really do have a lot of flexibility. You can modify the Gammel, you can script it with the cli whatever works best for you. Well, that's it Pulumi stack configuration and various forms. What we've learned today is that Pulumi provides configuration to tweak the way that our projects run this configuration can be structured in any way that we please, it can be typed and we can get the values with defaults that required or enforce mandatory configuration. If you have enjoyed this video, remember to subscribe to Pulumi TV, like this video and if you want leave a comment, we read each and every comment and we can't wait to hear from you. We'll be back in a couple of weeks with more modern infrastructure, Wednesdays. We'll see you soon. Bye bye.

---
