---
preview_image:
hero:
  image: /icons/containers.svg
  title: "Cloud Engineering Summit 2020: Certificates as Code with Pulumi and Cert-Manager"
title: "Cloud Engineering Summit 2020: Certificates as Code with..."
meta_desc: |
    In this lightning talk, Jake Sanders, Software Engineer from Jetstack, will show you everything you need to know about deploying apps with mutual T...
url_slug: cloud-engineering-summit-2020-certificates-as-code-pulumi-certmanager
featured: false
pre_recorded: true
pulumi_tv: false
unlisted: false
gated: false
type: webinars
external: false
no_getting_started: true
block_external_search_index: false
main:
  title: "Cloud Engineering Summit 2020: Certificates as Code with Pulumi and Cert-Manager"
  description: |
    In this lightning talk, Jake Sanders, Software Engineer from Jetstack, will show you everything you need to know about deploying apps with mutual TLS automated using cert-manager.
  sortable_date: 2020-11-11T00:29:50Z
  youtube_url: https://www.youtube.com/embed/_PUsRJi5yEw
transcript: |
    Hello everyone. My name is Jake Sanders and I work on the set manager team at Jet Stack and Jetstar is all about cloud native engineering. So I'm very happy to be speaking to you all today at the Cloud Engineering Summit. Today, I'm gonna be talking about certificates as code with Pulumi and set manager. So what is set manager, set manager is Q controller that manages the complete life cycle of X 509 certificates or TLS certificates in Q being cloud native means that that measure extends the Q API with custom resources that represent certificates, certificate requests and certificate issuers. When you create a certificate with a certain manager, it will automatically get renewed on time. And therefore you don't need to worry about anything. We support the AC me or ACME protocol, which means that any publicly trusted certificate authority that implements this API can issue certificates to certain manager, but we also support internal only certificates with the number of plug issuers including uh vault or an internal self signed one or even our new parent company trusted platform solution. So before a certain manager, your internal PP I may have looked something like this signing A CS R preparing it, getting a signed CS R by your internal C A having it valid for a year or so and then setting a reminder to yourself in calendar for next year to make sure we renew our certificate or our service will go down. However, with set manager, you can create a certificate, custom resource inside the QS API, you can consume this from a standard CTI secret that's mounted inside your pod, just like any other human secret behind the scenes. Set manager creates another of its customer resources called the certificate request. And then this is picked up and signed by either an issuer in a single name space or a cluster issuer cluster wide. And this will go off to sign the certificate using either internal private um PK I or off to an AC me server. So how does this integrate with Pulumi? Well, as we know, Pulumi lets you write infrastructure is code in your preferred language. And as of May earlier this year, go sport was fully added, which is cool for us and Jet, we're mostly a go shop and Mi's C provider for the full C API. But an advantage for us is that you can import your custom resource definitions, which are ya that describe to C as the correct spec for custom resource. And Pulumi will generate properly type checked libraries for you to just import into your infrastructures code. And so compared with just hand editing deployment manifests with and for or text templates with other deployment tools. You get the full advantage of creating CR DS that are checked by your languages in built type checker. So because this is going to be a live demo, I'll start it rolling. Now if you want to follow along, I know it's a remote video presentation. So I put the link to the code but also a QR code that you can scan with your phone. And while it's, while it's going on, we will set this going and I'll explain what's going on while it's running. So the contents of the demo is we're going to create a private C A and deploy that manager, create the set manager issuer with our private C A inside, then create the set manager certificate resources at which at which point set manager will automatically sign and maintain the life cycle. And then we'll create two deployments that taught to each other using mutual TLS signed by this. And this is all happening behind the scenes with a Pulumi stack as you can see here. So I'll talk through what it actually looks like in Pulumi. So using Pulumi built in TLS provider, we no longer need to do any kind of certificate wrangling with open SL on the command line. I'm going to say I want a private key and a certificate that's a allowed to be AC A and self signed will then create a secret inside Ktis using the Pulumi Ktis provider. And this is using the CO V ONE API and the meta V one API. And we're pulling the data from are existing signed and private key using a helper that converts it to a 64 because convenor secrets have to be V 64 encoded. This is where the magic happens. So using the CRD to Pulumi tool that you can find on Pulumi S website, I've taken our set up manager, custom resource and converted it into a library that I can just import and deploy along with my, the rest of my Halloumi stack. So we're creating a new issuer set manager V one and it's going to be called C A in the maze base default and it will pull from the secret that we created earlier in the stack called C A. Now we'll deploy certificates for each of our apps. So we're going to have a ping certificate and a pong certificate signed for the service addresses of those services, those deployments rather. And by creating this certificate resource, we're signaling to search manager that we want it to sign certificates that are valid for one hour and 30 minutes before they expire. I want site manager to automatically renew them. And this is really useful because you no longer need a calendar invite to uh remember to renew your certificates. So manager takes care of it and because we're using extremely short lived certificates. If any of these credentials were to leak, it shouldn't really matter because they have a very short lifetime. And probably most people watching have already seen a Q at his deployment. So I didn't include the entire code because it wouldn't put on the slide. Anyway, we're deploying a ping pong container that mounts certificates from a secret and this, this secret will exist because that manager has put it there. So transitioning over to my terminal, we should be able to see. We created our issue, we created art certificates which created some secrets and we created our deployments that are all talking to each other using a secret. So hopefully our stacks finish deploying. You can see certain manager, all of the um a commissions that certain measure needs to work, ah are services and deployments. And I got the uh I got fluy to output the RLS of the resulting services so we can go and look at them and show that ping service has managed to communicate with our Pong service and authenticated with a certificate issued by our private C A. So that's our lightning quick demo. I'll just put the slide back up for uh people to quickly check if they want to uh if they missed it the first time. And that's it for our quickly deploying a completely managed internal private PK I solution with a few lines of Pulumi and C merger. And uh thanks very much and hope you enjoy the rest of the conference.

---
