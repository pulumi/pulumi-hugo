---
preview_image:
hero:
  image: /icons/containers.svg
  title: "Elkjøp Nordic - Self-Service Infrastructure using Pulumi Automation | PulumiUP 2022"
title: "Elkjøp Nordic - Self-Service Infrastructure using Pulumi..."
meta_desc: |
    Pulumi customer, Elkjøp Nordic shows us how to use Pulumi Automation API to build a self-service application that can create infrastructure on dema...
url_slug: elkjp-nordic-selfservice-infrastructure-using-pulumi-automation-pulumiup-2022
featured: false
pre_recorded: true
pulumi_tv: false
unlisted: false
gated: false
type: webinars
external: false
no_getting_started: true
block_external_search_index: false
main:
  title: "Elkjøp Nordic - Self-Service Infrastructure using Pulumi Automation | PulumiUP 2022"
  description: |
    Pulumi customer, Elkjøp Nordic shows us how to use Pulumi Automation API to build a self-service application that can create infrastructure on demand. This application can create environments with automated access control that provisions resources like resource groups, GitHub repositories, or Kubernetes namespaces.
  sortable_date: 2022-06-13T01:00:10Z
  youtube_url: https://www.youtube.com/embed/aoa_O-rh5KE
transcript: |
    All right, and welcome back to our main stage. I hope you enjoyed either the leadership track or the practitioner track, whichever you chose if you want to be in two places at once, but simply couldn't be, look for the videos later on. And at this point, I'm really excited to invite a Pulumi customer uh Tomas Johnson from Elop Nordic to talk about how they use the Pulumi automation api to completely change the game and how they're delivering modern cloud applications and infrastructure. Welcome to all online views out there to this presentation on why it automation api can be of interest and also what it might look like using it. What I plan to cover in this presentation is how to build a self service infrastructure application using Pulumi and why a self service infrastructure application might be useful. Uh This is not an introduction to the balloon basics. There are a lot of good research out there already on that topic. Uh and a lot of good examples in the post, et cetera. So the agenda for this is like, what is the problem that I want to solve uh for us here at El shop. Uh And it's not a problem per se. It's more like a challenge uh to make things better. And I was going to why it's a problem. And then we continue to the solution and how uh pollute motivation api help us to solve that problem. I will end everything with a quick demo of a scaled down self-service application and also share the code with you in, in github. So you can have a look at it afterwards and, and play along with it uh in the area where you like. So, but first have a, that's a short introduction of myself. I'm a Swede uh family to Norway where I live. I lived there for 13 years and I will most likely grow old here. I think uh I'm really passionate not only about building software but also building the right software and an effective way. I truly believe that most people will deliver and innovate amazing things if you just get a, a chance to do so. And that is also why I find this topic so exciting at the shop where I currently work. I focus a lot on how we can do things better in all spec all aspects that is building the right thing, building it, right? And also delivering it fast. Everything in this presentation is based on some of the work I've done uh at the last six months to a year or so. Um And I have probably a lot throughout the years. But now I have more kids. So it's more where kids sleep and, but except for that, I'm really excited about the topic I'm gonna talk about today. So, what is the problem I want to solve as a developer? It might actually not be a problem that you haven't thought too much about. Uh, no, I didn't until I had some more responsibility over the whole cloud environment at my previous job. I wish we had these things more in order back then. So I think it would have simplified a lot of things that we did and we were aware of the issues, but we didn't have the tools or uh any good ideas on how to solve them in a proper manner. So we sort of tried to deal with it manually, which is a pain over time. So the problem is I see it has two components to it. When you do create application or products, you do want to keep your developer engaged to foster creativity and also innovation to meet at the same as give them trust and give them room to create the best possible solution without any restrictions. The other component is some level of control. As a company, you do want to have security in order. You also want to have good governance and who is creating what. Uh but also most of all you want to prevent accidents if you can without impacting developers too much. Ideally you would actually make their life easier with establishing good taxes that aren't fixable. And if you have too much control, developers will find shortcuts to circumvent your controls. And I do think both of these things are super important and, and, and if you don't do this, uh the right way, I think you will have a hard time to retain talent in the world we're living in right now. So it's not just important to, to so your building but also to keep people uh at your company. So if you don't have this automated, I would assume that you are either one giving too much access access to too many users, which will result in some chaos and lack of governance over time or two. You got too much control and a small amount of people that are needed to do some manual task to get things done. And this man manual control mechanism will most likely be waste in terms of time wasting and also money is you need to spend time to do these things. And it will also lead to less innovation since there are more control and that insurance will lead to less engagements in your employees. So these topics are super important to associates. Uh If you are like me, you're not too fond of the control aspect. Uh I'm not saying that this is right or wrong since they are both important. But I'm more, I'm more into the innovation negativity part than trying to lock everything down. Uh, but I do appreciate people that, that want to have more control. Uh, but also like this quote from, uh, another Norwegian guy that he said that control is expensive but trust is free. And what that basically mean is, er, whenever you need to do while some control mechanism you have to actually spend time and implementing it and that costs money, trusting these people is free. So what you should try to do is just enable people to do the right thing as much as possible and then firmly deal with those people that actually try to supplement uh the things you have built and and make them go the right path, follow the right path as well. So the question is, how can we enable the people without being in the way? And my suggestion solution to this as I already have hinted is about automating things. Uh We need to automate as much as possible and make it possible for developers, for other groups to access these self service applications and we must make it cheap to make errors and there's no cheap way of my favor. Let's pretend uh to give the developers a water garden in that garden, they will have all access they need, but they are not allowed to step outside of the garden. So if they do something stupid in that garden, then it will only affect themselves and nothing else in the in the water system. That means the developers should have access to, to given resource groups uh in a for example, or should have uh access to the right name space in uh but nothing that they're not supposed to have access to. And this is what I think is the key to assess when it comes to have enabled thing. But at the same time, remain in control over your infrastructure. Uh We need to make some core infrastructure self service that means to get access to. And when we have access, we should only have access to what we need and nothing else. So let's continue to what is motivation and, and, and how that can help us. The basis of Pulumi is quite simple. Uh You just define the resources, the complexity as I see it is more in the actual cloud resources. How do you, how do they work? And if you know that it's super simple to write the plume. Uh setting the next level at plume is the automation part. And you can think of that as running Pulumi inside an application and creating resource on demand. And the definition uh on the Pulumi page itself is the plu motivation API is a programmatic interface for running Pulumi programs without the Pulumi C I. And it's illustrated in this uh in this simple uh diagram you have in a regular flow, you have the user or the C IC, the pipeline, executing the Pulumi C I directly, which are then provisioning resources in the cloud. With the automation part, you have actually the the application running inside uh somewhere. It could be a cli application, it could be a web application or you could actually have something running in your level pipeline and that accepts different parameters and then executes the Poum program and the resources. So before I go to the demo, I want to show some high level diagram, what we have built here. Uh The demo will also show uh a smaller sample uh of that type of application. So in air, we have built something that looks like this, we have the actual actual automation application uh to the left. And that is what the user interacts with. In automation application. You can create different types of resources. It can be a github team, it could be a ad uh groups, it can be uh environments, it can be github repositories and the guitar repositories is I would see the from a developer perspective, the the core part because that's what we bring everything together. We are actually when we were creating a guitar repository, we're also reading uh the stacks for the environments and injecting the right credentials to the git tab uh secret store. So it's available in the repository when, when the developer is done, implements their application in the repository and then when you want the gift of actions to, to deploy or what to do you can read those secrets and start interacting with your resources for uh as a research group. Uh And that was the sort of what, what we have done. But I want to show uh a small application, I won't be able to show uh the complete thing of media built, but I wish it was scaled down version. But first also some uh initial things on how uh to get started with like the really simple basics of uh Pulumi automation. API So here we have on um a new, simple, like the most simple program I can think of almost uh you have a standard type trip PLU program. I usually have a specification for what I want to create. And then I have the function to do what I want to um uh do. Uh In this case, I only actually create an output value. I'm not creating any resources. But if I want to create resources that should be done here, of course. But for, for the sake of automation that's not uh needed to show how it works. So this is what you do here, you do all the produce stuff. Uh And I was going to save some time and I'm also gonna show everything there. And if I want to look me up on this one, uh it will of course create the stack uh with the II I think I run it before. So it doesn't change anything. But I have my output value, which is the fine here. And, and that's, that's it. That's a simple, most simple thing you can do. So how do we do? We create this as a self service or using the automation? Got the first thing is you should uh not export the things here. Uh And then I have for long in this sample uh prepared everything you need for um the Pulumi automation API was to create a simple C I command is that we have uh uh I usually call it one function which takes in the stack name that you want to create. And also the specification as I showed before here, then create a program which is the PLU program which will this will execute my function using the specification I provided. And this program is then used as input arguments uh to, to create that arguments for Polu. And when I have that uh set up, I can uh create my stack and run plew me up, which basically stuck up in this case. And if I run this, as I see like command is dead. Uh your, your run start is gonna run this as a script. And now we're gonna go and create an a new stack called automation stack. And that's gonna be here in my uh accounts, you will see put motivation stack, it took a couple of seconds uh And I can now create another one using the same thing. So that's the whole like idea of uh automation, we can actually rerun your infrastructure just by providing parameters uh that could be through the cli s in the, in this case or uh the application which I will show next. So this is real basics. Um But let's get a little more uh deeper into the motivation. So for this uh presentation, I have actually prepared uh a uh the notification, much inspired. But what we have done here at uh but simplified version of course, uh the code is available as you saw in the previous slides. Uh And here you can actually create two things, research groups and repositories. Uh I also list like twins. The is better. Uh I can list all the things I have already created. I won't create them now because that takes 1.5 minutes. But I can show that I, I can actually create them. And then by creating repositories, I can uh link a research group to that repository. And what will happen then as I mentioned in, in previously is that I will get a repository with some secrets. The RGDMRG, the DMRG, that's the name of the resource group. And then I just prefix everything with the RG because you might actually link multiple things into this repository in, in a, in a large application. So it's good to know what kind of uh things you are you have here. And also to avoid naming uh collisions. Uh So now, I have my demo repo which one here, which then can actually uh one thing in, get an action uh and, and provision things in Asher using the credentials that were generated in application. So let's have a look on how I'm actually creating this. Uh It should be in this syndication. Let's close all. So this is a standard uh typescript or an xjs application in type. Here, you have the pages which is like the web things and, and, but we're gonna focus on the API part which is um we Pulumi ones. Uh And here I have a really weird name file that basically is this catches everything in API because all my resources are following the exact same pattern. So you can either create a resource, you can delete it or you can get it or, or list all the resources. So that's like where I can uh capture everything and then have a um sort of abstract way of dealing with all this. So they all follow the same, same thing here. Uh And this entry point to create an application is also code on this slide. So you will probably need to look into it on the, on the in the replay afterwards. But uh I will guide you through it quickly. Now we have a great application uh which we create education that's sort of provision everything. Uh And it will use uh depending on the a route if it's repositories or resource group. It would use different kind of resource handlers. I like to call them. Uh And this is also an abstract way because the way by creating a resource again, it's the same thing every single time. The only thing that matter is the actual polluting stuff. So that's why I can create these simple uh helper helper functions that looks exactly the same. So here we have the great resource standard, which is the plume automation part. So here I created a stack as you see, I have a modified program because I want to add my specification to the output. So I can actually go into Pulumi afterwards in the in, in the, in, in, in the service and see what, what the specification used to create this stack, which I can show you. Uh And then I just run stack up. So the only thing that differ is these two things and these two things are really familiar to you if you know who you miss the work. This is basically a standard Pulumi code to generate things for the research group. I create the research group straight forward. I start creating a, a password. And that's because I want to create the credentials to for the admin user in a way for this user group. So I create the random password and actually a the application and connect the service principle to that. And then we of course do is create a search principal password. And all these things are sort of a specific things you need to do. Uh And then I also give the service principle. I created uh admin rights or contributed rights to that research group. And the last thing I do is actually uh creating these things as outputs. And the reason why I add these things is outputs which we can see in the do my portal here to go to here, we can see it in my different resource groups in the same projects. And we have this one. For example, we can see the specification that I used to create this. And you can see all the different outputs that are, that are available to me. And those are super useful when I, when I want to create the repositories and to create the repositories, I have a similar file. Um But instead of the actual things, it will create the guitar part. Uh But the first thing I do is actually reference my research group um stack because that has all the information I need to talk to the research group. So then I gather all the outputs from that stack uh which is then used to create a secret down here. Uh And that secret is added to this repository that I create here. The post first created and then I need to create a action secret as it called. And this secret is what you saw in the previous slide here. Uh Secrets Fictions. So here we have the secret that was created, that taste so good. Uh One more and I think that that's sort of covers most of how you actually go on and, and tieing things together. Like the key things are uh great outputs of what you want other sort of resources to know. Then use stack references to, to reference to those uh to those credentials or what it might be, could also be like like a API or whatever. Uh But then then comes the, the next part, how do you use this when you actually have this in interactions? And I think it should show that as well. So here I have the, the more repos which I have prepared and I usually often create uh minimum two different stacks. One is a stack. So now we are actually in the repository that was created through from my uh from this application here, I created this demo reposit there. And that is basically what you see here. I often create two different two different stacks, one I call uh core. And the only thing that does is actually reading the, the secrets from. And the reason for reading the secrets from github is like after I have provisioned this the first time they will be available in the stack for the co stack, which means I can from my local environment. Now actually reference the core stack from my local machine and create the, the, the, the service provider or the Asher provider to provision all the things I want to provision on Asher. And that would be without me even logging into the Asher C I two. So I I can run to me if I go to the right folder and, and the floor or in front. Oh, and now we like to see that everything has have already been provision. So once create new, but we can see that it actually works. So it's actually creating as then creating the service provider and then you inject the service provider as the option parameter to your resources. That's how you uh define which provider you use. And there should be have a quick look in the portal to see if they are there, you have those shows. And then we have the, I think it's called Pete to the mortgage. So this is the, that's the the storage account that I created now with the from this reporter. I think that's all I have for the demo part for demo code is available here on the Plume automation demo. That will be the full Deb Deb application uh which you can run on, on your machine. You don't need to have any credentials you all you need is uh youtube account and a Plume account. Uh And I think that thank you.

---
