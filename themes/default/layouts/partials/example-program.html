{{ $path := .path }}
{{ $languages := default "javascript,typescript,python,go,csharp,java,yaml" .languages }}
{{ $folder := path.Join "static" "programs" }}
{{ $showChooser := gt (len (split $languages ",")) 1 }}

{{ if $showChooser }}
    <div>
        <pulumi-chooser type="language" options="{{ $languages }}">
{{ end }}

{{ range $i, $language := split $languages "," }}
    <div class="example-program w-full">
        <pulumi-choosable type="language" values="{{ $language }}">
                {{ $program := "" }}
                {{ $depfile := "" }}
                {{ $deplang := "" }}
                {{ if eq $language "javascript" }}
                    {{ $program = "index.js" }}
                    {{ $depfile = "package.json" }}
                    {{ $deplang = "json" }}
                {{ else if eq $language "typescript" }}
                    {{ $program = "index.ts" }}
                    {{ $depfile = "package.json" }}
                    {{ $deplang = "json" }}
                {{ else if eq $language "python" }}
                    {{ $program = "__main__.py" }}
                    {{ $depfile = "requirements.txt" }}
                    {{ $deplang = "plain" }}
                {{ else if eq $language "go" }}
                    {{ $program = "main.go" }}
                    {{ $depfile = "go.mod.txt" }}
                    {{ $deplang = "bash" }}
                {{ else if eq $language "csharp" }}
                    {{ $program = "Program.cs" }}
                    {{ $depfile = printf "%s.csproj" (printf "%s-%s" $path $language) }}
                    {{ $deplang = "xml" }}
                {{ else if eq $language "java" }}
                    {{ $program = "src/main/java/myproject/App.java" }}
                    {{ $depfile = "pom.xml" }}
                    {{ $deplang = "xml" }}
                {{ else if eq $language "yaml" }}
                    {{ $program = "Pulumi.yaml" }}
                {{ end }}
                {{ if ne $program "" }}
                    {{ $root := slice "static" "programs" (printf "%s-%s" $path $language) }}
                    {{ $code := readFile (path.Join $root $program) }}
                    <div data-program-path="{{ $path }}" data-program-language="{{ $language }}" data-program-file="{{ $program }}" data-program-depfile="{{ $depfile }}">
                        {{ highlight $code $language }}
                    </div>
                    <div class="example-program-footer bg-white">
                        <pulumi-tooltip>
                            <a href="https://github.com/pulumi/pulumi-hugo/tree/{{ site.Params.contentRepositoryBaseBranch }}/{{ getenv "REPO_THEME_PATH" }}static/programs/{{ $path }}-{{ $language }}" target="_blank">
                                <i class="fab fa-github"></i>
                            </a>
                            <span slot="content">View full example on GitHub</span>
                        </pulumi-tooltip>
                    </div>
                {{ end }}
        </pulumi-choosable>
    </div>
{{ end }}

{{ if $showChooser }}
        </pulumi-chooser>
    </div>
{{ end }}
